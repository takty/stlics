var L=e=>{throw TypeError(e)};var V=(e,r,s)=>r.has(e)||L("Cannot "+s);var h=(e,r,s)=>(V(e,r,"read from private field"),s?s.call(e):r.get(e)),z=(e,r,s)=>r.has(e)?L("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,s),C=(e,r,s,n)=>(V(e,r,"write to private field"),n?n.call(e,s):r.set(e,s),s),g=(e,r,s)=>(V(e,r,"access private method"),s);var A=(e,r,s,n)=>({set _(t){C(e,r,t,s)},get _(){return h(e,r,n)}});import{S as O,A as D}from"./assignment-list-CGXMeu0W.js";import"./worker-DXDc5_xr.js";function P(e){let r=1,s=0;for(const n of e.constraints()){const t=B(n),o=q(n);t<r&&(r=t),s<o&&(s=o)}return[r,s]}function q(e){const r=e.size();return r===1?G(e):r===2?J(e):r===3?Q(e):W(e)}function B(e){const r=e.size();return r===1?I(e):r===2?K(e):r===3?U(e):Y(e)}function G(e){const r=e.degree();if(0<=r)return r;const s=e.at(0);let n=0;for(const t of s.domain()){const o=e.rel.degree(t);if(n<o&&(n=o),n===1)return 1}return n}function I(e){const r=e.degree();if(0<=r)return r;const s=e.at(0);let n=1;for(const t of s.domain()){const o=e.rel.degree(t);if(o<n&&(n=o),n===0)return 0}return n}function J(e){const r=e.degree();if(0<=r)return r;let s=0;const n=(a,u)=>{const d=e.rel.degree(a,u);return s<d&&(s=d),s===1},t=e.at(0),o=e.at(1),i=t.value(),f=o.value(),c=t.domain(),l=o.domain();if(t.isEmpty()&&!o.isEmpty()){for(const a of c)if(n(a,f))return 1}else if(!t.isEmpty()&&o.isEmpty()){for(const a of l)if(n(i,a))return 1}else for(const a of c)for(const u of l)if(n(a,u))return 1;return s}function K(e){const r=e.degree();if(0<=r)return r;let s=1;const n=(a,u)=>{const d=e.rel.degree(a,u);return d<s&&(s=d),s===0},t=e.at(0),o=e.at(1),i=t.value(),f=o.value(),c=t.domain(),l=o.domain();if(t.isEmpty()&&!o.isEmpty()){for(const a of c)if(n(a,f))return 0}else if(!t.isEmpty()&&o.isEmpty()){for(const a of l)if(n(i,a))return 0}else for(const a of c)for(const u of l)if(n(a,u))return 0;return s}function Q(e){const r=e.degree();if(0<=r)return r;let s=0;const n=(m,p,y)=>{const E=e.rel.degree(m,p,y);return s<E&&(s=E),s===1},t=e.at(0),o=e.at(1),i=e.at(2),f=t.value(),c=o.value(),l=i.value(),a=t.domain(),u=o.domain(),d=i.domain();if(t.isEmpty()&&!o.isEmpty()&&!i.isEmpty()){for(const m of a)if(n(m,c,l))return 1}else if(!t.isEmpty()&&o.isEmpty()&&!i.isEmpty()){for(const m of u)if(n(f,m,l))return 1}else if(!t.isEmpty()&&!o.isEmpty()&&i.isEmpty()){for(const m of d)if(n(f,c,m))return 1}else if(t.isEmpty()&&o.isEmpty()&&!i.isEmpty()){for(const m of a)for(const p of u)if(n(m,p,l))return 1}else if(t.isEmpty()&&!o.isEmpty()&&i.isEmpty()){for(const m of a)for(const p of d)if(n(m,c,p))return 1}else if(!t.isEmpty()&&o.isEmpty()&&i.isEmpty()){for(const m of u)for(const p of d)if(n(f,m,p))return 1}else for(const m of a)for(const p of u)for(const y of d)if(n(m,p,y))return 1;return s}function U(e){const r=e.degree();if(0<=r)return r;let s=1;const n=(m,p,y)=>{const E=e.rel.degree(m,p,y);return E<s&&(s=E),s===0},t=e.at(0),o=e.at(1),i=e.at(2),f=t.value(),c=o.value(),l=i.value(),a=t.domain(),u=o.domain(),d=i.domain();if(t.isEmpty()&&!o.isEmpty()&&!i.isEmpty()){for(const m of a)if(n(m,c,l))return 0}else if(!t.isEmpty()&&o.isEmpty()&&!i.isEmpty()){for(const m of u)if(n(f,m,l))return 0}else if(!t.isEmpty()&&!o.isEmpty()&&i.isEmpty()){for(const m of d)if(n(f,c,m))return 0}else if(t.isEmpty()&&o.isEmpty()&&!i.isEmpty()){for(const m of a)for(const p of u)if(n(m,p,l))return 0}else if(t.isEmpty()&&!o.isEmpty()&&i.isEmpty()){for(const m of a)for(const p of d)if(n(m,c,p))return 0}else if(!t.isEmpty()&&o.isEmpty()&&i.isEmpty()){for(const m of u)for(const p of d)if(n(f,m,p))return 0}else for(const m of a)for(const p of u)for(const y of d)if(n(m,p,y))return 0;return s}function W(e){const r=e.degree();if(0<=r)return r;const s=new Array(e.emptyVariableSize());let n=0;const t=new Array(e.size());for(let o=0,i=e.size();o<i;++o){const f=e.at(o);f.isEmpty()?s[n++]=o:t[o]=f.value()}return N(e,t,s,0,0)}function Y(e){const r=e.degree();if(0<=r)return r;const s=new Array(e.emptyVariableSize());let n=0;const t=new Array(e.size());for(let o=0,i=e.size();o<i;++o){const f=e.at(o);f.isEmpty()?s[n++]=o:t[o]=f.value()}return $(e,t,s,0,1)}function N(e,r,s,n,t){const o=s[n],i=e.at(o).domain();if(n===s.length-1)for(const f of i){r[o]=f;const c=e.rel.degree(...r);if(t<c&&(t=c),t===1)return 1}else for(const f of i)r[o]=f,t=N(e,r,s,n+1,t);return t}function $(e,r,s,n,t){const o=s[n],i=e.at(o).domain();if(n===s.length-1)for(const f of i){r[o]=f;const c=e.rel.degree(...r);if(c<t&&(t=c),t===0)return 0}else for(const f of i)r[o]=f,t=$(e,r,s,n+1,t);return t}var x,b,S,w,v,M,j,F,H,R,T,_;class nt extends O{constructor(){super();z(this,v);z(this,x);z(this,b);z(this,S);z(this,w)}name(){return"Flexible Local Changes"}preprocess(){[A(this,b)._,A(this,x)._]=P(this.pro),C(this,S,this.pro.degree()),this.pro.emptyVariableSize()===0&&this.pro.clearAllVariables(),C(this,w,-1),this.monitor.initialize()}exec(){const s=new Set,n=new Set,t=new Set;for(const d of this.pro.variables())(d.isEmpty()?t:n).add(d);const o=new Set,i=g(this,v,R).call(this,n,o);let f,c=null;t.size===0?(f=i,c=D.fromVariables(n)):f=h(this,b);const l=g(this,v,M).call(this,n,o).union(t),a=n.difference(l);let u=g(this,v,j).call(this,s,a,l,h(this,x),h(this,x),f);return u<f&&c!==null&&c.apply(),u=this.pro.degree(),h(this,S)<u&&0<u&&(h(this,w)!==0||this.monitor.getTarget()===null)}}x=new WeakMap,b=new WeakMap,S=new WeakMap,w=new WeakMap,v=new WeakSet,M=function(s,n){const t=new Map;for(const f of n)if(f.isDefined())for(const c of f)t.has(c)?t.set(c,(t.get(c)??0)+1):t.set(c,1);const o=[...s];o.sort((f,c)=>{let l=0,a=0;return t.has(f)&&(l=t.get(f)??0),t.has(c)&&(a=t.get(c)??0),l<a?1:a<l?-1:0});const i=new Set;for(const f of o){let c=!1;for(const l of n)if(l.isDefined()){c=!0;break}if(!c)break;f.clear(),i.add(f)}return i},j=function(s,n,t,o,i,f){for(n=new Set(n),t=new Set(t);;){this.monitor.outputDebugString(`X1 ${s.size}, X2' ${n.size}, X3' ${t.size}`);const c=this.monitor.check(this.pro.degree());if(c!==null)return C(this,w,c?1:0),i;if(t.size===0)return i;const l=t.values().next().value,a=g(this,v,F).call(this,s,n,l,o,i,f);if(h(this,w)!==-1)return i;if(a<f)return h(this,b);n.add(l),t.delete(l),i=a}},F=function(s,n,t,o,i,f){let c=h(this,b);if(t.domain().size()===0)return c;let l=D.fromVariables(n),a=t.domain().at(0);const u=D.fromVariables(n);for(let d=0;d<t.domain().size()&&c<i;++d){const m=t.domain().at(d);t.assign(m);const p=Math.min(o,g(this,v,T).call(this,s,t,c,f));if(Math.max(c,f)<p){const y=new Set,E=Math.min(Math.min(p,i),g(this,v,_).call(this,s,n,t,p,i,y));if(c<E&&(c=E,a=m,l=D.fromVariables(n)),y.size){const k=g(this,v,H).call(this,s,n,t,p,i,y,Math.max(f,c));if(h(this,w)!==-1)return c;c<k&&(c=k,a=m,l=D.fromVariables(n)),u.apply()}}}return l.apply(),t.assign(a),c},H=function(s,n,t,o,i,f,c){const l=g(this,v,M).call(this,n,f),a=Z(s,t),u=n.difference(l);return g(this,v,j).call(this,a,u,l,o,Math.min(i,o),c)},R=function(s,n){const t=new Set;for(const i of s)for(const f of i)t.add(f);let o=1;for(const i of t){const f=i.degree();f<0||f<o&&(o=f)}for(const i of this.pro.constraints())B(i)<h(this,x)&&n.add(i);return o},T=function(s,n,t,o){let i=1;const f=new Set;for(const c of s){const l=this.pro.constraintsBetween(c,n);for(const a of l)f.add(a)}for(const c of f){const l=c.degree();if(!(l<0)&&(l<i&&(i=l),i<=t||i<=o))return i}return i},_=function(s,n,t,o,i,f){let c=1;const l=new Set;for(const a of s){const u=this.pro.constraintsBetween(a,t);for(const d of u)l.add(d)}for(const a of n){const u=this.pro.constraintsBetween(a,t);for(const d of u)l.add(d)}for(const a of l){const u=a.degree();u<0||u<c&&(c=u)}for(const a of l){const u=a.degree();u<0||(u<o||u<i)&&f.add(a)}return c};function Z(e,r){return new Set(e).add(r)}export{nt as FlexibleLocalChanges};

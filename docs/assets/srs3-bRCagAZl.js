var F=a=>{throw TypeError(a)};var z=(a,n,t)=>n.has(a)||F("Cannot "+t);var s=(a,n,t)=>(z(a,n,"read from private field"),t?t.call(a):n.get(a)),f=(a,n,t)=>n.has(a)?F("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(a):n.set(a,t),d=(a,n,t,e)=>(z(a,n,"write to private field"),e?e.call(a,t):n.set(a,t),t),p=(a,n,t)=>(z(a,n,"access private method"),t);import{S as $,r as j,A as M}from"./assignment-list-NtRAOzA7.js";var g,m,l,S,b,E,r,T,y,k,U,W,X,I,P;class G extends ${constructor(){super();f(this,r);f(this,g);f(this,m);f(this,l);f(this,S);f(this,b);f(this,E,!0)}setRandomness(t){d(this,E,t)}name(){return"SRS3"}preprocess(){d(this,g,new Array(this.pro.constraintSize())),s(this,g).fill(1),d(this,m,new Set),d(this,l,new Set),d(this,S,[]),d(this,b,[]);for(const t of this.pro.constraints())s(this,S).push(new q(t)),s(this,b).push(null);for(const t of this.pro.variables())t.isEmpty()&&t.assign(t.domain().at(0));this.monitor.initialize()}exec(){const t=this.pro.degree(),e=new M;let i=t,h=null;for(;;){const[o,u]=this.pro.constraintsWithDegree();if(this.monitor.outputDebugString(`Evaluation: ${u}`),i<u&&(e.setProblem(this.pro),i=u,this.monitor.solutionFound(e,i)))return!0;if((h=this.monitor.check(u))!==null)break;for(const D of s(this,S))D.clear();const c=new Set;for(const D of o){const N=s(this,S)[D.index()];c.add(N)}p(this,r,T).call(this,c)}return h===!1&&!this.monitor.isTargetAssigned()&&t<i&&(e.apply(),h=!0),h}}g=new WeakMap,m=new WeakMap,l=new WeakMap,S=new WeakMap,b=new WeakMap,E=new WeakMap,r=new WeakSet,T=function(t){this.monitor.outputDebugString("SRS"),s(this,m).clear(),s(this,l).clear();for(const e of t)s(this,l).add(e);for(;t.size&&s(this,l).size;){const e=p(this,r,X).call(this,s(this,l));s(this,l).delete(e),p(this,r,k).call(this,e)?t.delete(e)||(e.parent()&&p(this,r,k).call(this,e.parent())?p(this,r,U).call(this,e,t):p(this,r,y).call(this,e)):p(this,r,y).call(this,e)}return t.size===0},y=function(t){this.monitor.outputDebugString("Spread"),s(this,m).add(t);for(const e of p(this,r,W).call(this,t))!s(this,m).has(e)&&!s(this,l).has(e)&&(e.clear(),t.append(e),s(this,l).add(e))},k=function(t){this.monitor.outputDebugString("Repair");const e=t.constraint();let i=t;do s(this,g)[i.constraint().index()]+=1;while(i=i.parent());const h=e.degree(),o=new M;let u=0;for(const c of e){const D=c.value();let N=0;for(const w of c)N+=(1-w.degree())*s(this,g)[w.index()];t:for(const w of c.domain()){if(D===w||(c.assign(w),e.degree()<=h))continue;let R=N;for(const V of c)if(R-=(1-V.degree())*s(this,g)[V.index()],R<u)continue t;u<R?(u=R,o.clear(),o.addVariable(c,w)):u!==0&&o.addVariable(c,w)}c.assign(D)}if(0<o.size()){const c=s(this,E)?o.random():o.at(0);return c.apply(),this.monitor.outputDebugString("	"+c),!0}return!1},U=function(t,e){this.monitor.outputDebugString("Shrink");let i=t,h=!1;for(;;){if(i=i.parent(),e.delete(i)){h=!0;break}if(!i.parent()||!p(this,r,k).call(this,i.parent()))break}const o=[];i.getDescendants(o),i.clear();for(const u of o)s(this,l).delete(u),s(this,m).delete(u);h||s(this,l).add(i)},W=function(t){const e=t.constraint(),i=e.index();if(s(this,b)[i]===null){const h=[];for(const o of e.neighbors())h.push(s(this,S)[o.index()]);s(this,b)[i]=h}return s(this,b)[i]},X=function(t){const e=p(this,r,I).call(this,p(this,r,P).call(this,t));return s(this,E)?e[j(e.length)]:e[0]},I=function(t){let e=Number.MAX_VALUE,i=[];for(const h of t){const o=s(this,g)[h.constraint().index()];o<e?(e=o,i.length=0,i.push(h)):o===e&&i.push(h)}return i},P=function(t){let e=Number.MAX_VALUE,i=[];for(const h of t){const o=h.depth();o<e?(e=o,i.length=0,i.push(h)):o===e&&i.push(h)}return i};var L,x,A,v;class q{constructor(n){f(this,L);f(this,x,0);f(this,A,null);f(this,v,[]);d(this,L,n)}append(n){d(n,A,this),d(n,x,s(this,x)+1),s(this,v).push(n)}clear(){d(this,A,null),d(this,x,0);for(const n of s(this,v))n.clear();s(this,v).length=0}constraint(){return s(this,L)}depth(){return s(this,x)}parent(){return s(this,A)}getDescendants(n){n.push(this);for(const t of s(this,v))t.getDescendants(n)}}L=new WeakMap,x=new WeakMap,A=new WeakMap,v=new WeakMap;export{G as SRS3};

var V=h=>{throw TypeError(h)};var k=(h,n,t)=>n.has(h)||V("Cannot "+t);var e=(h,n,t)=>(k(h,n,"read from private field"),t?t.call(h):n.get(h)),u=(h,n,t)=>n.has(h)?V("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(h):n.set(h,t),f=(h,n,t,s)=>(k(h,n,"write to private field"),s?s.call(h,t):n.set(h,t),t),d=(h,n,t)=>(k(h,n,"access private method"),t);import{S as P,r as W,A as C}from"./assignment-list-BNbGFqP0.js";import"./worker-C4zsj9tJ.js";var g,m,l,S,b,D,r,F,z,R,M,T,U,X,I;class G extends P{constructor(){super();u(this,r);u(this,g);u(this,m);u(this,l);u(this,S);u(this,b);u(this,D,!0)}setRandomness(t){f(this,D,t)}name(){return"Crisp SRS3"}preprocess(){f(this,g,new Array(this.pro.constraintSize())),e(this,g).fill(1),f(this,m,new Set),f(this,l,new Set),f(this,S,[]),f(this,b,[]);for(const t of this.pro.constraints())e(this,S).push(new $(t)),e(this,b).push(null);for(const t of this.pro.variables())t.isEmpty()&&t.assign(t.domain().at(0));this.monitor.initialize()}exec(){const t=this.pro.degree(),s=new C;let i=t,o=null;for(;;){const a=this.pro.violatingConstraints(),c=this.pro.ratio();if(this.monitor.outputDebugString(`Evaluation: ${c}`),i<c&&(s.setProblem(this.pro),i=c,this.monitor.solutionFound(s,i)))return!0;if((o=this.monitor.check(c))!==null)break;for(const v of e(this,S))v.clear();const E=new Set;for(const v of a){const p=e(this,S)[v.index()];E.add(p)}d(this,r,F).call(this,E)}return o===!1&&!this.monitor.isTargetAssigned()&&t<i&&(s.apply(),o=!0),o}}g=new WeakMap,m=new WeakMap,l=new WeakMap,S=new WeakMap,b=new WeakMap,D=new WeakMap,r=new WeakSet,F=function(t){this.monitor.outputDebugString("SRS"),e(this,m).clear(),e(this,l).clear();for(const s of t)e(this,l).add(s);for(;t.size&&e(this,l).size;){const s=d(this,r,U).call(this,e(this,l));e(this,l).delete(s),d(this,r,R).call(this,s)?t.delete(s)||(s.parent()&&d(this,r,R).call(this,s.parent())?d(this,r,M).call(this,s,t):d(this,r,z).call(this,s)):d(this,r,z).call(this,s)}return t.size===0},z=function(t){this.monitor.outputDebugString("Spread"),e(this,m).add(t);for(const s of d(this,r,T).call(this,t))!e(this,m).has(s)&&!e(this,l).has(s)&&(s.clear(),t.append(s),e(this,l).add(s))},R=function(t){this.monitor.outputDebugString("Repair");const s=t.constraint();let i=t;do e(this,g)[i.constraint().index()]+=1;while(i=i.parent());const o=new C;let a=0;for(const c of s){const E=c.value();let v=0;for(const p of c)v+=(1-p.status())*e(this,g)[p.index()];t:for(const p of c.domain()){if(E===p||(c.assign(p),s.status()!==1))continue;let N=v;for(const y of c)if(N-=(1-y.status())*e(this,g)[y.index()],N<a)continue t;a<N?(a=N,o.clear(),o.addVariable(c,p)):a!==0&&o.addVariable(c,p)}c.assign(E)}if(0<o.size()){const c=e(this,D)?o.random():o.at(0);return c.apply(),this.monitor.outputDebugString("	"+c),!0}return!1},M=function(t,s){this.monitor.outputDebugString("Shrink");let i=t,o=!1;for(;;){if(i=i.parent(),s.delete(i)){o=!0;break}if(!i.parent()||!d(this,r,R).call(this,i.parent()))break}const a=[];i.getDescendants(a),i.clear();for(const c of a)e(this,l).delete(c),e(this,m).delete(c);o||e(this,l).add(i)},T=function(t){const s=t.constraint(),i=s.index();if(e(this,b)[i]===null){const o=[];for(const a of s.neighbors())o.push(e(this,S)[a.index()]);e(this,b)[i]=o}return e(this,b)[i]},U=function(t){const s=d(this,r,X).call(this,d(this,r,I).call(this,t));return e(this,D)?s[W(s.length)]:s[0]},X=function(t){let s=Number.MAX_VALUE,i=[];for(const o of t){const a=e(this,g)[o.constraint().index()];a<s?(s=a,i.length=0,i.push(o)):a===s&&i.push(o)}return i},I=function(t){let s=Number.MAX_VALUE,i=[];for(const o of t){const a=o.depth();a<s?(s=a,i.length=0,i.push(o)):a===s&&i.push(o)}return i};var L,w,A,x;class ${constructor(n){u(this,L);u(this,w,0);u(this,A,null);u(this,x,[]);f(this,L,n)}append(n){f(n,A,this),f(n,w,e(this,w)+1),e(this,x).push(n)}clear(){f(this,A,null),f(this,w,0);for(const n of e(this,x))n.clear();e(this,x).length=0}constraint(){return e(this,L)}depth(){return e(this,w)}parent(){return e(this,A)}getDescendants(n){n.push(this);for(const t of e(this,x))t.getDescendants(n)}}L=new WeakMap,w=new WeakMap,A=new WeakMap,x=new WeakMap;export{G as CrispSRS3};

var L=c=>{throw TypeError(c)};var C=(c,a,s)=>a.has(c)||L("Cannot "+s);var u=(c,a,s)=>(C(c,a,"read from private field"),s?s.call(c):a.get(c)),S=(c,a,s)=>a.has(c)?L("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(c):a.set(c,s),x=(c,a,s,n)=>(C(c,a,"write to private field"),n?n.call(c,s):a.set(c,s),s),p=(c,a,s)=>(C(c,a,"access private method"),s);var v=(c,a,s,n)=>({set _(t){x(c,a,t,s)},get _(){return u(c,a,n)}});import{S as N,A as z}from"./assignment-list-DFT4IpBb.js";import{c as O,l as P}from"./consistency-CCCPNVtk.js";import"./worker-Dn0Pgr45.js";var b,w,V,g,d,j,D,F,R,T,_,E;class K extends N{constructor(){super();S(this,d);S(this,b);S(this,w);S(this,V);S(this,g)}name(){return"Flexible Local Changes"}preprocess(){[v(this,w)._,v(this,b)._]=O(this.pro),x(this,V,this.pro.degree()),this.pro.emptyVariableSize()===0&&this.pro.clearAllVariables(),x(this,g,-1),this.monitor.initialize()}exec(){const s=new Set,n=new Set,t=new Set;for(const m of this.pro.variables())(m.isEmpty()?t:n).add(m);const l=new Set,i=p(this,d,T).call(this,n,l);let o,e=null;t.size===0?(o=i,e=z.fromVariables(n)):o=u(this,w);const r=p(this,d,j).call(this,n,l).union(t),f=n.difference(r);let h=p(this,d,D).call(this,s,f,r,u(this,b),u(this,b),o);return h<o&&e!==null&&e.apply(),h=this.pro.degree(),u(this,V)<h&&0<h&&(u(this,g)!==0||this.monitor.getTarget()===null)}}b=new WeakMap,w=new WeakMap,V=new WeakMap,g=new WeakMap,d=new WeakSet,j=function(s,n){const t=new Map;for(const o of n)if(o.isDefined())for(const e of o)t.has(e)?t.set(e,(t.get(e)??0)+1):t.set(e,1);const l=[...s];l.sort((o,e)=>{let r=0,f=0;return t.has(o)&&(r=t.get(o)??0),t.has(e)&&(f=t.get(e)??0),r<f?1:f<r?-1:0});const i=new Set;for(const o of l){let e=!1;for(const r of n)if(r.isDefined()){e=!0;break}if(!e)break;o.clear(),i.add(o)}return i},D=function(s,n,t,l,i,o){{this.monitor.outputDebugString(`X1 ${s.size}, X2' ${n.size}, X3' ${t.size}`);const e=this.monitor.check(this.pro.degree());if(e!==null)return x(this,g,e?1:0),i;if(t.size===0)return i;const r=t.values().next().value,f=p(this,d,F).call(this,s,n,r,l,i,o);return u(this,g)!==-1?i:f<o?u(this,w):(n=$(n,r),t=q(t,r),p(this,d,D).call(this,s,n,t,l,f,o))}},F=function(s,n,t,l,i,o){let e=u(this,w);if(t.domain().size()===0)return e;let r=z.fromVariables(n),f=t.domain().at(0);const h=z.fromVariables(n);for(let m=0;m<t.domain().size()&&e<i;++m){const M=t.domain().at(m);t.assign(M);const y=Math.min(l,p(this,d,_).call(this,s,t,e,o));if(Math.max(e,o)<y){const A=new Set,k=Math.min(Math.min(y,i),p(this,d,E).call(this,s,n,t,y,i,A));if(e<k&&(e=k,f=M,r=z.fromVariables(n)),A.size){const B=p(this,d,R).call(this,s,n,t,y,i,A,Math.max(o,e));if(u(this,g)!==-1)return e;e<B&&(e=B,f=M,r=z.fromVariables(n)),h.apply()}}}return r.apply(),t.assign(f),e},R=function(s,n,t,l,i,o,e){const r=p(this,d,j).call(this,n,o),f=$(s,t),h=n.difference(r);return p(this,d,D).call(this,f,h,r,l,Math.min(i,l),e)},T=function(s,n){const t=new Set;for(const i of s)for(const o of i)t.add(o);let l=1;for(const i of t){const o=i.degree();o<0||o<l&&(l=o)}for(const i of this.pro.constraints())P(i)<u(this,b)&&n.add(i);return l},_=function(s,n,t,l){let i=1;const o=new Set;for(const e of s){const r=this.pro.constraintsBetween(e,n);for(const f of r)o.add(f)}for(const e of o){const r=e.degree();if(!(r<0)&&(r<i&&(i=r),i<=t||i<=l))return i}return i},E=function(s,n,t,l,i,o){let e=1;const r=new Set;for(const f of s){const h=this.pro.constraintsBetween(f,t);for(const m of h)r.add(m)}for(const f of n){const h=this.pro.constraintsBetween(f,t);for(const m of h)r.add(m)}for(const f of r){const h=f.degree();h<0||h<e&&(e=h)}for(const f of r){const h=f.degree();h<0||(h<l||h<i)&&o.add(f)}return e};function $(c,a){return new Set(c).add(a)}function q(c,a){const s=new Set(c);return s.delete(a),s}export{K as FlexibleLocalChanges};

var tt=Object.defineProperty;var H=n=>{throw TypeError(n)};var et=(n,e,t)=>e in n?tt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var d=(n,e,t)=>et(n,typeof e!="symbol"?e+"":e,t),J=(n,e,t)=>e.has(n)||H("Cannot "+t);var s=(n,e,t)=>(J(n,e,"read from private field"),t?t.call(n):e.get(n)),a=(n,e,t)=>e.has(n)?H("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),o=(n,e,t,r)=>(J(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var W=(n,e,t,r)=>({set _(i){o(n,e,i,t)},get _(){return s(n,e,r)}});var L,R;class K{constructor(){a(this,L,-1);a(this,R,"");d(this,"userObject",null)}setIndex(e){o(this,L,e)}setName(e){o(this,R,e)}index(){return s(this,L)}name(){return s(this,R)}}L=new WeakMap,R=new WeakMap;var z;const S=class S extends K{constructor(t){super();d(this,"d");d(this,"es",[]);d(this,"v",s(S,z));this.d=t}toString(){const t=this.name(),r=t?`(${t})`:"",i=this.isEmpty()?"<empty>":""+this.value();return`x${this.index()}${r} = ${i}`}size(){return this.es.length}at(t){return this.es.at(t)}has(t){return this.es.includes(t)}indexOf(t){return this.es.indexOf(t)}neighbors(){const t=[];for(const r of this.es)for(const i of r)i!==this&&t.push(i);return t}[Symbol.iterator](){return this.es[Symbol.iterator]()}connect(t){if(this.es.includes(t))throw new RangeError;this.es.push(t)}disconnect(t){if(!this.es.includes(t))throw new RangeError;this.es=this.es.filter(r=>r!==t)}domain(t){if(t===void 0)return this.d;this.d=t,this.clear()}assign(t){this.v=t}clear(){this.assign(s(S,z))}value(){return this.v}isEmpty(){return this.value()===s(S,z)}};z=new WeakMap,a(S,z,Number.MIN_VALUE);let O=S;class A{static create(e,t=null){if(Array.isArray(e))return new st(e);if(t!==null)return new rt(e,t);throw new RangeError}}var m;class st extends A{constructor(t){super();a(this,m);o(this,m,[...t])}contains(t){return s(this,m).includes(t)}indexOf(t){return s(this,m).indexOf(t)}size(){return s(this,m).length}at(t){return s(this,m)[t]}[Symbol.iterator](){return s(this,m)[Symbol.iterator]()}}m=new WeakMap;var g,y;class rt extends A{constructor(t,r){super();a(this,g);a(this,y);o(this,g,t|0),o(this,y,r|0)}contains(t){return s(this,g)<=t&&t<=s(this,y)}indexOf(t){return s(this,g)<=t&&t<=s(this,y)?t-s(this,g):-1}size(){return s(this,y)-s(this,g)+1}at(t){return s(this,g)+t}[Symbol.iterator](){let t=s(this,g);const r=s(this,y);return{next(){return t<=r?{value:t++,done:!1}:{value:null,done:!0}}}}}g=new WeakMap,y=new WeakMap;class Q extends K{constructor(t){super();d(this,"r");d(this,"es",[]);this.r=t}static create(t,r){return r.length===1?new it(t,r[0]):r.length===2?new nt(t,r[0],r[1]):r.length===3?new at(t,r[0],r[1],r[2]):new ot(t,...r)}toString(){const t=this.name(),r=t?`(${t})`:"",i=this.degree(),h=i<0?"UNDEFINED":""+i;return`c${this.index()}${r} = ${h}`}size(){return this.es.length}at(t){return this.es.at(t)}has(t){return this.es.includes(t)}indexOf(t){return this.es.indexOf(t)}neighbors(){const t=[];for(const r of this.es)for(const i of r)i!==this&&t.push(i);return t}[Symbol.iterator](){return this.es[Symbol.iterator]()}relation(){return this.r}}class it extends Q{constructor(e,t){super(e),this.es=[t]}emptySize(){return this.es[0].isEmpty()?1:0}isDefined(){return!this.es[0].isEmpty()}status(){return this.es[0].isEmpty()?-1:this.r(this.es[0].value())===1?1:0}degree(){return this.es[0].isEmpty()?-1:this.r(this.es[0].value())}}class nt extends Q{constructor(e,t,r){super(e),this.es=[t,r]}emptySize(){let e=0;return this.es[0].isEmpty()&&++e,this.es[1].isEmpty()&&++e,e}isDefined(){return!this.es[0].isEmpty()&&!this.es[1].isEmpty()}status(){return this.es[0].isEmpty()||this.es[1].isEmpty()?-1:this.r(this.es[0].value(),this.es[1].value())===1?1:0}degree(){return this.es[0].isEmpty()||this.es[1].isEmpty()?-1:this.r(this.es[0].value(),this.es[1].value())}}class at extends Q{constructor(e,t,r,i){super(e),this.es=[t,r,i]}emptySize(){let e=0;return this.es[0].isEmpty()&&++e,this.es[1].isEmpty()&&++e,this.es[2].isEmpty()&&++e,e}isDefined(){return!this.es[0].isEmpty()&&!this.es[1].isEmpty()&&!this.es[2].isEmpty()}status(){return this.es[0].isEmpty()||this.es[1].isEmpty()||this.es[2].isEmpty()?-1:this.r(this.es[0].value(),this.es[1].value(),this.es[2].value())===1?1:0}degree(){return this.es[0].isEmpty()||this.es[1].isEmpty()||this.es[2].isEmpty()?-1:this.r(this.es[0].value(),this.es[1].value(),this.es[2].value())}}var b;class ot extends Q{constructor(t,...r){super(t);a(this,b);this.es=[...r],o(this,b,new Array(this.es.length))}emptySize(){let t=0;for(const r of this.es)t+=r.isEmpty()?1:0;return t}isDefined(){for(const t of this.es)if(t.isEmpty())return!1;return!0}status(){for(let t=0;t<this.es.length;++t){const r=this.es[t];if(r.isEmpty())return-1;s(this,b)[t]=r.value()}return this.r(...s(this,b))===1?1:0}degree(){for(let t=0;t<this.es.length;++t){const r=this.es[t];if(r.isEmpty())return-1;s(this,b)[t]=r.value()}return this.r(...s(this,b))}}b=new WeakMap;var v,T,l,u;class ut{constructor(){a(this,v,e=>new O(e));a(this,T,(e,t)=>Q.create(e,t));a(this,l,[]);a(this,u,[])}setVariableFactory(e){o(this,v,e)}setConstraintFactory(e){o(this,T,e)}addVariable(e){e.setIndex(s(this,l).length),s(this,l).push(e)}createDomain(e,t=null){if(Array.isArray(e))return A.create(e);if(t!==null)return A.create(e,t);throw new RangeError}createVariable(e,t=null,r){if(e instanceof O){const i=s(this,v).call(this,e.domain());return this.addVariable(i),i.setName(i.name()),i.assign(i.value()),i}else if(e instanceof A){if(t!==null&&!e.contains(t))throw new Error;const i=s(this,v).call(this,e);return this.addVariable(i),t!==null&&i.assign(t),r&&i.setName(r),i}throw new RangeError}createConstraint(e,t,r){const i=s(this,T).call(this,e,t);i.setIndex(s(this,u).length),s(this,u).push(i);for(const h of t)h.connect(i);return r&&i.setName(r),i}removeConstraint(e){const t=s(this,u).indexOf(e);s(this,u).splice(t,1);for(let r=t;r<s(this,u).length;++r)s(this,u)[r].setIndex(r);for(const r of e)r.disconnect(e)}clearAllVariables(){for(const e of s(this,l))e.clear()}reverseVariables(){s(this,l).reverse();for(let e=0;e<s(this,l).length;++e)s(this,l)[e].setIndex(e)}sortVariables(e){s(this,l).sort(e);for(let t=0;t<s(this,l).length;++t)s(this,l)[t].setIndex(t)}variables(){return s(this,l)}variableSize(){return s(this,l).length}variableAt(e){return s(this,l)[e]}variableOf(e){for(const t of s(this,l))if(t.name()===e)return t;return null}hasVariable(e){return s(this,l).includes(e)}constraints(){return s(this,u)}constraintSize(){return s(this,u).length}constraintAt(e){return s(this,u)[e]}constraintOf(e){for(const t of s(this,u))if(t.name()===e)return t;return null}hasConstraint(e){return s(this,u).includes(e)}constraintsBetween(e,t){const r=[];for(const i of e)i.has(t)&&r.push(i);return r}constraintDensity(){return s(this,u).length/s(this,l).length}emptySize(){let e=0;for(const t of s(this,l))e+=t.isEmpty()?1:0;return e}hasEmptyDomain(){for(const e of s(this,l))if(e.domain().size()===0)return!0;return!1}degree(){let e=1;for(const t of s(this,u)){const r=t.degree();if(r<0)return r;r<e&&(e=r)}return e}constraintsWithDegree(){const e=[];let t=1;for(const r of s(this,u)){const i=r.degree();i<t?(t=i,e.length=0,e.push(r)):i-t<Number.MIN_VALUE*10&&e.push(r)}return[e,t]}averageDegree(){let e=0;for(const t of s(this,u))e+=t.degree();return e/s(this,u).length}ratio(){return this.satisfiedConstraintSize()/s(this,u).length}satisfiedConstraintSize(){let e=0;for(const t of s(this,u))e+=t.status()===1?1:0;return e}violatingConstraintSize(){return s(this,u).length-this.satisfiedConstraintSize()}satisfiedConstraints(){const e=[];for(const t of s(this,u))t.status()===1&&e.push(t);return e}violatingConstraints(){const e=[];for(const t of s(this,u))t.status()===0&&e.push(t);return e}}v=new WeakMap,T=new WeakMap,l=new WeakMap,u=new WeakMap;var x,V,I,$,C,w,D,G,B,U,P;class ht{constructor(){a(this,x,!0);a(this,V,e=>console.log(e));a(this,I,()=>!1);a(this,$,Number.MAX_SAFE_INTEGER);a(this,C,null);a(this,w,.8);a(this,D,null);a(this,G,0);a(this,B,0);a(this,U,-1);a(this,P,0)}initialize(){o(this,G,s(this,C)===null?Number.MAX_VALUE:Date.now()+s(this,C)),o(this,B,0)}check(e=null){if(e!==null&&s(this,w)!==null&&s(this,w)<=e)return this.outputDebugString("Stop: Current evaluation value is above the target"),!0;if(s(this,$)<W(this,B)._++)return this.outputDebugString("Stop: Number of iterations has reached the limit"),!1;if(s(this,G)<Date.now())return this.outputDebugString("Stop: Time limit has been reached"),!1;if(e!==null&&s(this,D)!==null)if(e!==-1&&s(this,U)===e){if(s(this,D)<W(this,P)._++)return this.outputDebugString("Stop: Evaluation value has not changed for a certain number of times"),!1}else o(this,U,e),o(this,P,0);return null}solutionFound(e,t){return s(this,I).call(this,e,t)}outputDebugString(e){s(this,x)&&s(this,V).call(this,e)}isDebugMode(){return s(this,x)}isTargetAssigned(){return s(this,w)!==null}getTarget(){return s(this,w)}setIterationLimit(e=null){o(this,$,e===null?Number.MAX_SAFE_INTEGER:e)}setTimeLimit(e=null){o(this,C,e)}setTarget(e=null){o(this,w,e)}setSameEvaluationLimit(e=null){o(this,D,e)}setListener(e){o(this,I,e)}setDebugMode(e){o(this,x,e)}setDebugOutput(e){o(this,V,e)}}x=new WeakMap,V=new WeakMap,I=new WeakMap,$=new WeakMap,C=new WeakMap,w=new WeakMap,D=new WeakMap,G=new WeakMap,B=new WeakMap,U=new WeakMap,P=new WeakMap;var F;class lt extends O{constructor(t,r){super(t);a(this,F);o(this,F,r)}assign(t){super.assign(t),s(this,F)&&s(this,F).call(this,this,t)}}F=new WeakMap;class M{static crispSolverNames(){return["Forward Checking","Max Forward Checking","Local Changes","Breakout","GENET","Crisp SRS3"]}static fuzzySolverNames(){return["Full Checking","Fuzzy Forward Checking","Flexible Local Changes","Fuzzy Breakout","Fuzzy GENET","SRS3"]}static async createSolver(e){const t=await M.createCrispSolver(e);if(t)return t;const r=await M.createFuzzySolver(e);return r||null}static async createCrispSolver(e){switch(e.replaceAll(" ","")){case"ForwardChecking":case"forward-checking":const{ForwardChecking:t}=await import("./forward-checking-ESCSPLPy.js");return new t;case"MaxForwardChecking":case"max-forward-checking":const{MaxForwardChecking:r}=await import("./max-forward-checking-Cfn8pfOx.js");return new r;case"LocalChanges":case"local-changes":const{LocalChanges:i}=await import("./local-changes-BvkJZzVW.js");return new i;case"Breakout":case"breakout":const{Breakout:h}=await import("./breakout-66s6snms.js");return new h;case"GENET":case"genet":const{GENET:f}=await import("./genet-gO5HXKRy.js");return new f;case"CrispSRS3":case"crisp-srs3":const{CrispSRS3:p}=await import("./crisp-srs3-Dsqsq-9O.js");return new p}return null}static async createFuzzySolver(e){switch(e.replaceAll(" ","")){case"FullChecking":case"full-checking":const{FullChecking:t}=await import("./full-checking-Coat9X2L.js");return new t;case"FuzzyForwardChecking":case"fuzzy-forward-checking":const{FuzzyForwardChecking:r}=await import("./fuzzy-forward-checking-CWGPeeDa.js");return new r;case"FlexibleLocalChanges":case"flexible-local-changes":const{FlexibleLocalChanges:i}=await import("./flexible-local-changes-Vgqt2LGP.js");return new i;case"FuzzyBreakout":case"fuzzy-breakout":const{FuzzyBreakout:h}=await import("./fuzzy-breakout-Cw9fxbOj.js");return new h;case"FuzzyGENET":case"fuzzy-genet":const{FuzzyGENET:f}=await import("./fuzzy-genet-DCnxLy3e.js");return new f;case"SRS3":case"srs3":const{SRS3:p}=await import("./srs3-DdUt099D.js");return new p}return null}}var q;class ct{constructor(){d(this,"_debug",!0);a(this,q,e=>console.log(e))}setDebugMode(e){this._debug=e}setDebugOutput(e){this._debugOutput=e}_debugOutput(e){this._debug&&s(this,q).call(this,e)}}q=new WeakMap;var c;class ft extends ct{constructor(t){super();a(this,c);o(this,c,t)}getQueenSize(){return s(this,c)}setQueenSize(t){o(this,c,t)}createProblem(t){const r=[];for(let i=0;i<s(this,c);++i)r.push(t.createVariable(t.createDomain(1,s(this,c)-1),1,`Queen ${i}`));for(let i=0;i<s(this,c);++i)for(let h=i+1;h<s(this,c);++h){const f=h-i,p=(f-1)/(s(this,c)-1);t.createConstraint((k,N)=>k!==N&&k!==N+f&&k!==N-f?1:p,[r[i],r[h]])}return t}printResult(t){for(let r=0;r<s(this,c);++r){let i="";if(t.variableAt(r).isEmpty())for(let h=0;h<s(this,c)-1;++h)i+="- ";else for(let h=0;h<s(this,c)-1;++h)i+=t.variableAt(r).value()-1===h?"o ":"- ";this._debugOutput(i)}}}c=new WeakMap;onmessage=async n=>{const{task:e,args:t}=n.data;switch(e){case"create":gt(...t);break;case"solve":mt(...t);break}};let X=null,E=null,j=!1;function gt(n){X=new ft(n),X.setDebugOutput(Y);const e=(t,r)=>pt(r-1,t.index());E=new ut,E.setVariableFactory(t=>new lt(t,e)),E=X.createProblem(E)}async function mt(n,e,t,r){const i=Date.now(),h=M.fuzzySolverNames()[n],f=new ht;f.setTarget(e===-1?null:e),f.setTimeLimit(t===-1?null:t),f.setDebugOutput(Y),f.setDebugMode(r);const p=await M.createSolver(h);j=r;const k=p.solve(E,f),N=Date.now()-i,Z=E.degree();j=!0,X.printResult(E);for(const _ of E.variables())_.assign(_.value());postMessage({result:k,time:N,ev:Z,solver:p.name()})}function Y(n){j&&postMessage({log:n})}function pt(n,e){j&&postMessage({board:{x:n,y:e}})}export{ht as M,O as V};

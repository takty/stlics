{"version":3,"sources":["solver.js"],"names":["Solver","_debug","_pro","_iterLimit","_timeLimit","_targetDeg","listener","constructor","pro","this","name","exec","setIterationLimit","count","setTimeLimit","msec","setTargetRate","rate","solve","addListener","l","add","removeListener","splice","indexOf","foundSolution","solution","worstDegree","finish","DomainPruner","static","hiddenLevels","hiddenSize","size","Array","fill","UNHIDDEN","hide","index","level","isEmpty","length","isValueHidden","reveal","i","revealAll","Breakout","weights","isRandom","p","super","constraintSize","findCandidates","vioVars","canList","maxDiff","v","v_val","value","nowVio","c","isSatisfied","out","d","domain","assign","diff","clear","addVariable","listViolatingVariables","vioCons","vvs","Set","from","endTime","Number","MAX_VALUE","Date","now","iterCount","variables","at","AssignmentList","vc","violatingConstraints","satisfiedConstraintRate","console","log","e","arbitraryAssignment","get","apply","setRandomness","flag","ForwardChecking","vars","sol","relCons","useMRV","solverObject","initializeRelatedConstraintTable","j","push","constraintsBetween","getConstraintsBetween","checkForward","currentIndex","v_i","d_i","dc_i","cs","emptyVariableSize","k","n","indexOfVariableWithMRV","s","branch","variableSize","setProblem","vc_index","dc","clearAllVariables","r","a","variable","setUsingMinimumRemainingValuesHeuristics","MaxForwardChecking","maxVioCount","vioCount","checkedCons","cons","vcs","violatingConstraintSize","dom","getAdditionalViolationCount","future","revise","avc","has","v1","deleted","GENET","max","Math","floor","random","clusters","connections","createNetwork","Exception","Cluster","constraints","cl","origVal","_value","Connection","v2","cl_f","cl_s","origVal1","origVal2","_neurons","lockConnections","shuffle","is","nextInt","temp","order","cur","modified","setActivityMaximumInput","clu","applyToVariable","con","refreshWeight","var","maxNeurons","val","Neuron","setActivity","_isActive","neurons","NEGATIVE_INFINITY","alreadyOn","input","getInput","first","second","_weight","addConnection","getNeuron","self","conTemp","ret","LocalChanges","s1","s2","sn","delete","globalReturn","unassignAll","createNewV3","V1_V2","newV3","va","vi","isConsistent","A","lcValue","V1","V2","setPlusSet","V3","T","setMinusSet","vv","setPlusElement","lcVariables","lcVariable","values","next","al","fromVariables","setMinusElement","notFixed","unassigned","LocalChangesEx","CrispSRS3","closedList","openList","nodes","neighborConstraints","TreeNode","getNeighborConstraints","neighbors","repair","c0","candidates","shrink","node","c_stars","parent","getDescendants","getObject","spread","tnc","srs","children","obj","tn","tns","FuzzyBreakout","lastSolDeg","worstVars","satisfactionDegree","listWorstVariables","worstCons","wvs","deg","worstSatisfactionDegree","wsd","constraintsWithWorstSatisfactionDegree","FuzzyForwardChecking","solWorstDeg","degInc","sequence","unaryCons","pruneIntensively","vi_index","vj_index","pruneUnaryConstraints","orgVal","checkForwardConsistency","di","dci","checkForwardConsistency2","vj","dj","dcj","loop_i","ni","nj","checkForwardConsistency3","vk","dk","dck","nk","checkForwardConsistencyN","emptySize","emp","indexes","comLoop","hidden","checkBackwardConsistency","Constraint","UNDEFINED","refresh","index_vi","bc","CONTINUE","TERMINATE","nextLevel","branchLast","success","MIN_VALUE","setIncrementStepOfWorstSatisfactionDegree","degree","setIntensivePruning","FuzzyForwardCheckingBc","setAssignmentList","FuzzyGENET","worstDeg","fuzzyRelation","FlexibleLocalChanges","lt","lb","computeHighestAndLowestConsistencyDegree","choose","x2","cr","res","Map","isDefined","set","vs","sort","o1","o2","res1","res2","remain","low","high","lowestConsistencyDegree","h","highestConsistencyDegree","flcRepair","X1","X2","xi","consX1xi","consX12","rc","X3p","X1p","X2p","flcVariables","min","flcVariable","consX1","bestCons","bestX2","bestDij","x2Store","dij","consX1_xi","testX1","crNew","consX12_xi","testX12","repairCons","X3","consX12xi","initTest","X","sd","cd","csd","initCons","initSol","result","FlexibleLocalChangesEx","SRS3","minDeg0","maxDeg0","deg0","REPAIR_THRESHOLD","removeCStar","cn","wsdcs","setParent","solutionWorstDeg","SRS3_PF","uvs","PostStabilization","AC3","v_j","val_i","val_j","vals","checkConsistency","nd","createDomain","setDomain","remove","v_k","v_m","reviseDomain","c1","NodeConsistency","threshold","elms","removeConstraint","orig","stabilized","C_min","variableAt","org"],"mappings":"AAOA,MAAMA,OAELC,QAAS,EAKTC,KAKAC,WAAa,KAKbC,WAAa,KAKbC,WAAa,GAKbC,GAAY,GAMZC,YAAYC,GACXC,KAAKP,KAAOM,CACb,CAMAE,OACC,MAAO,EACR,CAOAC,OACC,OAAO,CACR,CAOAC,kBAAkBC,EAAQ,MACzBJ,KAAKN,WAAaU,CACnB,CAOAC,aAAaC,EAAO,MACnBN,KAAKL,WAAaW,CACnB,CAOAC,cAAcC,EAAO,MACpBR,KAAKJ,WAAaY,CACnB,CAOAC,QACC,OAAOT,KAAKE,MACb,CAEAQ,YAAYC,GACXX,MAAKH,EAAUe,IAAID,EACpB,CAEAE,eAAeF,GACdX,MAAKH,EAAUiB,OAAOd,MAAKH,EAAUkB,QAAQJ,GAAI,EAClD,CAEAK,cAAcC,EAAUC,GACvB,IAAIC,GAAS,EAEb,IAAK,MAAMR,KAAKX,MAAKH,EAChBc,EAAEK,cAAcC,EAAUC,KAC7BC,GAAS,GAGX,OAAOA,CACR,EAWD,MAAMC,aAELC,UAAoB,EAEpBC,GACAC,GAAc,EAMdzB,YAAY0B,GACXxB,MAAKsB,EAAgB,IAAIG,MAAMD,GAC/BxB,MAAKsB,EAAcI,KAAKN,cAAaO,EACtC,CAMAJ,aACC,OAAOvB,MAAKuB,CACb,CAOAK,KAAKC,EAAOC,GACP9B,MAAKsB,EAAcO,KAAWT,cAAaO,KAC5C3B,MAAKuB,EAERvB,MAAKsB,EAAcO,GAASC,CAC7B,CAOAC,UACC,OAAO/B,MAAKsB,EAAcU,SAAWhC,MAAKuB,CAC3C,CAOAU,cAAcJ,GACb,OAAO7B,MAAKsB,EAAcO,KAAWT,cAAaO,CACnD,CAMAO,OAAOJ,GACN,IAAK,IAAIK,EAAI,EAAGA,EAAInC,MAAKsB,EAAcU,OAAQG,IAC1CnC,MAAKsB,EAAca,KAAOL,IAC7B9B,MAAKsB,EAAca,GAAKf,cAAaO,IACnC3B,MAAKuB,EAGV,CAKAa,YACCpC,MAAKsB,EAAcI,KAAKN,cAAaO,GACrC3B,MAAKuB,EAAc,CACpB,EAaD,MAAMc,iBAAiB9C,OAEtB+C,GAEAC,IAAY,EAEZzC,YAAY0C,GACXC,MAAMD,GACNxC,MAAKsC,EAAW,IAAIb,MAAMzB,KAAKP,KAAKiD,kBACpC1C,MAAKsC,EAASZ,KAAK,EACpB,CAEAzB,OACC,MAAO,UACR,CAEA0C,GAAgBC,EAASC,GACxB,IAAIC,EAAU,EAEd,IAAK,MAAMC,KAAKH,EAAS,CACxB,MAAMI,EAAQD,EAAEE,QAEhB,IAAIC,EAAS,EACb,IAAK,MAAMC,KAAKJ,EACfG,IAAW,EAAIC,EAAEC,eAAiBpD,MAAKsC,EAASa,EAAEtB,SAEnDwB,EAAK,IAAK,MAAMC,KAAKP,EAAEQ,SAAU,CAChC,GAAIP,IAAUM,EAAG,SACjBP,EAAES,OAAOF,GACT,IAAIG,EAAOP,EACX,IAAK,MAAMC,KAAKJ,EAGf,GAFAU,IAAS,EAAIN,EAAEC,eAAiBpD,MAAKsC,EAASa,EAAEtB,SAE5C4B,EAAOX,EACV,SAASO,EAGPI,EAAOX,GACVA,EAAUW,EACVZ,EAAQa,QACRb,EAAQc,YAAYZ,EAAGO,IACD,IAAZR,GACVD,EAAQc,YAAYZ,EAAGO,EAEzB,CACAP,EAAES,OAAOR,EACV,CACD,CAEAY,GAAwBC,GACvB,MAAMC,EAAM,IAAIC,IAChB,IAAK,MAAMZ,KAAKU,EACf,IAAK,MAAMd,KAAKI,EACfW,EAAIlD,IAAImC,GAGV,OAAOtB,MAAMuC,KAAKF,EACnB,CAEA5D,OACC,MAAM+D,EAA+B,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACnF,IAAI2E,EAAY,EAEhB,IAAK,MAAMvB,KAAK/C,KAAKP,KAAK8E,YACrBxB,EAAEhB,WAAWgB,EAAES,OAAOT,EAAEQ,SAASiB,GAAG,IAGzC,MAAM3B,EAAU,IAAI4B,eAEpB,OAAa,CACZ,MAAMC,EAAK1E,KAAKP,KAAKkF,uBACrB,IAAK3E,KAAKJ,YAAc,IAAMI,KAAKP,KAAKmF,0BAEvC,OADI5E,KAAKR,QAAQqF,QAAQC,IAAI,6CACtB,EAER,GAAI9E,KAAKN,YAAcM,KAAKN,WAAa4E,IAExC,OADItE,KAAKR,QAAQqF,QAAQC,IAAI,qDACtB,EAER,GAAIb,EAAUG,KAAKC,MAElB,OADIrE,KAAKR,QAAQqF,QAAQC,IAAI,sCACtB,EAMR,GAHI9E,KAAKR,QAAQqF,QAAQC,IAAIJ,EAAG1C,OAAS,eACzChC,MAAK2C,EAAgB3C,MAAK4D,EAAwBc,GAAK7B,GAEnD,EAAIA,EAAQrB,OAAQ,CACvB,MAAMuD,EAAI/E,MAAKuC,EAAYM,EAAQmC,sBAAwBnC,EAAQoC,IAAI,GACvEF,EAAEG,QACFrC,EAAQa,QACJ1D,KAAKR,QAAQqF,QAAQC,IAAI,KAAOC,EACrC,KAAO,CACN,IAAK,IAAI5C,EAAI,EAAGA,EAAIuC,EAAG1C,SAAUG,EAAGnC,MAAKsC,EAASoC,EAAGvC,GAAGN,WACpD7B,KAAKR,QAAQqF,QAAQC,IAAI,WAC9B,CACD,CACD,CAOAK,cAAcC,GACbpF,MAAKuC,EAAY6C,CAClB,EAeD,MAAMC,wBAAwB9F,OAE7B+F,GACAC,GAAO,IAAId,eACXe,GAEAC,IAAU,EAEVnB,GACAL,GAMAnE,YAAY0C,GACXC,MAAMD,GACNxC,MAAKsF,EAAQ,IAAItF,KAAKP,KAAK8E,aAC3B,IAAK,MAAMxB,KAAK/C,MAAKsF,EACpBvC,EAAE2C,aAAe,IAAItE,aAAa2B,EAAEQ,SAAS/B,QAE9CxB,MAAK2F,GACN,CAEA1F,OACC,MAAO,kBACR,CAGA0F,KAEC3F,MAAKwF,EAAW,GAEhB,IAAK,IAAII,EAAI,EAAGA,EAAI5F,MAAKsF,EAAMtD,SAAU4D,EAAG,CAC3C5F,MAAKwF,EAASK,KAAK,IAAIpE,MAAMzB,MAAKsF,EAAMtD,SAExC,IAAK,IAAIG,EAAI,EAAGA,EAAInC,MAAKsF,EAAMtD,SAAUG,EACpCA,EAAIyD,IACP5F,MAAKwF,EAASI,GAAGzD,GAAKnC,KAAKP,KAAKqG,mBAAmB9F,MAAKsF,EAAMnD,GAAInC,MAAKsF,EAAMM,IAGhF,CACD,CAGAG,GAAuB5D,EAAGyD,GACzB,OAAIzD,EAAIyD,EACA5F,MAAKwF,EAASI,GAAGzD,GAElBnC,MAAKwF,EAASrD,GAAGyD,EACzB,CAGAI,GAAclE,EAAOmE,GACpB,IAAK,MAAMC,KAAOlG,MAAKsF,EAAO,CAC7B,IAAKY,EAAInE,UAAW,SACpB,MAAMoE,EAAOD,EAAI3C,SACX6C,EAAOF,EAAIR,aACXW,EAAOrG,MAAK+F,EAAuBE,EAAcC,EAAIrE,SAE3D,IAAK,MAAMsB,KAAKkD,EACf,GAA8B,IAA1BlD,EAAEmD,oBAAN,CAEA,IAAK,IAAIC,EAAI,EAAGC,EAAIL,EAAI3E,OAAQ+E,EAAIC,IAAKD,EACpCH,EAAKnE,cAAcsE,KACvBL,EAAI1C,OAAO2C,EAAI3B,GAAG+B,IAEM,IAApBpD,EAAEC,eACLgD,EAAKxE,KAAK2E,EAAGzE,IAIf,GADAoE,EAAIxC,QACA0C,EAAKrE,UAAW,OAAO,CAXM,CAanC,CACA,OAAO,CACR,CAGA0E,KACC,IAAI5E,EAAQ,EACRL,EAAQ0C,OAAOC,UAEnB,IAAK,IAAIhC,EAAI,EAAGA,EAAInC,MAAKsF,EAAMtD,SAAUG,EAAG,CAC3C,MAAMY,EAAI/C,MAAKsF,EAAMnD,GACrB,IAAKY,EAAEhB,UAAW,SAClB,MACM2E,EADI3D,EAAEQ,SACA/B,OAASuB,EAAE2C,aAAanE,aAChCmF,EAAIlF,IACPA,EAAQkF,EACR7E,EAAQM,EAEV,CACA,OAAON,CACR,CAGA8E,GAAQ7E,GACP,GAAI9B,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAE7C,OADItE,KAAKR,QAAQqF,QAAQC,IAAI,qDACtB,EAER,GAAI9E,MAAKiE,EAAWG,KAAKC,MAExB,OADIrE,KAAKR,QAAQqF,QAAQC,IAAI,sCACtB,EAGR,GAAIhD,IAAU9B,KAAKP,KAAKmH,eAEvB,OADA5G,MAAKuF,EAAKsB,WAAW7G,KAAKP,OACnB,EAER,MAAMqH,EAAW9G,MAAKyF,EAAUzF,MAAKyG,IAA4B3E,EAC3D4C,EAAW1E,MAAKsF,EAAMwB,GACtBxD,EAAWoB,EAAGnB,SACdwD,EAAWrC,EAAGgB,aACpB,IAAK,IAAIvD,EAAI,EAAGqE,EAAIlD,EAAE9B,OAAQW,EAAIqE,IAAKrE,EACtC,IAAI4E,EAAG9E,cAAcE,GAArB,CAEA,GADAuC,EAAGlB,OAAOF,EAAEkB,GAAGrC,IACXnC,MAAKgG,EAAclE,EAAOgF,IAAa9G,MAAK2G,EAAQ7E,EAAQ,GAAI,OAAO,EAC3E,IAAK,MAAMiB,KAAK/C,MAAKsF,EACpBvC,EAAE2C,aAAaxD,OAAOJ,EAJE,CAQ1B,OADA4C,EAAGhB,SACI,CACR,CAGAxD,OACCF,MAAKiE,EAAkC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACrFK,MAAKsE,EAAa,EAElBtE,KAAKP,KAAKuH,oBACV,MAAMC,EAAIjH,MAAK2G,EAAQ,GAEvB,IAAK,IAAIxE,EAAI,EAAGA,EAAInC,MAAKuF,EAAK/D,SAAUW,EAAG,CAC1C,MAAM+E,EAAIlH,MAAKuF,EAAKN,IAAI9C,GACxB+E,EAAEhC,QACFgC,EAAEC,WAAWzB,aAAatD,WAC3B,CACA,OAAO6E,CACR,CAKA1G,gBACC,CASD6G,yCAAyChC,GACxCpF,MAAKyF,EAAUL,CAChB,EAaD,MAAMiC,2BAA2B9H,OAEhC+F,GACAC,GAAO,IAAId,eAEX6C,GACAC,GACAC,GAAe,IAAIzD,IACnB0D,GAAQ,GAERnD,GACAL,GAEAnE,YAAY0C,GACXC,MAAMD,GACNxC,MAAKsF,EAAQ,IAAItF,KAAKP,KAAK8E,aAC3B,IAAK,MAAMxB,KAAK/C,MAAKsF,EACpBvC,EAAE2C,aAAe,IAAItE,aAAa2B,EAAEQ,SAAS/B,QAE9CxB,MAAKsH,EAAetH,KAAKP,KAAKiD,gBAC/B,CAEAzC,OACC,MAAO,+BACR,CAEA0G,GAAQ7E,EAAOyF,GACd,GAAIvH,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAAc,OAAO,EACnE,GAAItE,MAAKiE,EAAWG,KAAKC,MAAO,OAAO,EAEvC,GAAIvC,IAAU9B,KAAKP,KAAKmH,eAAgB,CACvC,MAAMc,EAAM1H,KAAKP,KAAKkI,0BACtB,OAAID,EAAM1H,MAAKsH,IACdtH,MAAKsH,EAAeI,EACpB1H,MAAKuF,EAAKsB,WAAW7G,KAAKP,MACtBO,KAAKR,QAAQqF,QAAQC,IAAK,gBAAe9E,MAAKsH,MAC7CtH,KAAKJ,YAAc,IAAMI,KAAKP,KAAKmF,0BAG1C,CACA,MAAMF,EAAM1E,MAAKsF,EAAMxD,GACjB8F,EAAMlD,EAAGnB,SACTwD,EAAMrC,EAAGgB,aAEf,IAAK,IAAIvD,EAAI,EAAGA,EAAIyF,EAAIpG,SAAUW,EACjC,KAAI4E,EAAG9E,cAAcE,KACrBuC,EAAGlB,OAAOoE,EAAIpD,GAAGrC,IACjBnC,MAAKuH,EAAYA,EAAWvH,MAAK6H,EAA6B/F,EAAO4C,GACjE1E,MAAKuH,EAAYvH,MAAKsH,IAA1B,CACA,GAAItH,MAAKgG,EAAclE,IAAU9B,MAAK2G,EAAQ7E,EAAQ,EAAG9B,MAAKuH,GAAY,OAAO,EACjF,IAAK,MAAMxE,KAAK/C,MAAKsF,EACpBvC,EAAE2C,aAAaxD,OAAOJ,EAHiB,CAOzC,OADA4C,EAAGhB,SACI,CACR,CAGAsC,GAAclE,GACb,MAAM4C,EAAK1E,MAAKsF,EAAMxD,GAEtB,IAAK,IAAIK,EAAIL,EAAQ,EAAGK,EAAInC,MAAKsF,EAAMtD,SAAUG,EAAG,CACnD,MAAM2F,EAAS9H,MAAKsF,EAAMnD,GAC1BnC,MAAKyH,EAAQzH,KAAKP,KAAKqG,mBAAmBpB,EAAIoD,GAE9C,IAAK,MAAM3E,KAAKnD,MAAKyH,EACpB,GAA8B,IAA1BtE,EAAEmD,qBACFtG,MAAK+H,EAAQD,EAAQ3E,EAAGrB,IACvBgG,EAAOpC,aAAa3D,UAAW,OAAO,CAG7C,CACA,OAAO,CACR,CAGA8F,GAA6B/F,EAAO4C,GACnC,IAAIsD,EAAM,EACVhI,MAAKwH,EAAa9D,QAClB,IAAK,IAAIvB,EAAI,EAAGA,EAAIL,IAASK,EAAG,CAC/BnC,MAAKyH,EAAQzH,KAAKP,KAAKqG,mBAAmBpB,EAAI1E,MAAKsF,EAAMnD,IAEzD,IAAK,MAAMgB,KAAKnD,MAAKyH,EAChBzH,MAAKwH,EAAaS,IAAI9E,KACF,IAApBA,EAAEC,iBAAuB4E,EAC7BhI,MAAKwH,EAAa5G,IAAIuC,GAExB,CACA,OAAO6E,CACR,CAGAD,GAAQG,EAAI/E,EAAGrB,GACd,IAAIqG,GAAU,EAEd,MAAMP,EAAMM,EAAG3E,SACTwD,EAAMmB,EAAGxC,aAEf,IAAK,IAAIvD,EAAI,EAAGA,EAAIyF,EAAIpG,SAAUW,EAC7B4E,EAAG9E,cAAcE,KACrB+F,EAAG1E,OAAOoE,EAAIpD,GAAGrC,IAEO,IAApBgB,EAAEC,eAAuBpD,MAAKuH,EAAY,EAAIvH,MAAKsH,IACtDP,EAAGnF,KAAKO,EAAGL,GACXqG,GAAU,IAGZ,OAAOA,CACR,CAEAjI,OACCF,MAAKiE,EAAkC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACrFK,MAAKsE,EAAa,EAElBtE,KAAKP,KAAKuH,oBACV,MAAMC,EAAIjH,MAAK2G,EAAQ,EAAG,GACtB3G,KAAKR,SACJyH,EACHpC,QAAQC,IAAI,6CAER9E,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,GAC7CO,QAAQC,IAAI,oDAET9E,MAAKiE,EAAWG,KAAKC,OACxBQ,QAAQC,IAAI,uCAKf,IAAK,IAAI3C,EAAI,EAAGA,EAAInC,MAAKuF,EAAK/D,SAAUW,EAAG,CAC1C,MAAM+E,EAAIlH,MAAKuF,EAAKN,IAAI9C,GACxB+E,EAAEhC,QACFgC,EAAEC,WAAWzB,aAAatD,WAC3B,CACA,OAAO6E,CACR,EAaD,MAAMmB,cAAc7I,OAEnB8B,eAAegH,GACd,OAAOC,KAAKC,MAAMD,KAAKE,SAAWF,KAAKC,MAAMF,GAC9C,CAEAI,GAAY,GACZC,GAEA5I,YAAY0C,GAEX,GADAC,MAAMD,IACDxC,MAAK2I,IACT,MAAM,IAAIC,SAEZ,CAEA3I,OACC,MAAO,OACR,CAEA0I,KACK3I,KAAKR,QAAQqF,QAAQC,IAAI,0BAC7B,MAAM2C,EAAO,GAEb,IAAK,MAAM1E,KAAK/C,KAAKP,KAAK8E,YAAa,CACtC,GAA0B,IAAtBxB,EAAEQ,SAAS/B,OAAc,OAAO,EACpCxB,MAAKyI,EAAU5C,KAAK,IAAIuC,MAAMS,QAAQ9F,GACvC,CACA,IAAK,MAAMI,KAAKnD,KAAKP,KAAKqJ,cACzB,GAAiB,IAAb3F,EAAE3B,OAAc,CACnB,MAAMuB,EAAKI,EAAEqB,GAAG,GACVuE,EAAK/I,MAAKyI,EAAUtF,EAAEqB,GAAG,GAAG3C,SAElC,IAAK,IAAIM,EAAI,EAAGA,EAAI4G,EAAGvH,SAAUW,EAAG,CACnC,MAAM6G,EAAUjG,EAAEE,QAClBF,EAAES,OAAOuF,EAAG9D,IAAI9C,GAAG8G,QAEK,IAApB9F,EAAEC,eACLqE,EAAK5B,KAAK,IAAIuC,MAAMc,WAAWH,EAAG9D,IAAI9C,KAEvCY,EAAES,OAAOwF,EACV,CACD,KAAO,CACN,MAAMd,EAAO/E,EAAEqB,GAAG,GACZ2E,EAAOhG,EAAEqB,GAAG,GACZ4E,EAAOpJ,MAAKyI,EAAUtF,EAAEqB,GAAG,GAAG3C,SAC9BwH,EAAOrJ,MAAKyI,EAAUtF,EAAEqB,GAAG,GAAG3C,SAEpC,IAAK,IAAIM,EAAI,EAAGA,EAAIiH,EAAK5H,SAAUW,EAAG,CACrC,MAAMmH,EAAWpB,EAAGjF,QACpBiF,EAAG1E,OAAO4F,EAAKnE,IAAI9C,GAAG8G,QAEtB,IAAK,IAAIrD,EAAI,EAAGA,EAAIyD,EAAK7H,SAAUoE,EAAG,CACrC,MAAM2D,EAAWJ,EAAGlG,QACpBkG,EAAG3F,OAAO6F,EAAKpE,IAAIW,GAAGqD,QAEE,IAApB9F,EAAEC,eACLqE,EAAK5B,KAAK,IAAIuC,MAAMc,WAAWE,EAAKnE,IAAI9C,GAAIkH,EAAKpE,IAAIW,KAEtDuD,EAAG3F,OAAO+F,EACX,CACArB,EAAG1E,OAAO8F,EACX,CACD,CAED,IAAK,MAAMP,KAAM/I,MAAKyI,EACrB,IAAK,MAAMjC,KAAKuC,EAAGS,SAAUhD,EAAEiD,kBAIhC,OAFAzJ,MAAK0I,EAAejB,EAChBzH,KAAKR,QAAQqF,QAAQC,IAAI,8BACtB,CACR,CAEA4E,GAASC,GACR,IAAK,IAAIxH,EAAIwH,EAAG3H,OAAQG,EAAI,IAAKA,EAAG,CACnC,MAAMyD,EAAOwC,MAAMwB,QAAQzH,GACrB0H,EAAOF,EAAGxH,EAAI,GACpBwH,EAAGxH,EAAI,GAAKwH,EAAG/D,GACf+D,EAAG/D,GAASiE,CACb,CACA,OAAOF,CACR,CAEAzJ,OACC,MAAM+D,EAA+B,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACnF,IAAI2E,EAAY,EAEhB,MAAMiB,EAAQ,IAAId,eACZqF,EAAQ,GACd,IAAK,IAAI3H,EAAI,EAAGA,EAAInC,MAAKyI,EAAUzG,OAAQG,IAC1C2H,EAAMjE,KAAK1D,GAGZ,IAAI4H,EAAM/J,KAAKP,KAAKmF,0BAEpB,OAAa,CACZ,GAAI5E,KAAKN,YAAcM,KAAKN,WAAa4E,IAAa,CACjDtE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B,KACD,CACA,GAAIb,EAAUG,KAAKC,MAAO,CACrBrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B,KACD,CAEA,IAAIkF,GAAW,EACf,IAAK,MAAM7H,KAAKnC,MAAK0J,EAASI,GACzB9J,MAAKyI,EAAUtG,GAAG8H,4BACrBD,GAAW,GAGb,GAAKA,EAIE,CACN,IAAK,MAAME,KAAOlK,MAAKyI,EACtByB,EAAIC,kBAEL,MAAM7G,EAAItD,KAAKP,KAAKmF,0BACpB,GAAImF,EAAMzG,IACTyG,EAAMzG,EACFtD,KAAKR,QAAQqF,QAAQC,IAAK,8BAA6BxB,KAC3DiC,EAAIsB,WAAW7G,KAAKP,MAChBO,KAAKJ,YAAc,GAAKmK,GAG3B,OAFI/J,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7BS,EAAIL,SACG,CAGV,MAlBC,IAAK,MAAMkF,KAAOpK,MAAK0I,EACtB0B,EAAIC,eAkBP,CAEA,OADA9E,EAAIL,SACG,CACR,EAID,CAEC,MAAM2D,EAELxH,eAAegH,GACd,OAAOC,KAAKC,MAAMD,KAAKE,SAAWF,KAAKC,MAAMF,GAC9C,CAEAiC,GACAzI,GACA0I,GAAc,GACdf,SAAc,GAEd1J,YAAYiD,GACX/C,MAAKsK,EAAOvH,EAEZ,IAAK,MAAMyH,KAAOzH,EAAEQ,SACnBvD,KAAKwJ,SAAS3D,KAAK,IAAI4E,EAAOD,IAE/BxK,MAAK0K,EAAa7B,EAAQe,QAAQ5J,KAAKwJ,SAASxH,QACjD,CAEA0I,GAAa7I,GACZ,IAAK,MAAM2E,KAAKxG,KAAKwJ,SACpBhD,EAAEmE,WAAY,EAEf3K,KAAKwJ,SAAS3H,GAAO8I,WAAY,EACjC3K,MAAK6B,EAASA,CACf,CAEAsI,kBACCnK,MAAKsK,EAAK9G,OAAOxD,KAAKwJ,SAASxJ,MAAK6B,GAAQoH,OAC7C,CAEAhE,IAAIpD,GACH,OAAO7B,KAAKwJ,SAAS3H,EACtB,CAEA+I,UACC,OAAO5K,KAAKwJ,QACb,CAGAS,0BACCjK,MAAKuK,EAAYvI,OAAS,EAE1B,IAAIqG,EAAYnE,OAAO2G,kBACnBC,GAAY,EAEhB,IAAK,IAAI3I,EAAI,EAAGA,EAAInC,KAAKwJ,SAASxH,SAAUG,EAAG,CAC9C,MAAM4I,EAAQ/K,KAAKwJ,SAASrH,GAAG6I,WAE3B3C,GAAO0C,IACN1C,EAAM0C,IACT1C,EAAM0C,EACN/K,MAAKuK,EAAYvI,OAAS,EAC1B8I,GAAY,GAEb9K,MAAKuK,EAAY1E,KAAK1D,GAClBnC,MAAK6B,IAAWM,IACnB2I,GAAY,GAGf,CACA,OAAIA,GAAyC,IAA5B9K,MAAKuK,EAAYvI,SAGlChC,MAAK0K,EAAa1K,MAAKuK,EAAY1B,EAAQe,QAAQ5J,MAAKuK,EAAYvI,WAC7D,EACR,CAEAR,OACC,OAAOxB,KAAKwJ,SAASxH,MACtB,EAGDoG,MAAMS,QAAUA,EAEhB,MAAMK,EAEL+B,GACAC,GACAC,QAGArL,YAAYmL,EAAOC,EAAS,MAC3BlL,KAAKmL,SAAW,EAEhBnL,MAAKiL,EAASA,EACdjL,MAAKiL,EAAOG,cAAcpL,MAC1BA,MAAKkL,EAAUA,EACM,OAAjBlL,MAAKkL,GACRlL,MAAKkL,EAAQE,cAAcpL,KAE7B,CAEAqL,UAAUC,GACT,OAAIA,IAAStL,MAAKiL,EAAgBjL,MAAKkL,EACnCI,IAAStL,MAAKkL,EAAgBlL,MAAKiL,EAChC,IACR,CAEAZ,gBACMrK,MAAKiL,EAAON,YAA+B,OAAjB3K,MAAKkL,GAAqBlL,MAAKkL,EAAQP,aAGtE3K,KAAKmL,UAAY,EAClB,EAGD/C,MAAMc,WAAaA,EAEnB,MAAMuB,EAELc,GAAW,GACX7C,GACAO,OACA0B,WAAY,EAEZ7K,YAAYmD,GACXjD,KAAKiJ,OAAShG,CACf,CAEAmI,cAAcjI,GACbnD,MAAKuL,EAAS1F,KAAK1C,EACpB,CAEAsG,kBACCzJ,MAAK0I,EAAe,IAAI1I,MAAKuL,GAC7BvL,MAAKuL,EAAe,IACrB,CAEAP,WACC,IAAIQ,EAAM,EACV,IAAK,MAAMrI,KAAKnD,MAAK0I,EAAc,CAClC,MAAMlC,EAAIrD,EAAEkI,UAAUrL,MACtBwL,GAAOrI,EAAEgI,SAAkB,OAAN3E,GAAcA,EAAEmE,UAAa,EAAI,EACvD,CACA,OAAOa,CACR,EAGDpD,MAAMqC,OAASA,CAEhB,CASA,MAAMgB,qBAAqBlM,OAE1B8B,SAAmBqK,EAAIC,GACtB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGhL,IAAImC,GAC3B,OAAO6I,CACR,CAEAvK,SAAoBqK,EAAIC,GACvB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGC,OAAO9I,GAC9B,OAAO6I,CACR,CAEAvK,SAAuBqF,EAAG3B,GACzB,MAAM6G,EAAK,IAAI7H,IAAI2C,GAEnB,OADAkF,EAAGhL,IAAImE,GACA6G,CACR,CAEAvK,SAAwBqF,EAAG3B,GAC1B,MAAM6G,EAAK,IAAI7H,IAAI2C,GAEnB,OADAkF,EAAGC,OAAO9G,GACH6G,CACR,CAEAtH,GACAL,GACA6H,GAEAhM,YAAY0C,EAAGuJ,GAAc,GAC5BtJ,MAAMD,GACFuJ,GACH/L,KAAKP,KAAKuH,mBAEZ,CAEA/G,OACC,MAAO,eACR,CAEA+L,GAAaC,EAAOlJ,EAAGyH,GACtB,MAAM0B,EAAQ,IAAInI,IACZsC,EAAQ,IAAItC,IAElB,IAAK,MAAMoI,KAAMF,EAAO,CACvB,MAAMpC,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAGoJ,GAC7C,IAAK,MAAMhJ,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,MAAM6F,EAAUjG,EAAEE,QAClBF,EAAES,OAAOgH,GAET,IAAK,MAAMrH,KAAKkD,EACf,GAAwB,IAApBlD,EAAEC,cACL,IAAK,MAAMgJ,KAAMjJ,EAChB+I,EAAMtL,IAAIwL,GAMb,OAFArJ,EAAES,OAAOwF,GACTkD,EAAML,OAAO9I,GACNmJ,CACR,CAEAG,GAAcC,EAAGvJ,EAAGyH,GACnB,MAAMnE,EAAK,IAAItC,IAEf,IAAK,MAAMoI,KAAMG,EAAG,CACnB,MAAMzC,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAGoJ,GAC7C,IAAK,MAAMhJ,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,MAAM6F,EAAUjG,EAAEE,QAClBF,EAAES,OAAOgH,GAET,IAAK,MAAMrH,KAAKkD,EACf,GAAwB,IAApBlD,EAAEC,cAEL,OADAL,EAAES,OAAOwF,IACF,EAIT,OADAjG,EAAES,OAAOwF,IACF,CACR,CAEAuD,GAASC,EAAIC,EAAI1J,EAAGyH,GACnB,IAAKxK,MAAKqM,EAAcG,EAAIzJ,EAAGyH,GAC9B,OAAO,EAER,MAAMyB,EAAQR,cAAaiB,EAAYF,EAAIC,GAC3C,GAAIzM,MAAKqM,EAAcJ,EAAOlJ,EAAGyH,GAChC,OAAO,EAER,MAAMmC,EAAK3M,MAAKgM,EAAaC,EAAOlJ,EAAGyH,GAEjCoC,EAAInB,cAAaoB,EAAaZ,EAAOU,GACtC3M,MAAKqM,EAAcO,EAAG7J,EAAGyH,IACzBxK,KAAKR,QAAQqF,QAAQC,IAAI,OAG9B,IAAK,MAAMgI,KAAMH,EAChBG,EAAGpJ,QAIJ,OAFA8I,EAAKf,cAAasB,EAAgBP,EAAIzJ,GACtC0J,EAAKhB,cAAaoB,EAAaJ,EAAIE,GAC5B3M,MAAKgN,EAAaR,EAAIC,EAAIE,EAClC,CAEAM,GAAYT,EAAIC,EAAI1J,EAAGO,GACtB,GAAe,IAAXA,EAAE9B,KACL,OAAO,EAER,MAAMgJ,EAAMlH,EAAE4J,SAASC,OAAOlK,MACvBmK,EAAK3I,eAAe4I,cAAcZ,GACzC1J,EAAES,OAAOgH,GAET,MAAMgB,EAAMxL,MAAKuM,EAASC,EAAIC,EAAI1J,EAAGyH,GACrC,OAAIgB,GAAOxL,MAAK8L,EACRN,GAGRzI,EAAEW,QACF0J,EAAGlI,QAEIlF,MAAKiN,EAAYT,EAAIC,EAAI1J,EAAG0I,cAAa6B,EAAiBhK,EAAGkH,IACrE,CAEAwC,GAAaR,EAAIC,EAAIE,GAIpB,GAHI3M,KAAKR,QACRqF,QAAQC,IAAK,MAAK0H,EAAGhL,aAAaiL,EAAGjL,aAAamL,EAAGnL,SAEjDxB,KAAKJ,YAAc,IAAMI,KAAKP,KAAKmF,0BAGvC,OAFI5E,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7B9E,MAAK8L,GAAgB,GACd,EAER,GAAI9L,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAG7C,OAFItE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B9E,MAAK8L,GAAgB,GACd,EAER,GAAI9L,MAAKiE,EAAWG,KAAKC,MAGxB,OAFIrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B9E,MAAK8L,GAAgB,GACd,EAGR,GAAgB,IAAZa,EAAGnL,KACN,OAAO,EAER,MAAMuB,EAAI4J,EAAGO,SAASC,OAAOlK,MACvBK,EAAI,IAAIS,IACd,IAAK,MAAMyG,KAAOzH,EAAEQ,SACnBD,EAAE1C,IAAI4J,GAGP,MAAMgB,EAAMxL,MAAKiN,EAAYT,EAAIC,EAAI1J,EAAGO,GACxC,OAAKkI,GAAOxL,MAAK8L,EACTN,GAERiB,EAAKhB,cAAasB,EAAgBN,EAAI1J,GACtC4J,EAAKlB,cAAa6B,EAAiBX,EAAI5J,GAChC/C,MAAKgN,EAAaR,EAAIC,EAAIE,GAClC,CAEAzM,OACCF,MAAKiE,EAAqC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACxFK,MAAKsE,EAAgB,EACrBtE,MAAK8L,GAAgB,EAEiB,IAAlC9L,KAAKP,KAAK6G,qBACbtG,KAAKP,KAAKuH,oBAEX,MAAMuG,EAAa,IAAIxJ,IACjByJ,EAAa,IAAIzJ,IACvB,IAAK,MAAMhB,KAAK/C,KAAKP,KAAK8E,aACvBxB,EAAEhB,UAAuByL,EAAXD,GAAuB3M,IAAImC,GAE5C,OAAO/C,MAAKgN,EAAa,IAAIjJ,IAAOwJ,EAAUC,EAC/C,EAYD,MAAMC,uBAAuBlO,OAE5B8B,SAAmBqK,EAAIC,GACtB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGhL,IAAImC,GAC3B,OAAO6I,CACR,CAEAvK,SAAoBqK,EAAIC,GACvB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGC,OAAO9I,GAC9B,OAAO6I,CACR,CAEAvK,SAAuBqF,EAAG3B,GACzB,MAAM6G,EAAK,IAAI7H,IAAI2C,GAEnB,OADAkF,EAAGhL,IAAImE,GACA6G,CACR,CAEAvK,SAAwBqF,EAAG3B,GAC1B,MAAM6G,EAAK,IAAI7H,IAAI2C,GAEnB,OADAkF,EAAGC,OAAO9G,GACH6G,CACR,CAEAtH,GACAL,GACA6H,GAEAhM,YAAY0C,EAAGuJ,GAAc,GAC5BtJ,MAAMD,GACFuJ,GACH/L,KAAKP,KAAKuH,mBAEZ,CAEA/G,OACC,MAAO,kBACR,CAEA+L,GAAaC,EAAOlJ,EAAGyH,GACtB,MAAM0B,EAAQ,IAAInI,IACZsC,EAAQ,IAAItC,IAElB,IAAK,MAAMoI,KAAMF,EAAO,CACvB,MAAMpC,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAGoJ,GAC7C,IAAK,MAAMhJ,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,MAAM6F,EAAUjG,EAAEE,QAClBF,EAAES,OAAOgH,GAET,IAAK,MAAMrH,KAAKkD,EACf,GAAwB,IAApBlD,EAAEC,cACL,IAAK,MAAMgJ,KAAMjJ,EAChB+I,EAAMtL,IAAIwL,GAMb,OAFArJ,EAAES,OAAOwF,GACTkD,EAAML,OAAO9I,GACNmJ,CACR,CAEAG,GAAcC,EAAGvJ,EAAGyH,GACnB,MAAMnE,EAAK,IAAItC,IAEf,IAAK,MAAMoI,KAAMG,EAAG,CACnB,MAAMzC,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAGoJ,GAC7C,IAAK,MAAMhJ,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,MAAM6F,EAAUjG,EAAEE,QAClBF,EAAES,OAAOgH,GAET,IAAK,MAAMrH,KAAKkD,EACf,GAAwB,IAApBlD,EAAEC,cAEL,OADAL,EAAES,OAAOwF,IACF,EAIT,OADAjG,EAAES,OAAOwF,IACF,CACR,CAEAuD,GAASC,EAAIC,EAAI1J,GAChB,IAAK/C,MAAKqM,EAAcG,EAAIzJ,EAAGA,EAAEE,SAChC,OAAO,EAER,MAAMgJ,EAAQwB,gBAAef,EAAYF,EAAIC,GAC7C,GAAIzM,MAAKqM,EAAcJ,EAAOlJ,EAAGA,EAAEE,SAClC,OAAO,EAER,MAAM0J,EAAK3M,MAAKgM,EAAaC,EAAOlJ,EAAGA,EAAEE,SAIzC,OAFAwJ,EAAKgB,gBAAeZ,EAAaJ,EAAIE,GACrCH,EAAKiB,gBAAeV,EAAgBP,EAAIzJ,GACjC/C,MAAKgN,EAAaR,EAAIC,EAAIE,EAClC,CAEAM,GAAYT,EAAIC,EAAI1J,GACnB,IAAK,MAAMyH,KAAOzH,EAAEQ,SAAU,CAC7B,MAAMmD,EAAIjC,eAAe4I,cAAcZ,GACvC1J,EAAES,OAAOgH,GAET,MAAMgB,EAAMxL,MAAKuM,EAASC,EAAIC,EAAI1J,GAClC,GAAIyI,GAAOxL,MAAK8L,EACf,OAAON,EAGRzI,EAAEW,QACFgD,EAAExB,OACH,CACA,OAAO,CACR,CAEA8H,GAAaR,EAAIC,EAAIE,GAIpB,IAHAF,EAAK,IAAI1I,IAAI0I,GACbE,EAAK,IAAI5I,IAAI4I,KAEA,CAIZ,GAHI3M,KAAKR,QACRqF,QAAQC,IAAK,MAAK0H,EAAGhL,aAAaiL,EAAGjL,aAAamL,EAAGnL,SAEjDxB,KAAKJ,YAAc,IAAMI,KAAKP,KAAKmF,0BAGvC,OAFI5E,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7B9E,MAAK8L,GAAgB,GACd,EAER,GAAI9L,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAG7C,OAFItE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B9E,MAAK8L,GAAgB,GACd,EAER,GAAI9L,MAAKiE,EAAWG,KAAKC,MAGxB,OAFIrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B9E,MAAK8L,GAAgB,GACd,EAGR,GAAgB,IAAZa,EAAGnL,KACN,OAAO,EAER,MAAMuB,EAAM4J,EAAGO,SAASC,OAAOlK,MACzBuI,EAAMxL,MAAKiN,EAAYT,EAAIC,EAAI1J,GAErC,IAAKyI,GAAOxL,MAAK8L,EAChB,OAAON,EAERiB,EAAG7L,IAAImC,GACP4J,EAAGd,OAAO9I,EACX,CACD,CAEA7C,OACCF,MAAKiE,EAAqC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACxFK,MAAKsE,EAAgB,EACrBtE,MAAK8L,GAAgB,EAEiB,IAAlC9L,KAAKP,KAAK6G,qBACbtG,KAAKP,KAAKuH,oBAEX,MAAMuG,EAAa,IAAIxJ,IACjByJ,EAAa,IAAIzJ,IACvB,IAAK,MAAMhB,KAAK/C,KAAKP,KAAK8E,aACvBxB,EAAEhB,UAAuByL,EAAXD,GAAuB3M,IAAImC,GAE5C,OAAO/C,MAAKgN,EAAa,IAAIjJ,IAAOwJ,EAAUC,EAC/C,EAaD,MAAME,kBAAkBnO,OAEvBoO,GAAuB,IAAI5J,IAC3B6J,GAAuB,IAAI7J,IAC3B8J,GAAuB,GACvBC,GAAuB,GAEvBvL,IAAY,EAEZzC,YAAY0C,GACXC,MAAMD,GACN,IAAK,MAAMW,KAAKnD,KAAKP,KAAKqJ,cACzB9I,MAAK6N,EAAOhI,KAAK,IAAI6H,UAAUK,SAAS5K,IACxCnD,MAAK8N,EAAqBjI,KAAK,KAEjC,CAEA5F,OACC,MAAO,sBACR,CAEA+N,GAAwB7K,GACvB,MAAMtB,EAAQsB,EAAEtB,QAKhB,OAHyC,OAArC7B,MAAK8N,EAAqBjM,KAC7B7B,MAAK8N,EAAqBjM,GAASsB,EAAE8K,aAE/BjO,MAAK8N,EAAqBjM,EAClC,CAEAqM,GAAQC,GACHnO,KAAKR,QAAQqF,QAAQC,IAAI,UAE7B,MAAMsJ,EAAa,IAAI3J,eACvB,IAAI3B,EAAU,EAEd,IAAK,MAAMC,KAAKoL,EAAI,CACnB,MAAMnL,EAAQD,EAAEE,QAEhB,IAAIC,EAAS,EACb,IAAK,MAAMC,KAAKJ,EACfG,GAAW,EAAIC,EAAEC,cAElBC,EAAK,IAAK,MAAMC,KAAKP,EAAEQ,SAAU,CAChC,GAAIP,IAAUM,EAAG,SAEjB,GADAP,EAAES,OAAOF,GACgB,IAArB6K,EAAG/K,cAAqB,SAE5B,IAAIK,EAAOP,EACX,IAAK,MAAMsD,KAAKzD,EAEf,GADAU,GAAS,EAAI+C,EAAEpD,cACXK,EAAOX,EAAS,SAASO,EAE1BI,EAAOX,GACVA,EAAUW,EACV2K,EAAW1K,QACX0K,EAAWzK,YAAYZ,EAAGO,IACJ,IAAZR,GACVsL,EAAWzK,YAAYZ,EAAGO,EAE5B,CACAP,EAAES,OAAOR,EACV,CACA,GAAIoL,EAAW5M,OAAS,EAAG,CAC1B,MAAMuD,EAAI/E,MAAKuC,EAAY6L,EAAWpJ,sBAAwBoJ,EAAWnJ,IAAI,GAG7E,OAFAF,EAAEG,QACElF,KAAKR,QAAQqF,QAAQC,IAAI,KAAOC,IAC7B,CACR,CACA,OAAO,CACR,CAEAsJ,GAAQC,EAAMC,GACb,MAAM1E,EAAO,GACb,IAAIE,EAAMuE,EAEV,OAAa,CACZvE,EAAMA,EAAIyE,SACV3E,EAAK7H,OAAS,EACd+H,EAAI0E,eAAe5E,GACnBE,EAAIrG,QAEJ,IAAK,MAAM8C,KAAK+H,EACfvO,MAAK4N,EAAU/B,OAAOrF,GACtBxG,MAAK2N,EAAY9B,OAAOrF,GAGzB,GAAI+H,EAAQ1C,OAAO9B,GAClB,MAGD,GADA/J,MAAK4N,EAAUhN,IAAImJ,GACE,OAAjBA,EAAIyE,WAAsBxO,MAAKkO,EAAQnE,EAAIyE,SAASE,aACvD,KAEF,CACD,CAEAC,GAAQL,GACHtO,KAAKR,QAAQqF,QAAQC,IAAI,UAC7B9E,MAAK2N,EAAY/M,IAAI0N,GAErB,IAAK,MAAMnL,KAAKnD,MAAKgO,EAAwBM,EAAKI,aAAc,CAC/D,MAAME,EAAM5O,MAAK6N,EAAO1K,EAAEtB,SAErB7B,MAAK2N,EAAY1F,IAAI2G,IAAS5O,MAAK4N,EAAU3F,IAAI2G,KACrDA,EAAIlL,QACJ4K,EAAK1N,IAAIgO,GACT5O,MAAK4N,EAAUhN,IAAIgO,GAErB,CACD,CAEAC,IAAKN,GACAvO,KAAKR,QAAQqF,QAAQC,IAAI,OAC7B,MAAMb,EAA+B,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACnF,IAAI2E,EAAY,EAEhBtE,MAAK2N,EAAYjK,QACjB1D,MAAK4N,EAAUlK,QACf,IAAK,MAAM8C,KAAK+H,EACfvO,MAAK4N,EAAUhN,IAAI4F,GAGpB,KAAO+H,EAAQ/M,MAAQxB,MAAK4N,EAAUpM,MAAM,CAC3C,IAAKxB,KAAKJ,YAAc,IAAMI,KAAKP,KAAKmF,0BAEvC,OADI5E,KAAKR,QAAQqF,QAAQC,IAAI,6CACtB,EAER,GAAI9E,KAAKN,YAAcM,KAAKN,WAAa4E,IAExC,OADItE,KAAKR,QAAQqF,QAAQC,IAAI,qDACtB,EAER,GAAIb,EAAUG,KAAKC,MAElB,OADIrE,KAAKR,QAAQqF,QAAQC,IAAI,sCACtB,EAGR,MAAMwJ,EAAOtO,MAAK4N,EAAUV,SAASC,OAAOlK,MAC5CjD,MAAK4N,EAAU/B,OAAOyC,GAElBtO,MAAKkO,EAAQI,EAAKI,aAChBH,EAAQ1C,OAAOyC,KACG,OAAlBA,EAAKE,UAAqBxO,MAAKkO,EAAQI,EAAKE,SAASE,aACxD1O,MAAKqO,EAAQC,EAAMC,GAEnBvO,MAAK2O,EAAQL,IAIftO,MAAK2O,EAAQL,EAEf,CACA,OAAO,CACR,CAEApO,OACC,MAAMwH,EAAU1H,KAAKP,KAAKkF,uBACpB4J,EAAU,IAAIxK,IAEpB,IAAK,MAAMZ,KAAKuE,EAAK,CACpB,MAAMkH,EAAM5O,MAAK6N,EAAO1K,EAAEtB,SAC1B0M,EAAQ3N,IAAIgO,EACb,CACA,QAAI5O,MAAK6O,GAAKN,IAGY,IAAnBA,EAAQvM,MAChB,CAOAmD,cAAcC,GACbpF,MAAKuC,EAAY6C,CAClB,EAID,CAEC,MAAM2I,EAELe,IAAY,GACZN,IACAO,IAEAjP,YAAYiP,GACX/O,MAAK+O,GAAOA,CACb,CAEAnO,IAAIoO,GACHA,GAAGR,GAAUxO,KACbA,MAAK8O,GAAUjJ,KAAKmJ,EACrB,CAEAtL,QACC,IAAK,MAAMsL,KAAMhP,MAAK8O,GACrBE,GAAGR,GAAU,KAEdxO,MAAK8O,GAAU9M,OAAS,CACzB,CAEAyM,eAAeQ,GACdA,EAAIpJ,KAAK7F,MAET,IAAK,MAAMgP,KAAMhP,MAAK8O,GACrBE,EAAGP,eAAeQ,EAEpB,CAEAP,YACC,OAAO1O,MAAK+O,EACb,CAEAP,SACC,OAAOxO,MAAKwO,EACb,EAGDd,UAAUK,SAAWA,CAEtB,CAUA,MAAMmB,sBAAsB3P,OAE3B+C,GACA6M,IAEA5M,IAAY,EAEZzC,YAAY0C,GACXC,MAAMD,GACNxC,MAAKsC,EAAW,IAAIb,MAAMzB,KAAKP,KAAKiD,kBACpC1C,MAAKsC,EAASZ,KAAK,EACpB,CAEAzB,OACC,MAAO,gBACR,CAEAe,gBACC,OAAO,CACR,CAEA2B,GAAgByM,EAAWvM,GAC1B,IAAIC,EAAU,EAEd,IAAK,MAAMC,KAAKqM,EAAW,CAC1B,MAAMpM,EAAQD,EAAEE,QAEhB,IAAIC,EAAS,EACb,IAAK,MAAMC,KAAKJ,EACfG,IAAW,EAAIC,EAAEkM,sBAAwBrP,MAAKsC,EAASa,EAAEtB,SAE1DwB,EAAK,IAAK,MAAMC,KAAKP,EAAEQ,SAAU,CAChC,GAAIP,IAAUM,EAAG,SACjBP,EAAES,OAAOF,GACT,IAAIG,EAAOP,EACX,IAAK,MAAMC,KAAKJ,EAGf,GAFAU,IAAS,EAAIN,EAAEkM,sBAAwBrP,MAAKsC,EAASa,EAAEtB,SAEnD4B,EAAOX,EACV,SAASO,EAGPI,EAAOX,GACVA,EAAUW,EACVZ,EAAQa,QACRb,EAAQc,YAAYZ,EAAGO,IACD,IAAZR,GACVD,EAAQc,YAAYZ,EAAGO,EAEzB,CACAP,EAAES,OAAOR,EACV,CACD,CAEAsM,IAAoBC,GACnB,MAAMC,EAAM,IAAIzL,IAChB,IAAK,MAAMZ,KAAKoM,EACf,IAAK,MAAMxM,KAAKI,EAAGqM,EAAI5O,IAAImC,GAE5B,OAAOtB,MAAMuC,KAAKwL,EACnB,CAEAtP,OACC,MAAM+D,EAA+B,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACnF,IAAI2E,EAAY,EAEhB,IAAK,MAAMvB,KAAK/C,KAAKP,KAAK8E,YACrBxB,EAAEhB,WAAWgB,EAAES,OAAOT,EAAEQ,SAASiB,GAAG,IAGzC,MAAMiL,EAAUzP,KAAKP,KAAKiQ,0BACpB7M,EAAU,IAAI4B,eAEdc,EAAM,IAAId,eAEhB,OAAa,CACZ,MAAOC,EAAIiL,GAAO3P,KAAKP,KAAKmQ,yCAC5B,GAAwB,OAApB5P,KAAKJ,YAAuBI,KAAKJ,YAAc+P,EAElD,OADI3P,KAAKR,QAAQqF,QAAQC,IAAI,6CACtB,EAER,GAAI9E,KAAKN,YAAcM,KAAKN,WAAa4E,IAAa,CACjDtE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B,KACD,CACA,GAAIb,EAAUG,KAAKC,MAAO,CACrBrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B,KACD,CAIA,GAFI9E,KAAKR,QAAQqF,QAAQC,IAAI,8BAAgC6K,GAEzD3P,MAAKmP,GAAcQ,IACtBpK,EAAIsB,WAAW7G,KAAKP,MACpBO,MAAKmP,GAAcQ,EACf3O,cAAcuE,EAAKvF,MAAKmP,KAC3B,OAAO,EAMT,GAFAnP,MAAK2C,EAAgB3C,MAAKsP,GAAoB5K,GAAK7B,GAE/C,EAAIA,EAAQrB,OAAQ,CACvB,MAAMuD,EAAI/E,MAAKuC,EAAYM,EAAQmC,sBAAwBnC,EAAQoC,IAAI,GACvEF,EAAEG,QACFrC,EAAQa,QACJ1D,KAAKR,QAAQqF,QAAQC,IAAI,KAAOC,EACrC,KAAO,CACN,IAAK,IAAI5C,EAAI,EAAGA,EAAIuC,EAAG1C,SAAUG,EAAGnC,MAAKsC,EAASoC,EAAGvC,GAAGN,WACpD7B,KAAKR,QAAQqF,QAAQC,IAAI,WAC9B,CACD,CACA,OAAwB,OAApB9E,KAAKJ,YAAuB6P,EAAMzP,KAAKP,KAAKiQ,yBAEjD,CAOAvK,cAAcC,GACbpF,MAAKuC,EAAY6C,CAClB,EAcD,MAAMyK,6BAA6BtQ,OAElC8B,gBAAmB,EACnBA,iBAAmB,EAEnBiE,GACAC,GAAO,IAAId,eACXe,GAEAsK,IAAe,EAEfxL,GACAL,GACAwB,IAAU,EACVsK,IAAU,EAEVC,IACAC,IACAzI,GACA0I,KAAoB,EAOpBpQ,YAAY0C,EAAGkN,EAA0B,MACxCjN,MAAMD,GACNxC,MAAKsF,EAAQ,IAAItF,KAAKP,KAAK8E,aAC3BvE,MAAKgQ,GAAY,IAAIvO,MAAMzB,KAAKP,KAAKmH,gBACrC5G,MAAK2F,IACL3F,MAAKwH,EAAe,IAAI/F,MAAMzB,KAAKP,KAAKiD,kBAExC,MAAMmH,EAAO,GACb,IAAK,MAAM1G,KAAKnD,KAAKP,KAAKqJ,cACR,IAAb3F,EAAE3B,QAAcqI,EAAKhE,KAAK1C,GAE/BnD,MAAKiQ,GAAa,IAAIpG,GAClB6F,IACH1P,MAAK8P,GAAeJ,EAEtB,CAEAzP,OACC,MAAO,iCACR,CAGA0F,KACC3F,MAAKwF,EAAW,GAEhB,IAAK,IAAII,EAAI,EAAGA,EAAI5F,MAAKsF,EAAMtD,SAAU4D,EAAG,CAC3C5F,MAAKwF,EAASK,KAAK,IAAIpE,MAAMzB,MAAKsF,EAAMtD,SAExC,IAAK,IAAIG,EAAI,EAAGA,EAAInC,MAAKsF,EAAMtD,OAAQG,IAClCA,EAAIyD,IACP5F,MAAKwF,EAASI,GAAGzD,GAAKnC,KAAKP,KAAKqG,mBAAmB9F,MAAKsF,EAAMnD,GAAInC,MAAKsF,EAAMM,IAGhF,CACD,CAGAG,GAAuBoK,EAAUC,GAChC,OAAID,EAAWC,EACPpQ,MAAKwF,EAAS4K,GAAUD,GAEzBnQ,MAAKwF,EAAS2K,GAAUC,EAChC,CAGAC,MACC,IAAK,MAAMlN,KAAKnD,MAAKiQ,GAAY,CAChC,MAAMlN,EAASI,EAAEqB,GAAG,GACd8L,EAASvN,EAAEE,QACXK,EAASP,EAAEQ,SACXwD,EAAShE,EAAE2C,aAEjB,IAAK,IAAIvD,EAAI,EAAGqE,EAAIlD,EAAE9B,OAAQW,EAAIqE,IAAKrE,EACtCY,EAAES,OAAOF,EAAEkB,GAAGrC,IACVgB,EAAEkM,sBAAwBrP,MAAK8P,IAClC/I,EAAGnF,KAAKO,GAAI,GAId,GADAY,EAAES,OAAO8M,GACLvJ,EAAGhF,UAAW,OAAO,CAC1B,CACA,OAAO,CACR,CAGAwO,IAAyBzO,EAAOsK,EAAIjJ,GACnC,MAAMqN,EAAMpE,EAAG7I,SACTkN,EAAMrE,EAAG1G,aAEf,IAAK,IAAIvD,EAAI,EAAGqE,EAAIgK,EAAGhP,OAAQW,EAAIqE,IAAKrE,EACnCsO,EAAIxO,cAAcE,KACtBiK,EAAG5I,OAAOgN,EAAGhM,GAAGrC,IACZgB,EAAEkM,sBAAwBrP,MAAK8P,IAClCW,EAAI7O,KAAKO,EAAGL,IAId,OADAsK,EAAG1I,SACK+M,EAAI1O,SACb,CAGA2O,IAA0B5O,EAAOsK,EAAIjJ,GACpC,MAAMqN,EAAMpE,EAAG7I,SACTkN,EAAMrE,EAAG1G,aACTiL,EAAM,KAEZ,IAAK,MAAM5N,KAAKI,EACf,GAAIJ,EAAEhB,WAAagB,IAAMqJ,EAAI,CAC5BuE,EAAK5N,EACL,KACD,CAED,MAAM6N,EAAMD,EAAGpN,SACTsN,EAAMF,EAAGjL,aACfoL,EAAQ,IAAK,IAAI3O,EAAI,EAAG4O,EAAKP,EAAGhP,OAAQW,EAAI4O,IAAM5O,EACjD,IAAIsO,EAAIxO,cAAcE,GAAtB,CACAiK,EAAG5I,OAAOgN,EAAGhM,GAAGrC,IAChB,IAAK,IAAIyD,EAAI,EAAGoL,EAAKJ,EAAGpP,OAAQoE,EAAIoL,IAAMpL,EAAG,CAC5C,GAAIiL,EAAI5O,cAAc2D,GAAI,SAC1B+K,EAAGnN,OAAOoN,EAAGpM,GAAGoB,IAEhB,GADUzC,EAAEkM,qBACJrP,MAAK8P,GAAc,SAASgB,CACrC,CACAL,EAAI7O,KAAKO,EAAGL,EARc,CAY3B,OAFA6O,EAAGjN,QACH0I,EAAG1I,SACK+M,EAAI1O,SACb,CAGAkP,IAA0BnP,EAAOsK,EAAIjJ,GACpC,MAAMqN,EAAMpE,EAAG7I,SACTkN,EAAMrE,EAAG1G,aAEf,IAAIiL,EAAK,KACLO,EAAK,KAET,IAAI,IAAI/O,EAAI,EAAGqE,EAAIrD,EAAE3B,OAAQW,EAAIqE,IAAKrE,EAAG,CACxC,IAAIY,EAAII,EAAEqB,GAAGrC,GACb,GAAIY,EAAEhB,WAAagB,IAAMqJ,EAAI,CAC5B,GAAW,OAAPuE,EAEG,CACNO,EAAKnO,EACL,KACD,CAJC4N,EAAK5N,CAKP,CACD,CACA,MAAM6N,EAAMD,EAAGpN,SACT4N,EAAMD,EAAG3N,SACTsN,EAAMF,EAAGjL,aACT0L,EAAMF,EAAGxL,aAEfoL,EAAQ,IAAI,IAAI3O,EAAI,EAAG4O,EAAKP,EAAGhP,OAAQW,EAAI4O,IAAM5O,EAChD,IAAIsO,EAAIxO,cAAcE,GAAtB,CACAiK,EAAG5I,OAAOgN,EAAGhM,GAAGrC,IAChB,IAAK,IAAIyD,EAAI,EAAGoL,EAAKJ,EAAGpP,OAAQoE,EAAIoL,IAAMpL,EACzC,IAAIiL,EAAI5O,cAAc2D,GAAtB,CACA+K,EAAGnN,OAAOoN,EAAGpM,GAAGoB,IAChB,IAAK,IAAIW,EAAI,EAAG8K,EAAKF,EAAG3P,OAAQ+E,EAAI8K,IAAM9K,EAAG,CAC5C,GAAI6K,EAAInP,cAAcsE,GAAI,SAC1B2K,EAAG1N,OAAO2N,EAAG3M,GAAG+B,IAEhB,GADUpD,EAAEkM,qBACJrP,MAAK8P,GAAc,SAASgB,CACrC,CAP0B,CAS3BL,EAAI7O,KAAKO,EAAGL,EAZc,CAiB3B,OAHAoP,EAAGxN,QACHiN,EAAGjN,QACH0I,EAAG1I,SACK+M,EAAI1O,SACb,CAGAuP,IAA0BxP,EAAOsK,EAAIjJ,EAAGoO,GACvC,MAAMf,EAAMpE,EAAG7I,SACTkN,EAAMrE,EAAG1G,aACT8L,EAAM,IAAI/P,MAAM8P,EAAY,GAClC,IAAI3L,EAAI,EAER,IAAK,IAAIzD,EAAI,EAAGqE,EAAIrD,EAAE3B,OAAQW,EAAIqE,IAAKrE,EAAG,CACzC,MAAMY,EAAII,EAAEqB,GAAGrC,GACZY,EAAEhB,WAAagB,IAAMqJ,IAAIoF,EAAI5L,KAAO7C,EACxC,CACA,MAAM0O,EAAU,IAAIhQ,MAAM+P,EAAIxP,QAE9B8O,EAAQ,IAAK,IAAI3O,EAAI,EAAGqE,EAAIgK,EAAGhP,OAAQW,EAAIqE,IAAKrE,EAC/C,IAAIsO,EAAIxO,cAAcE,GAAtB,CACAiK,EAAG5I,OAAOgN,EAAGhM,GAAGrC,IAChBsP,EAAQ/P,KAAK,GAEbgQ,EAAS,OAAa,CACrB,IAAIC,GAAS,EACb,IAAK,IAAIpL,EAAI,EAAGA,EAAIiL,EAAIxP,SAAUuE,EAAG,CACpC,MAAM4K,EAAMK,EAAIjL,GAAGhD,SAEnB,GADYiO,EAAIjL,GAAGb,aACXzD,cAAcwP,EAAQlL,IAAK,CAClCoL,GAAS,EACT,KACD,CACAH,EAAIjL,GAAG/C,OAAO2N,EAAG3M,GAAGiN,EAAQlL,IAC7B,CACA,IAAKoL,EAAQ,CAEZ,GADUxO,EAAEkM,qBACJrP,MAAK8P,GAAc,SAASgB,CACrC,CACA,IAAK,IAAIvK,EAAI,EAAGA,EAAIiL,EAAIxP,SACvByP,EAAQlL,OACJkL,EAAQlL,GAAKiL,EAAIjL,GAAGhD,SAAS/B,WAFA+E,EAIjC,GADAkL,EAAQlL,GAAK,EACTA,IAAMiL,EAAIxP,OAAS,EAAG,MAAM0P,CAElC,CACAjB,EAAI7O,KAAKO,EAAGL,EA1Bc,CA4B3B,IAAK,MAAMiB,KAAKyO,EAAKzO,EAAEW,QAEvB,OADA0I,EAAG1I,SACK+M,EAAI1O,SACb,CAGAiE,GAAclE,EAAOD,GACpB,IAAK,MAAMqE,KAAQlG,MAAKsF,EAAO,CAC9B,IAAKY,EAAInE,UAAW,SAEpB,MAAMsE,EAAKrG,MAAK+F,EAAuBlE,EAAOqE,EAAIrE,SAElD,IAAK,MAAMsB,KAAKkD,EAAI,CACnB,MAAMkL,EAAYpO,EAAEmD,oBACpB,GAAkB,IAAdiL,GACH,IAAKvR,MAAKuQ,GAAyBzO,EAAOoE,EAAK/C,GAAI,OAAO,OACpD,GAAInD,MAAKkQ,GACf,GAAkB,IAAdqB,GACH,IAAIvR,MAAK0Q,GAA0B5O,EAAOoE,EAAK/C,GAAI,OAAO,OACpD,GAAiB,IAAdoO,GACT,IAAIvR,MAAKiR,GAA0BnP,EAAOoE,EAAK/C,GAAI,OAAO,OACpD,GAAGoO,EAAY,IACjBvR,MAAKsR,GAA0BxP,EAAOoE,EAAK/C,EAAGoO,GAAY,OAAO,CAGxE,CACD,CACA,OAAO,CACR,CAGAK,IAA0BlN,GACzB1E,MAAKwH,EAAa9F,MAAK,GAEvB,IAAK,IAAIS,EAAI,EAAGA,EAAInC,MAAKsF,EAAMtD,SAAUG,EAAG,CAC3C,MAAMiK,EAAKpM,MAAKsF,EAAMnD,GACtB,GAAIiK,IAAO1H,GAAM0H,EAAGrK,UAAW,SAC/B,MAAMsE,EAAKrG,MAAK+F,EAAuBrB,EAAG7C,QAASM,GAEnD,IAAK,MAAMgB,KAAKkD,EAAI,CACnB,GAAIrG,MAAKwH,EAAarE,EAAEtB,SAAU,SAClC,MAAM6E,EAAIvD,EAAEkM,qBACZ,GAAI3I,IAAMmL,WAAWC,WAAapL,GAAK1G,MAAK8P,GAC3C,OAAO,EAER9P,MAAKwH,EAAarE,EAAEtB,UAAW,CAChC,CACD,CACA,OAAO,CACR,CAEAkQ,MACC,IAAI,IAAI5P,EAAI,EAAGA,EAAInC,MAAKgQ,GAAUhO,SAAUG,EAAG,CAC9C,MAAM6P,EAAWhS,MAAKgQ,GAAU7N,GAAGN,QAEnC,IAAK,IAAI+D,EAAIzD,EAAI,EAAGyD,EAAI5F,MAAKgQ,GAAUhO,SAAU4D,EAAG,CACnD,MAAM+K,EAAK3Q,MAAKgQ,GAAUpK,GACpBS,EAAKrG,MAAK+F,EAAuBiM,EAAUrB,EAAG9O,SAEpD,IAAK,MAAMsB,KAAKkD,EAAI,CACnB,MAAMiK,EAASK,EAAG1N,QACZ2N,EAASD,EAAGpN,SACZsN,EAASF,EAAGjL,aAElB,IAAK,IAAIa,EAAI,EAAGC,EAAIoK,EAAGpP,OAAQ+E,EAAIC,IAAKD,EACnCsK,EAAI5O,cAAcsE,KACtBoK,EAAGnN,OAAOoN,EAAGpM,GAAG+B,IACZpD,EAAEkM,sBAAwBrP,MAAK8P,IAClCe,EAAIjP,KAAK2E,EAAGpE,IAGdwO,EAAGnN,OAAO8M,EACX,CACD,CACD,CACD,CAGA7J,KACC,IAAI5E,EAAQ,EACRL,EAAQ0C,OAAOC,UAEnB,IAAK,IAAIhC,EAAI,EAAGA,EAAInC,MAAKsF,EAAMtD,SAAUG,EAAG,CAC3C,MAAMY,EAAI/C,MAAKsF,EAAMnD,GACrB,IAAKY,EAAEhB,UAAW,SAClB,MACM2E,EADI3D,EAAEQ,SACA/B,OAASuB,EAAE2C,aAAanE,aAChCmF,EAAIlF,IACPA,EAAQkF,EACR7E,EAAQM,EAEV,CACA,OAAON,CACR,CAGA8E,GAAQ7E,GACP,IAAImQ,EAAKpC,qBAAqBqC,SAC9B,MAAMpL,EAAW9G,MAAKyF,EAAUzF,MAAKyG,IAA4B3E,EAC3D4C,EAAW1E,MAAKsF,EAAMwB,GACtBxD,EAAWoB,EAAGnB,SACdwD,EAAWrC,EAAGgB,aACpB1F,MAAKgQ,GAAUlO,GAAS4C,EAExB,IAAK,IAAIvC,EAAI,EAAGqE,EAAIlD,EAAE9B,OAAQW,EAAIqE,IAAKrE,EAAG,CACzC,GAAI4E,EAAG9E,cAAcE,GAAI,SACzB,GAAKnC,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,KAAiBtE,MAAKiE,EAAWG,KAAKC,MAAO,CAC3F4N,EAAKpC,qBAAqBsC,UAC1B,KACD,CACAzN,EAAGlB,OAAOF,EAAEkB,GAAGrC,IAEf,IAAK,MAAMY,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAaxD,OAAOJ,GAClD,IAAK9B,MAAK4R,GAA0BlN,GAAK,SACzC,IAAK1E,MAAKgG,EAAclE,EAAOgF,GAAW,SAE1C,MAAMsL,EAAYtQ,EAAQ,EAE1B,GADAmQ,EAAMG,IAAcpS,MAAKsF,EAAMtD,OAAS,EAAKhC,MAAKqS,GAAYD,GAAapS,MAAK2G,EAAQyL,GACpFH,IAAOpC,qBAAqBsC,UAAW,KAC5C,CACA,GAAIF,IAAOpC,qBAAqBqC,SAC/B,IAAK,MAAMnP,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAaxD,OAAOJ,GAGnD,OADA4C,EAAGhB,QACIuO,CACR,CAGAI,IAAYvQ,GACX,IAAImQ,EAAKpC,qBAAqBqC,SAC9B,MAAMxN,EAAK1E,MAAKsF,EAAMtF,MAAKyF,EAAUzF,MAAKyG,IAA4B3E,GAChEwB,EAAKoB,EAAGnB,SACRwD,EAAKrC,EAAGgB,aACd1F,MAAKgQ,GAAUlO,GAAS4C,EAExB,IAAK,IAAIvC,EAAI,EAAGqE,EAAIlD,EAAE9B,OAAQW,EAAIqE,IAAKrE,EAAG,CACzC,GAAI4E,EAAG9E,cAAcE,GAAI,SACzB,GAAKnC,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,KAAiBtE,MAAKiE,EAAWG,KAAKC,MAAO,CAC3F4N,EAAKpC,qBAAqBsC,UAC1B,KACD,CACAzN,EAAGlB,OAAOF,EAAEkB,GAAGrC,IAEf,MAAMsN,EAAMzP,KAAKP,KAAKiQ,0BACtB,GAAID,EAAMzP,MAAK8P,GAAc,CAI5B,GAHA9P,MAAK8P,GAAeL,EACpBzP,MAAKuF,EAAKsB,WAAW7G,KAAKP,MAC1BwS,EAAKpC,qBAAqBsC,UACD,OAArBnS,KAAKJ,YAAwBI,KAAKJ,YAAcI,MAAK8P,GACxD,MAED9P,MAAKqQ,KACLrQ,MAAK+R,IACN,CACD,CAEA,OADArN,EAAGhB,QACIuO,CACR,CAGA/R,OACCF,MAAKiE,EAAkC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACrFK,MAAKsE,EAAa,EAElB,IAAK,MAAMvB,KAAK/C,MAAKsF,EACpBvC,EAAE2C,aAAe,IAAItE,aAAa2B,EAAEQ,SAAS/B,QAG9C,GADAxB,KAAKP,KAAKuH,qBACLhH,MAAKqQ,KAA0B,OAAO,EAE3C,IAAIiC,GAAU,EACd,OAAa,CAEZ,GADWtS,MAAK2G,EAAQ,KACbkJ,qBAAqBsC,UAAW,CAC1C,GAAInS,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAAc,CACvDtE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B,KACD,CACA,GAAI9E,MAAKiE,EAAWG,KAAKC,MAAO,CAC3BrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B,KACD,CACD,CACA,GAAI9E,MAAKuF,EAAKxD,UACb,MAKD,GAHI/B,KAAKR,QACRqF,QAAQC,IAAK,uBAAsB9E,MAAK8P,MAErC9P,KAAKgB,cAAchB,MAAKuF,EAAMvF,MAAK8P,IAAe,CACrDwC,GAAU,EACV,KACD,CACA,GAAwB,OAApBtS,KAAKJ,WACR0S,GAAU,EACVtS,MAAK8P,IAAgB9P,MAAK+P,QACpB,GAAI/P,KAAKJ,YAAcI,MAAK8P,GAAc,CAC5C9P,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7BwN,GAAU,EACV,KACD,CACA,IAAK,MAAMvP,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAatD,WAC5C,CACApC,MAAKuF,EAAKL,QACV,IAAK,MAAMnC,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAe,KAC7C,OAAO4M,CACR,CAQA/R,cAAcC,EAAO,MAEpB,GADAR,KAAKJ,WAAaY,EACM,OAApBR,KAAKJ,WACRI,MAAK8P,GAAe,MACd,CAEN,IAAI/K,EAAIb,OAAOqO,UAEf,IADAvS,MAAK8P,GAAe9P,KAAKJ,WAAamF,EAC/B/E,MAAK8P,IAAgB9P,KAAKJ,YAChCmF,GAAK,GACL/E,MAAK8P,GAAe9P,KAAKJ,WAAamF,CAExC,CACD,CAQAqC,yCAAyChC,GACxCpF,MAAKyF,EAAUL,CAChB,CAMAoN,0CAA0CC,GACzCzS,MAAK+P,GAAU0C,CAChB,CAQAC,oBAAoBtN,GACnBpF,MAAKkQ,GAAoB9K,CAC1B,EAYD,MAAMuN,+BAA+BpT,OAEpC8B,gBAAmB,EACnBA,iBAAmB,EAEnBiE,GACAC,GAAO,IAAId,eACXe,GAEAsK,IAAe,EAEfxL,GACAL,GACAwB,IAAU,EACVsK,IAAU,EAOVjQ,YAAY0C,EAAGkN,EAA0B,MACxCjN,MAAMD,GACNxC,MAAKsF,EAAQ,IAAItF,KAAKP,KAAK8E,aAC3BvE,MAAK2F,IAEL3F,MAAK8P,GAAexH,KAAKD,IAAI,EAAG7F,EAAEkN,2BAC9BA,IACH1P,MAAK8P,GAAeJ,EAEtB,CAEAzP,OACC,MAAO,uDACR,CAEAe,gBACC,OAAO,CACR,CAGA2E,KACC3F,MAAKwF,EAAW,GAEhB,IAAK,IAAII,EAAI,EAAGA,EAAI5F,MAAKsF,EAAMtD,SAAU4D,EAAG,CAC3C5F,MAAKwF,EAASK,KAAK,IAAIpE,MAAMzB,MAAKsF,EAAMtD,SAExC,IAAK,IAAIG,EAAI,EAAGA,EAAInC,MAAKsF,EAAMtD,OAAQG,IAClCA,EAAIyD,IACP5F,MAAKwF,EAASI,GAAGzD,GAAKnC,KAAKP,KAAKqG,mBAAmB9F,MAAKsF,EAAMnD,GAAInC,MAAKsF,EAAMM,IAGhF,CACD,CAGAG,GAAuBoK,EAAUC,GAChC,OAAID,EAAWC,EACPpQ,MAAKwF,EAAS4K,GAAUD,GAEzBnQ,MAAKwF,EAAS2K,GAAUC,EAChC,CAGAG,IAAyBzO,EAAOsK,EAAIjJ,GACnC,MAAMqN,EAAMpE,EAAG7I,SACTkN,EAAMrE,EAAG1G,aAEf,IAAK,IAAIvD,EAAI,EAAGqE,EAAIgK,EAAGhP,OAAQW,EAAIqE,IAAKrE,EACnCsO,EAAIxO,cAAcE,KACtBiK,EAAG5I,OAAOgN,EAAGhM,GAAGrC,IACZgB,EAAEkM,sBAAwBrP,MAAK8P,IAClCW,EAAI7O,KAAKO,EAAGL,IAId,OADAsK,EAAG1I,SACK+M,EAAI1O,SACb,CAGAiE,GAAclE,EAAOD,GACpB,IAAK,MAAMqE,KAAQlG,MAAKsF,EAAO,CAC9B,IAAKY,EAAInE,UAAW,SAEpB,MAAMsE,EAAKrG,MAAK+F,EAAuBlE,EAAOqE,EAAIrE,SAClD,IAAK,MAAMsB,KAAKkD,EACf,GAAiB,IAAblD,EAAE3B,SACAxB,MAAKuQ,GAAyBzO,EAAOoE,EAAK/C,GAAI,OAAO,CAG7D,CACA,OAAO,CACR,CAGAsD,KACC,IAAI5E,EAAQ,EACRL,EAAQ0C,OAAOC,UAEnB,IAAK,IAAIhC,EAAI,EAAGA,EAAInC,MAAKsF,EAAMtD,SAAUG,EAAG,CAC3C,MAAMY,EAAI/C,MAAKsF,EAAMnD,GACrB,IAAKY,EAAEhB,UAAW,SAClB,MACM2E,EADI3D,EAAEQ,SACA/B,OAASuB,EAAE2C,aAAanE,aAChCmF,EAAIlF,IACPA,EAAQkF,EACR7E,EAAQM,EAEV,CACA,OAAON,CACR,CAGA8E,GAAQ7E,GACP,IAAImQ,EAAKU,uBAAuBT,SAChC,MAAMpL,EAAW9G,MAAKyF,EAAUzF,MAAKyG,IAA4B3E,EAC3D4C,EAAW1E,MAAKsF,EAAMwB,GACtBxD,EAAWoB,EAAGnB,SACdwD,EAAWrC,EAAGgB,aAEpB,IAAK,IAAIvD,EAAI,EAAGqE,EAAIlD,EAAE9B,OAAQW,EAAIqE,IAAKrE,EAAG,CACzC,GAAI4E,EAAG9E,cAAcE,GAAI,SACzB,GAAKnC,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,KAAiBtE,MAAKiE,EAAWG,KAAKC,MAAO,CAC3F4N,EAAKU,uBAAuBR,UAC5B,KACD,CACAzN,EAAGlB,OAAOF,EAAEkB,GAAGrC,IAEf,IAAK,MAAMY,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAaxD,OAAOJ,GAClD,IAAK9B,MAAKgG,EAAclE,EAAOgF,GAAW,SAE1C,MAAMsL,EAAYtQ,EAAQ,EAE1B,GADAmQ,EAAMG,IAAcpS,MAAKsF,EAAMtD,OAAS,EAAKhC,MAAKqS,GAAYD,GAAapS,MAAK2G,EAAQyL,GACpFH,IAAOU,uBAAuBR,UAAW,KAC9C,CACA,GAAIF,IAAOU,uBAAuBT,SACjC,IAAK,MAAMnP,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAaxD,OAAOJ,GAGnD,OADA4C,EAAGhB,QACIuO,CACR,CAGAI,IAAYvQ,GACX,IAAImQ,EAAKU,uBAAuBT,SAChC,MAAMxN,EAAK1E,MAAKsF,EAAMtF,MAAKyF,EAAUzF,MAAKyG,IAA4B3E,GAChEwB,EAAKoB,EAAGnB,SACRwD,EAAKrC,EAAGgB,aAEd,IAAK,IAAIvD,EAAI,EAAGqE,EAAIlD,EAAE9B,OAAQW,EAAIqE,IAAKrE,EAAG,CACzC,GAAI4E,EAAG9E,cAAcE,GAAI,SACzB,GAAKnC,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,KAAiBtE,MAAKiE,EAAWG,KAAKC,MAAO,CAC3F4N,EAAKU,uBAAuBR,UAC5B,KACD,CACAzN,EAAGlB,OAAOF,EAAEkB,GAAGrC,IAEf,MAAMsN,EAAMzP,KAAKP,KAAKiQ,0BACtB,GAAID,EAAMzP,MAAK8P,KACd9P,MAAK8P,GAAeL,EACpBzP,MAAKuF,EAAKsB,WAAW7G,KAAKP,MAC1BwS,EAAKU,uBAAuBR,UACJ,OAApBnS,KAAKJ,YAAuBI,KAAKJ,YAAcI,MAAK8P,IACvD,KAGH,CAEA,OADApL,EAAGhB,QACIuO,CACR,CAGA/R,OACCF,MAAKiE,EAAkC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACrFK,MAAKsE,EAAa,EAElB,IAAK,MAAMvB,KAAK/C,MAAKsF,EACpBvC,EAAE2C,aAAe,IAAItE,aAAa2B,EAAEQ,SAAS/B,QAE9CxB,KAAKP,KAAKuH,oBAEV,MAAMzB,EAAM,IAAId,eAEhB,IAAI6N,GAAU,EACd,OAAa,CAEZ,GADWtS,MAAK2G,EAAQ,KACbgM,uBAAuBR,UAAW,CAC5C,GAAInS,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAAc,CACvDtE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B,KACD,CACA,GAAI9E,MAAKiE,EAAWG,KAAKC,MAAO,CAC3BrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B,KACD,CACD,CACA,GAAI9E,MAAKuF,EAAKxD,UACb,MAQD,GANAwD,EAAIqN,kBAAkB5S,MAAKuF,GAC3BvF,MAAKuF,EAAK7B,QAEN1D,KAAKR,QACRqF,QAAQC,IAAK,uBAAsB9E,MAAK8P,MAErC9P,KAAKgB,cAAcuE,EAAKvF,MAAK8P,IAAe,CAC/CwC,GAAU,EACV,KACD,CACA,GAAwB,OAApBtS,KAAKJ,WAAqB,CAE7B,GADA0S,GAAU,EACNtS,MAAK8P,GAAe9P,MAAK+P,GAAU,EAAG,MAC1C/P,MAAK8P,IAAkB9P,MAAK8P,GAAe9P,MAAK+P,GAAU,EAAK,EAAI/P,MAAK+P,EACzE,MAAO,GAAI/P,KAAKJ,YAAcI,MAAK8P,GAAc,CAC5C9P,KAAKR,QAAQqF,QAAQC,IAAK,4CAC9BwN,GAAU,EACV,KACD,CACA,IAAK,MAAMvP,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAatD,WAC5C,CACAmD,EAAIL,QACJ,IAAK,MAAMnC,KAAK/C,MAAKsF,EAAOvC,EAAE2C,aAAe,KAC7C,OAAO4M,CACR,CAQA/R,cAAcC,EAAO,MAEpB,GADAR,KAAKJ,WAAaY,EACM,OAApBR,KAAKJ,WACRI,MAAK8P,GAAe,MACd,CAEN,IAAI/K,EAAIb,OAAOqO,UAEf,IADAvS,MAAK8P,GAAe9P,KAAKJ,WAAamF,EAC/B/E,MAAK8P,IAAgB9P,KAAKJ,YAChCmF,GAAK,GACL/E,MAAK8P,GAAe9P,KAAKJ,WAAamF,CAExC,CACD,CAQAqC,yCAAyChC,GACxCpF,MAAKyF,EAAUL,CAChB,CAMAoN,0CAA0CC,GACzCzS,MAAK+P,GAAU0C,CAChB,EAYD,MAAMI,mBAAmBtT,OAExB8B,eAAegH,GACd,OAAOC,KAAKC,MAAMD,KAAKE,SAAWF,KAAKC,MAAMF,GAC9C,CAEAI,GAAY,GACZC,GAEA5I,YAAY0C,EAAGkN,EAA0B,GAExC,GADAjN,MAAMD,IACDxC,MAAK2I,EAAe+G,GACxB,MAAM,IAAI9G,SAEZ,CAEA3I,OACC,MAAO,aACR,CAEA0I,GAAemK,GACV9S,KAAKR,QAAQqF,QAAQC,IAAI,0BAC7B,MAAM2C,EAAO,GAEb,IAAK,MAAM1E,KAAK/C,KAAKP,KAAK8E,YAAa,CACtC,GAA0B,IAAtBxB,EAAEQ,SAAS/B,OAAc,OAAO,EACpCxB,MAAKyI,EAAU5C,KAAK,IAAIgN,WAAWhK,QAAQ9F,GAC5C,CACA,IAAK,MAAMI,KAAKnD,KAAKP,KAAKqJ,cACzB,GAAiB,IAAb3F,EAAE3B,OAAc,CACnB,MAAMuB,EAAKI,EAAEqB,GAAG,GACVuE,EAAK/I,MAAKyI,EAAUtF,EAAEqB,GAAG,GAAG3C,SAElC,IAAK,IAAIM,EAAI,EAAGA,EAAI4G,EAAGvH,SAAUW,EAAG,CACnC,MAAM6G,EAAUjG,EAAEE,QAClBF,EAAES,OAAOuF,EAAG9D,IAAI9C,GAAG8G,QAEf9F,EAAEkM,sBAAwByD,GAC7BrL,EAAK5B,KAAK,IAAIgN,WAAW3J,WAAW/F,EAAG4F,EAAG9D,IAAI9C,KAE/CY,EAAES,OAAOwF,EACV,CACD,KAAO,CACN,MAAMd,EAAO/E,EAAEqB,GAAG,GACZ2E,EAAOhG,EAAEqB,GAAG,GACZ4E,EAAOpJ,MAAKyI,EAAUtF,EAAEqB,GAAG,GAAG3C,SAC9BwH,EAAOrJ,MAAKyI,EAAUtF,EAAEqB,GAAG,GAAG3C,SAEpC,IAAK,IAAIM,EAAI,EAAGA,EAAIiH,EAAK5H,SAAUW,EAAG,CACrC,MAAMmH,EAAWpB,EAAGjF,QACpBiF,EAAG1E,OAAO4F,EAAKnE,IAAI9C,GAAG8G,QAEtB,IAAK,IAAIrD,EAAI,EAAGA,EAAIyD,EAAK7H,SAAUoE,EAAG,CACrC,MAAM2D,EAAWJ,EAAGlG,QACpBkG,EAAG3F,OAAO6F,EAAKpE,IAAIW,GAAGqD,QAElB9F,EAAEkM,sBAAwByD,GAC7BrL,EAAK5B,KAAK,IAAIgN,WAAW3J,WAAW/F,EAAGiG,EAAKnE,IAAI9C,GAAIkH,EAAKpE,IAAIW,KAE9DuD,EAAG3F,OAAO+F,EACX,CACArB,EAAG1E,OAAO8F,EACX,CACD,CAED,IAAK,MAAMP,KAAM/I,MAAKyI,EACrB,IAAK,MAAMjC,KAAKuC,EAAGS,SAAUhD,EAAEiD,kBAIhC,OAFAzJ,MAAK0I,EAAejB,EAChBzH,KAAKR,QAAQqF,QAAQC,IAAI,8BACtB,CACR,CAEA4E,GAASC,GACR,IAAK,IAAIxH,EAAIwH,EAAG3H,OAAQG,EAAI,IAAKA,EAAG,CACnC,MAAMyD,EAAOwC,MAAMwB,QAAQzH,GACrB0H,EAAOF,EAAGxH,EAAI,GACpBwH,EAAGxH,EAAI,GAAKwH,EAAG/D,GACf+D,EAAG/D,GAASiE,CACb,CACA,OAAOF,CACR,CAEAzJ,OACC,MAAM+D,EAA+B,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACnF,IAAI2E,EAAY,EAEhB,MAAMiB,EAAQ,IAAId,eACZqF,EAAQ,GACd,IAAK,IAAI3H,EAAI,EAAGA,EAAInC,MAAKyI,EAAUzG,OAAQG,IAC1C2H,EAAMjE,KAAK1D,GAGZ,IAAI4H,EAAU/J,KAAKP,KAAKiQ,0BACpB4C,GAAU,EAEd,OAAa,CACZ,GAAItS,KAAKN,YAAcM,KAAKN,WAAa4E,IAAa,CACjDtE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B,KACD,CACA,GAAIb,EAAUG,KAAKC,MAAO,CACrBrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B,KACD,CAEA,IAAIkF,GAAW,EACf,IAAK,MAAM7H,KAAKnC,MAAK0J,EAASI,GACzB9J,MAAKyI,EAAUtG,GAAG8H,4BACrBD,GAAW,GAGb,GAAKA,EAKE,CACN,IAAK,MAAME,KAAOlK,MAAKyI,EACtByB,EAAIC,kBAEL,MAAM7G,EAAItD,KAAKP,KAAKiQ,0BACpB,GAAI3F,EAAMzG,EAAG,CAIZ,GAHAyG,EAAMzG,EACFtD,KAAKR,QAAQqF,QAAQC,IAAK,8BAA6BxB,KAC3DiC,EAAIsB,WAAW7G,KAAKP,MAChBO,KAAKgB,cAAcuE,EAAKjC,GAAI,CAC/BgP,GAAU,EACV,KACD,CACA,GAAwB,OAApBtS,KAAKJ,WACR0S,GAAU,OACJ,GAAItS,KAAKJ,YAAcmK,EAAK,CAC9B/J,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7BwN,GAAU,EACV,KACD,CACD,CACD,MAzBC,IAAK,MAAMlI,KAAOpK,MAAK0I,EACtB0B,EAAIC,eAyBP,CAEA,OADA9E,EAAIL,QACGoN,CACR,EAID,CAEC,MAAMzJ,EAELxH,eAAegH,GACd,OAAOC,KAAKC,MAAMD,KAAKE,SAAWF,KAAKC,MAAMF,GAC9C,CAEAiC,GACAzI,GACA0I,GAAc,GACdf,SAAc,GAEd1J,YAAYiD,GACX/C,MAAKsK,EAAOvH,EAEZ,IAAK,MAAMyH,KAAOzH,EAAEQ,SACnBvD,KAAKwJ,SAAS3D,KAAK,IAAI4E,EAAOD,IAE/BxK,MAAK0K,EAAa7B,EAAQe,QAAQ5J,KAAKwJ,SAASxH,QACjD,CAEA0I,GAAa7I,GACZ,IAAK,MAAM2E,KAAKxG,KAAKwJ,SACpBhD,EAAEmE,WAAY,EAEf3K,KAAKwJ,SAAS3H,GAAO8I,WAAY,EACjC3K,MAAK6B,EAASA,CACf,CAEAsI,kBACCnK,MAAKsK,EAAK9G,OAAOxD,KAAKwJ,SAASxJ,MAAK6B,GAAQoH,OAC7C,CAEAhE,IAAIpD,GACH,OAAO7B,KAAKwJ,SAAS3H,EACtB,CAEA+I,UACC,OAAO5K,KAAKwJ,QACb,CAGAS,0BACCjK,MAAKuK,EAAYvI,OAAS,EAE1B,IAAIqG,EAAYnE,OAAO2G,kBACnBC,GAAY,EAEhB,IAAK,IAAI3I,EAAI,EAAGA,EAAInC,KAAKwJ,SAASxH,SAAUG,EAAG,CAC9C,MAAM4I,EAAQ/K,KAAKwJ,SAASrH,GAAG6I,WAE3B3C,GAAO0C,IACN1C,EAAM0C,IACT1C,EAAM0C,EACN/K,MAAKuK,EAAYvI,OAAS,EAC1B8I,GAAY,GAEb9K,MAAKuK,EAAY1E,KAAK1D,GAClBnC,MAAK6B,IAAWM,IACnB2I,GAAY,GAGf,CACA,OAAIA,GAAyC,IAA5B9K,MAAKuK,EAAYvI,SAGlChC,MAAK0K,EAAa1K,MAAKuK,EAAY1B,EAAQe,QAAQ5J,MAAKuK,EAAYvI,WAC7D,EACR,CAEAR,OACC,OAAOxB,KAAKwJ,SAASxH,MACtB,EAGD6Q,WAAWhK,QAAUA,EAErB,MAAMK,EAEL/F,IACA8H,GACAC,GACAC,QAGArL,YAAYqD,EAAG8H,EAAOC,EAAS,MAC9BlL,KAAKmL,QAAUhI,EAAEkM,qBAAuB,EACxCrP,MAAKmD,GAAUA,EAEfnD,MAAKiL,EAASA,EACdjL,MAAKiL,EAAOG,cAAcpL,MAC1BA,MAAKkL,EAAUA,EACM,OAAjBlL,MAAKkL,GACRlL,MAAKkL,EAAQE,cAAcpL,KAE7B,CAEAqL,UAAUC,GACT,OAAIA,IAAStL,MAAKiL,EAAgBjL,MAAKkL,EACnCI,IAAStL,MAAKkL,EAAgBlL,MAAKiL,EAChC,IACR,CAEAZ,gBACMrK,MAAKiL,EAAON,YAA+B,OAAjB3K,MAAKkL,GAAqBlL,MAAKkL,EAAQP,aAG/C,IAAnB3K,MAAKmD,GAAG3B,OACXxB,KAAKmL,SAAYnL,MAAKmD,GAAG4P,gBAAgB1D,mBAAmBrP,MAAKiL,EAAOhC,QAAU,EAElFjJ,KAAKmL,SAAYnL,MAAKmD,GAAG4P,gBAAgB1D,mBAAmBrP,MAAKiL,EAAOhC,OAAQjJ,MAAKkL,EAAQjC,QAAU,EAEzG,EAGD4J,WAAW3J,WAAaA,EAExB,MAAMuB,EAELc,GAAW,GACX7C,GACAO,OACA0B,WAAY,EAEZ7K,YAAYmD,GACXjD,KAAKiJ,OAAShG,CACf,CAEAmI,cAAcjI,GACbnD,MAAKuL,EAAS1F,KAAK1C,EACpB,CAEAsG,kBACCzJ,MAAK0I,EAAe,IAAI1I,MAAKuL,GAC7BvL,MAAKuL,EAAe,IACrB,CAEAP,WACC,IAAIQ,EAAM,EACV,IAAK,MAAMrI,KAAKnD,MAAK0I,EAAc,CAClC,MAAMlC,EAAIrD,EAAEkI,UAAUrL,MACtBwL,GAAOrI,EAAEgI,SAAkB,OAAN3E,GAAcA,EAAEmE,UAAa,EAAI,EACvD,CACA,OAAOa,CACR,EAGDqH,WAAWpI,OAASA,CAErB,CASA,MAAMuI,6BAA6BzT,OAElC8B,SAAmBqK,EAAIC,GACtB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGhL,IAAImC,GAC3B,OAAO6I,CACR,CAEAvK,SAAoBqK,EAAIC,GACvB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGC,OAAO9I,GAC9B,OAAO6I,CACR,CAEAvK,SAAuBqF,EAAG3B,GACzB,MAAM6G,EAAK,IAAI7H,IAAI2C,GAEnB,OADAkF,EAAGhL,IAAImE,GACA6G,CACR,CAEAvK,SAAwBqF,EAAG3B,GAC1B,MAAM6G,EAAK,IAAI7H,IAAI2C,GAEnB,OADAkF,EAAGC,OAAO9G,GACH6G,CACR,CAEAqH,IACAC,IAEA5O,GACAL,GACA6H,GAEAhM,YAAY0C,GACXC,MAAMD,GACNxC,MAAKmT,IACN,CAEAlT,OACC,MAAO,wBACR,CAEAmT,IAAQC,EAAIC,GACX,MAAMC,EAAM,IAAIC,IAEhB,IAAK,MAAMrQ,KAAKmQ,EACf,GAAKnQ,EAAEsQ,YAGP,IAAK,MAAM1Q,KAAKI,EACVoQ,EAAItL,IAAIlF,GAGZwQ,EAAIG,IAAI3Q,EAAGwQ,EAAItO,IAAIlC,GAAK,GAFxBwQ,EAAIG,IAAI3Q,EAAG,GAMd,MAAM4Q,EAAK,IAAIN,GACfM,EAAGC,MAAK,CAACC,EAAIC,KACZ,IAAIC,EAAO,EACPC,EAAO,EAIX,OAHIT,EAAItL,IAAI4L,KAAKE,EAAOR,EAAItO,IAAI4O,IAC5BN,EAAItL,IAAI6L,KAAKE,EAAOT,EAAItO,IAAI6O,IAE5BC,EAAOC,EAAa,EACpBD,EAAOC,GAAc,EAClB,CAAC,IAGT,MAAMxI,EAAM,IAAIzH,IAEhB,IAAK,MAAMhB,KAAK4Q,EAAI,CACnB,IAAIM,GAAS,EACb,IAAK,MAAM9Q,KAAKmQ,EACf,GAAInQ,EAAEsQ,YAAa,CAClBQ,GAAS,EACT,KACD,CAED,IAAKA,EAAQ,MACblR,EAAEW,QACF8H,EAAI5K,IAAImC,EACT,CACA,OAAOyI,CACR,CAEA2H,MACC,IAAIe,EAAO,EACPC,EAAO,EAEX,IAAK,MAAMpR,KAAK/C,KAAKP,KAAK8E,YACzB,IAAK,MAAMpB,KAAKJ,EAAG,CAClB,MAAMpC,EAAIwC,EAAEiR,0BACNC,EAAIlR,EAAEmR,2BACR3T,EAAIuT,IAAMA,EAAOvT,GACjB0T,EAAIF,IAAMA,EAAOE,EACtB,CAEDrU,MAAKkT,GAAMgB,EACXlU,MAAKiT,GAAMkB,CACZ,CAEAI,IAAWC,EAAIC,EAAIC,EAAIC,EAAUC,EAAStB,EAAIuB,GAC7C,MAAMC,EAAM9U,MAAKoT,GAAQqB,EAAInB,GACvByB,EAAM/B,sBAAqBjG,EAAgByH,EAAIE,GAC/CM,EAAMhC,sBAAqBnG,EAAa4H,EAAIK,GAClD,OAAO9U,MAAKiV,GAAcF,EAAKC,EAAKF,EAAKH,EAAUrM,KAAK4M,IAAIN,EAASD,GAAWE,EACjF,CAEAM,IAAaX,EAAIC,EAAIC,EAAIU,EAAQR,EAASC,GACzC,IAAIQ,EAAWrV,MAAKkT,GACpB,GAA2B,IAAvBwB,EAAGnR,SAAS/B,OACf,OAAO6T,EAER,IAAIC,EAAU7Q,eAAe4I,cAAcoH,GACvCc,EAAUb,EAAGnR,SAASiB,GAAG,GAE7B,MAAMgR,EAAU/Q,eAAe4I,cAAcoH,GAE7C,IAAK,IAAI7O,EAAI,EAAGA,EAAI8O,EAAGnR,SAAS/B,QAAU6T,EAAWT,IAAWhP,EAAG,CAClE,MAAM6P,EAAMf,EAAGnR,SAASiB,GAAGoB,GAC3B8O,EAAGlR,OAAOiS,GACV,MAAMC,EAAYpN,KAAK4M,IAAIE,EAAQpV,MAAK2V,GAAQnB,EAAIE,EAAIW,EAAUR,IAElE,GAAIa,EAAYpN,KAAKD,IAAIgN,EAAUR,GAAK,CACvC,MAAMe,EAAQ,IAAI7R,IACZ8R,EAAavN,KAAK4M,IAAI5M,KAAK4M,IAAIQ,EAAWd,GAAU5U,MAAK8V,GAAStB,EAAIC,EAAIC,EAAIgB,EAAWd,EAASgB,IAOxG,GALIC,EAAaR,IAChBA,EAAWQ,EACXN,EAAWE,EACXH,EAAW7Q,eAAe4I,cAAcoH,IAErCmB,EAAMpU,KAAM,CACf,MAAMuU,EAAa/V,MAAKuU,GAAWC,EAAIC,EAAIC,EAAIgB,EAAWd,EAASgB,EAAOtN,KAAKD,IAAIwM,EAAIQ,IACvF,IAA4B,IAAxBrV,MAAK8L,EACR,OAAOuJ,EAEJU,EAAaV,IAChBA,EAAWU,EACXR,EAAWE,EACXH,EAAW7Q,eAAe4I,cAAcoH,IAEzCe,EAAQtQ,OACT,CACD,CACD,CAGA,OAFAoQ,EAAOpQ,QACPwP,EAAGlR,OAAO+R,GACHF,CACR,CAEAJ,IAAcT,EAAIC,EAAIuB,EAAIZ,EAAQR,EAASC,GAI1C,GAHI7U,KAAKR,QACRqF,QAAQC,IAAK,MAAK0P,EAAGhT,aAAaiT,EAAGjT,aAAawU,EAAGxU,QAE9B,OAApBxB,KAAKJ,YAAuBI,KAAKJ,YAAcI,KAAKP,KAAKiQ,0BAG5D,OAFI1P,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7B9E,MAAK8L,EAAgB,EACd8I,EAER,GAAI5U,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAG7C,OAFItE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B9E,MAAK8L,EAAgB,EACd8I,EAER,GAAI5U,MAAKiE,EAAWG,KAAKC,MAGxB,OAFIrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B9E,MAAK8L,EAAgB,EACd8I,EAER,GAAgB,IAAZoB,EAAGxU,KACN,OAAOoT,EAER,MAAMF,EAAYsB,EAAG9I,SAASC,OAAOlK,MAC/BgT,EAAYjW,MAAKmV,GAAaX,EAAIC,EAAIC,EAAIU,EAAQR,EAASC,GAEjE,OAA4B,IAAxB7U,MAAK8L,EACD8I,EAEJqB,EAAYpB,EACR7U,MAAKkT,IAEbuB,EAAKzB,sBAAqBjG,EAAgB0H,EAAIC,GAC9CsB,EAAKhD,sBAAqB1F,EAAiB0I,EAAItB,GACxC1U,MAAKiV,GAAcT,EAAIC,EAAIuB,EAAIZ,EAAQa,EAAWpB,GAC1D,CAEAqB,IAAUC,EAAG7C,GACZ,MAAMjN,EAAK,IAAItC,IACf,IAAK,MAAMhB,KAAKoT,EACf,IAAK,MAAMhT,KAAKJ,EACfsD,EAAGzF,IAAIuC,GAGT,IAAIqI,EAAM,EACV,IAAK,MAAMrI,KAAKkD,EAAI,CACnB,MAAM+P,EAAKjT,EAAEkM,qBACT+G,IAAOvE,WAAWC,YAClBsE,EAAK5K,IAAKA,EAAM4K,GACrB,CACA,IAAK,MAAMjT,KAAKnD,KAAKP,KAAKqJ,cAAe,CAC7B3F,EAAEiR,0BACJpU,MAAKiT,IAAKK,EAAG1S,IAAIuC,EAC3B,CACA,OAAOqI,CACR,CAEAmK,IAAQnB,EAAIE,EAAIW,EAAUR,GACzB,IAAIwB,EAAK,EACT,MAAMhQ,EAAK,IAAItC,IAEf,IAAK,MAAMhB,KAAKyR,EAAI,CACnB,MAAM3K,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAG2R,GAC7C,IAAK,MAAMvR,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,IAAK,MAAMA,KAAKkD,EAAI,CACnB,MAAM/C,EAAIH,EAAEkM,qBACZ,GAAI/L,IAAMuO,WAAWC,YACjBxO,EAAI+S,IAAIA,EAAK/S,GACb+S,GAAMhB,GAAYgB,GAAMxB,GAAI,OAAOwB,CACxC,CACA,OAAOA,CACR,CAEAP,IAAStB,EAAIC,EAAIC,EAAIC,EAAUC,EAAStB,GACvC,IAAIgD,EAAM,EACV,MAAMjQ,EAAK,IAAItC,IAEf,IAAK,MAAMhB,KAAKyR,EAAI,CACnB,MAAM3K,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAG2R,GAC7C,IAAK,MAAMvR,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,IAAK,MAAMJ,KAAK0R,EAAI,CACnB,MAAM5K,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAG2R,GAC7C,IAAK,MAAMvR,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,IAAK,MAAMA,KAAKkD,EAAI,CACnB,MAAM+P,EAAKjT,EAAEkM,qBACT+G,IAAOvE,WAAWC,YAClBsE,EAAKE,IAAKA,EAAMF,GACrB,CACA,IAAK,MAAMjT,KAAKkD,EAAI,CACnB,MAAM+P,EAAKjT,EAAEkM,qBACT+G,IAAOvE,WAAWC,aAClBsE,EAAKzB,GAAYyB,EAAKxB,IAAStB,EAAG1S,IAAIuC,GAC3C,CACA,OAAOmT,CACR,CAEApW,OACCF,MAAKiE,EAAqC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACxFK,MAAKsE,EAAgB,EACrBtE,MAAK8L,GAAiB,EAEtB,MAAM6D,EAAM3P,KAAKP,KAAKiQ,0BACgB,IAAlC1P,KAAKP,KAAK6G,qBACbtG,KAAKP,KAAKuH,oBAEX,MAAMwN,EAAK,IAAIzQ,IACT0Q,EAAK,IAAI1Q,IACTiS,EAAK,IAAIjS,IACf,IAAK,MAAMhB,KAAK/C,KAAKP,KAAK8E,aACvBxB,EAAEhB,UAAiBiU,EAALvB,GAAS7T,IAAImC,GAG9B,MAAMuQ,EAAW,IAAIvP,IACfwS,EAAWvW,MAAKkW,GAAUzB,EAAInB,GACpC,IAAIuB,EACA2B,EAAU,KAEE,IAAZR,EAAGxU,MACNqT,EAAU0B,EACVC,EAAU/R,eAAe4I,cAAcoH,IAEvCI,EAAK7U,MAAKkT,GAEX,MAAM4B,EAAM9B,sBAAqBtG,EAAY1M,MAAKoT,GAAQqB,EAAInB,GAAK0C,GAC7DhB,EAAMhC,sBAAqBnG,EAAa4H,EAAIK,GAClD,IAAI2B,EAASzW,MAAKiV,GAAcT,EAAIQ,EAAKF,EAAK9U,MAAKiT,GAAKjT,MAAKiT,GAAK4B,GAOlE,OANI4B,EAAS5B,GACI,OAAZ2B,GACHA,EAAQtR,QAGVuR,EAASzW,KAAKP,KAAKiQ,0BACZ+G,EAAS9G,GAAO8G,EAAS,IAA6B,IAAvBzW,MAAK8L,GAA2C,OAApB9L,KAAKJ,WACxE,EAYD,MAAM8W,+BAA+BnX,OAEpC8B,SAAmBqK,EAAIC,GACtB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGhL,IAAImC,GAC3B,OAAO6I,CACR,CAEAvK,SAAoBqK,EAAIC,GACvB,MAAMC,EAAK,IAAI7H,IAAI2H,GACnB,IAAK,MAAM3I,KAAK4I,EAAIC,EAAGC,OAAO9I,GAC9B,OAAO6I,CACR,CAEAvK,SAAuBqF,EAAG3B,GACzB,MAAM6G,EAAK,IAAI7H,IAAI2C,GAEnB,OADAkF,EAAGhL,IAAImE,GACA6G,CACR,CAEAqH,IACAC,IAEA5O,GACAL,GACA6H,GAEAhM,YAAY0C,GACXC,MAAMD,GACNxC,MAAKmT,IACN,CAEAlT,OACC,MAAO,2BACR,CAEAmT,IAAQC,EAAIC,GACX,MAAMC,EAAM,IAAIC,IAEhB,IAAK,MAAMrQ,KAAKmQ,EACf,GAAKnQ,EAAEsQ,YAGP,IAAK,MAAM1Q,KAAKI,EACVoQ,EAAItL,IAAIlF,GAGZwQ,EAAIG,IAAI3Q,EAAGwQ,EAAItO,IAAIlC,GAAK,GAFxBwQ,EAAIG,IAAI3Q,EAAG,GAMd,MAAM4Q,EAAK,IAAIN,GACfM,EAAGC,MAAK,CAACC,EAAIC,KACZ,IAAIC,EAAO,EACPC,EAAO,EAIX,OAHIT,EAAItL,IAAI4L,KAAKE,EAAOR,EAAItO,IAAI4O,IAC5BN,EAAItL,IAAI6L,KAAKE,EAAOT,EAAItO,IAAI6O,IAE5BC,EAAOC,EAAa,EACpBD,EAAOC,GAAc,EAClB,CAAC,IAGT,MAAMxI,EAAM,IAAIzH,IAEhB,IAAK,MAAMhB,KAAK4Q,EAAI,CACnB,IAAIM,GAAS,EACb,IAAK,MAAM9Q,KAAKmQ,EACf,GAAInQ,EAAEsQ,YAAa,CAClBQ,GAAS,EACT,KACD,CAED,IAAKA,EAAQ,MACblR,EAAEW,QACF8H,EAAI5K,IAAImC,EACT,CACA,OAAOyI,CACR,CAEA2H,MACC,IAAIe,EAAO,EACPC,EAAO,EAEX,IAAK,MAAMpR,KAAK/C,KAAKP,KAAK8E,YACzB,IAAK,MAAMpB,KAAKJ,EAAG,CAClB,MAAMpC,EAAIwC,EAAEiR,0BACNC,EAAIlR,EAAEmR,2BACR3T,EAAIuT,IAAMA,EAAOvT,GACjB0T,EAAIF,IAAMA,EAAOE,EACtB,CAEDrU,MAAKkT,GAAMgB,EACXlU,MAAKiT,GAAMkB,CACZ,CAEAI,IAAWC,EAAIC,EAAIC,EAAIC,EAAUC,EAAStB,EAAIuB,GAC7C,MAAMC,EAAM9U,MAAKoT,GAAQqB,EAAInB,GACvByB,EAAM2B,wBAAuB3J,EAAgByH,EAAIE,GACjDM,EAAM0B,wBAAuB7J,EAAa4H,EAAIK,GACpD,OAAO9U,MAAKiV,GAAcF,EAAKC,EAAKF,EAAKH,EAAUrM,KAAK4M,IAAIN,EAASD,GAAWE,EACjF,CAEAM,IAAaX,EAAIC,EAAIC,EAAIU,EAAQR,EAASC,GACzC,IAAIQ,EAAWrV,MAAKkT,GACpB,GAA2B,IAAvBwB,EAAGnR,SAAS/B,OACf,OAAO6T,EAER,IAAIC,EAAU7Q,eAAe4I,cAAcoH,GACvCc,EAAUb,EAAGnR,SAASiB,GAAG,GAE7B,MAAMgR,EAAU/Q,eAAe4I,cAAcoH,GAE7C,IAAK,IAAI7O,EAAI,EAAGA,EAAI8O,EAAGnR,SAAS/B,QAAU6T,EAAWT,IAAWhP,EAAG,CAClE,MAAM6P,EAAMf,EAAGnR,SAASiB,GAAGoB,GAC3B8O,EAAGlR,OAAOiS,GACV,MAAMC,EAAYpN,KAAK4M,IAAIE,EAAQpV,MAAK2V,GAAQnB,EAAIE,EAAIW,EAAUR,IAElE,GAAIa,EAAYpN,KAAKD,IAAIgN,EAAUR,GAAK,CACvC,MAAMe,EAAQ,IAAI7R,IACZ8R,EAAavN,KAAK4M,IAAI5M,KAAK4M,IAAIQ,EAAWd,GAAU5U,MAAK8V,GAAStB,EAAIC,EAAIC,EAAIgB,EAAWd,EAASgB,IAOxG,GALIC,EAAaR,IAChBA,EAAWQ,EACXN,EAAWE,EACXH,EAAW7Q,eAAe4I,cAAcoH,IAErCmB,EAAMpU,KAAM,CACf,MAAMuU,EAAa/V,MAAKuU,GAAWC,EAAIC,EAAIC,EAAIgB,EAAWd,EAASgB,EAAOtN,KAAKD,IAAIwM,EAAIQ,IACvF,IAA4B,IAAxBrV,MAAK8L,EACR,OAAOuJ,EAEJU,EAAaV,IAChBA,EAAWU,EACXR,EAAWE,EACXH,EAAW7Q,eAAe4I,cAAcoH,IAEzCe,EAAQtQ,OACT,CACD,CACD,CAGA,OAFAoQ,EAAOpQ,QACPwP,EAAGlR,OAAO+R,GACHF,CACR,CAEAJ,IAAcT,EAAIC,EAAIuB,EAAIZ,EAAQR,EAASC,GAI1C,IAHAJ,EAAK,IAAI1Q,IAAI0Q,GACbuB,EAAK,IAAIjS,IAAIiS,KAEA,CAIZ,GAHIhW,KAAKR,QACRqF,QAAQC,IAAK,MAAK0P,EAAGhT,aAAaiT,EAAGjT,aAAawU,EAAGxU,QAE9B,OAApBxB,KAAKJ,YAAuBI,KAAKJ,YAAcI,KAAKP,KAAKiQ,0BAG5D,OAFI1P,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7B9E,MAAK8L,EAAgB,EACd8I,EAER,GAAI5U,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAG7C,OAFItE,KAAKR,QAAQqF,QAAQC,IAAI,oDAC7B9E,MAAK8L,EAAgB,EACd8I,EAER,GAAI5U,MAAKiE,EAAWG,KAAKC,MAGxB,OAFIrE,KAAKR,QAAQqF,QAAQC,IAAI,qCAC7B9E,MAAK8L,EAAgB,EACd8I,EAER,GAAgB,IAAZoB,EAAGxU,KACN,OAAOoT,EAER,MAAMF,EAAYsB,EAAG9I,SAASC,OAAOlK,MAC/BgT,EAAYjW,MAAKmV,GAAaX,EAAIC,EAAIC,EAAIU,EAAQR,EAASC,GAEjE,IAA4B,IAAxB7U,MAAK8L,EACR,OAAO8I,EAER,GAAIqB,EAAYpB,EACf,OAAO7U,MAAKkT,GAEbuB,EAAG7T,IAAI8T,GACPsB,EAAGnK,OAAO6I,GACVE,EAAUqB,CACX,CACD,CAEAC,IAAUC,EAAG7C,GACZ,MAAMjN,EAAK,IAAItC,IACf,IAAK,MAAMhB,KAAKoT,EACf,IAAK,MAAMhT,KAAKJ,EACfsD,EAAGzF,IAAIuC,GAGT,IAAIqI,EAAM,EACV,IAAK,MAAMrI,KAAKkD,EAAI,CACnB,MAAM+P,EAAKjT,EAAEkM,qBACT+G,IAAOvE,WAAWC,YAClBsE,EAAK5K,IAAKA,EAAM4K,GACrB,CACA,IAAK,MAAMjT,KAAKnD,KAAKP,KAAKqJ,cAAe,CAC7B3F,EAAEiR,0BACJpU,MAAKiT,IAAKK,EAAG1S,IAAIuC,EAC3B,CACA,OAAOqI,CACR,CAEAmK,IAAQnB,EAAIE,EAAIW,EAAUR,GACzB,IAAIwB,EAAK,EACT,MAAMhQ,EAAK,IAAItC,IAEf,IAAK,MAAMhB,KAAKyR,EAAI,CACnB,MAAM3K,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAG2R,GAC7C,IAAK,MAAMvR,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,IAAK,MAAMA,KAAKkD,EAAI,CACnB,MAAM/C,EAAIH,EAAEkM,qBACZ,GAAI/L,IAAMuO,WAAWC,YACjBxO,EAAI+S,IAAIA,EAAK/S,GACb+S,GAAMhB,GAAYgB,GAAMxB,GAAI,OAAOwB,CACxC,CACA,OAAOA,CACR,CAEAP,IAAStB,EAAIC,EAAIC,EAAIC,EAAUC,EAAStB,GACvC,IAAIgD,EAAM,EACV,MAAMjQ,EAAK,IAAItC,IAEf,IAAK,MAAMhB,KAAKyR,EAAI,CACnB,MAAM3K,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAG2R,GAC7C,IAAK,MAAMvR,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,IAAK,MAAMJ,KAAK0R,EAAI,CACnB,MAAM5K,EAAO7J,KAAKP,KAAKqG,mBAAmB/C,EAAG2R,GAC7C,IAAK,MAAMvR,KAAK0G,EAAMxD,EAAGzF,IAAIuC,EAC9B,CACA,IAAK,MAAMA,KAAKkD,EAAI,CACnB,MAAM+P,EAAKjT,EAAEkM,qBACT+G,IAAOvE,WAAWC,YAClBsE,EAAKE,IAAKA,EAAMF,GACrB,CACA,IAAK,MAAMjT,KAAKkD,EAAI,CACnB,MAAM+P,EAAKjT,EAAEkM,qBACT+G,IAAOvE,WAAWC,aAClBsE,EAAKzB,GAAYyB,EAAKxB,IAAStB,EAAG1S,IAAIuC,GAC3C,CACA,OAAOmT,CACR,CAEApW,OACCF,MAAKiE,EAAqC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACxFK,MAAKsE,EAAgB,EACrBtE,MAAK8L,GAAiB,EAEtB,MAAM6D,EAAM3P,KAAKP,KAAKiQ,0BACgB,IAAlC1P,KAAKP,KAAK6G,qBACbtG,KAAKP,KAAKuH,oBAEX,MAAMwN,EAAK,IAAIzQ,IACT0Q,EAAK,IAAI1Q,IACTiS,EAAK,IAAIjS,IACf,IAAK,MAAMhB,KAAK/C,KAAKP,KAAK8E,aACvBxB,EAAEhB,UAAiBiU,EAALvB,GAAS7T,IAAImC,GAG9B,MAAMuQ,EAAW,IAAIvP,IACfwS,EAAWvW,MAAKkW,GAAUzB,EAAInB,GACpC,IAAIuB,EACA2B,EAAU,KAEE,IAAZR,EAAGxU,MACNqT,EAAU0B,EACVC,EAAU/R,eAAe4I,cAAcoH,IAEvCI,EAAK7U,MAAKkT,GAEX,MAAM4B,EAAM4B,wBAAuBhK,EAAY1M,MAAKoT,GAAQqB,EAAInB,GAAK0C,GAC/DhB,EAAM0B,wBAAuB7J,EAAa4H,EAAIK,GACpD,IAAI2B,EAASzW,MAAKiV,GAAcT,EAAIQ,EAAKF,EAAK9U,MAAKiT,GAAKjT,MAAKiT,GAAK4B,GAOlE,OANI4B,EAAS5B,GACI,OAAZ2B,GACHA,EAAQtR,QAGVuR,EAASzW,KAAKP,KAAKiQ,0BACZ+G,EAAS9G,GAAO8G,EAAS,IAA6B,IAAvBzW,MAAK8L,GAA2C,OAApB9L,KAAKJ,WACxE,EAWD,MAAM+W,aAAapX,OAGlB8B,wBAA0B,EAE1BsM,GAAuB,IAAI5J,IAC3B6J,GAAuB,IAAI7J,IAC3B8J,GAAuB,GACvBC,GAAuB,GAEvBS,IAAW,IAAIxK,IAEfO,GACAL,GACA1B,IAAY,EAEZzC,YAAY0C,GACXC,MAAMD,GACN,IAAK,MAAMW,KAAKnD,KAAKP,KAAKqJ,cACzB9I,MAAK6N,EAAOhI,KAAK,IAAI6H,UAAUK,SAAS5K,IACxCnD,MAAK8N,EAAqBjI,KAAK,KAEjC,CAEA5F,OACC,MAAO,OACR,CAEAe,cAAcC,EAAUC,GACvB,OAAO,CACR,CAEA8M,GAAwB7K,GACvB,MAAMtB,EAAQsB,EAAEtB,QAKhB,OAHyC,OAArC7B,MAAK8N,EAAqBjM,KAC7B7B,MAAK8N,EAAqBjM,GAASsB,EAAE8K,aAE/BjO,MAAK8N,EAAqBjM,EAClC,CAEAqM,GAAQC,GACHnO,KAAKR,QAAQqF,QAAQC,IAAI,UAE7B,MAAMsJ,EAAa,IAAI3J,eACjBmS,EAAazI,EAAGkB,qBAChB6F,EAAalV,KAAKP,KAAKiQ,0BAC7B,IAAImH,EAAU1I,EAAGkB,qBAIjB,IAAK,MAAMtM,KAAKoL,EAAI,CACnB,MAAMnL,EAAQD,EAAEE,QAEhBI,EAAK,IAAK,MAAMC,KAAKP,EAAEQ,SAAU,CAChC,GAAIP,IAAUM,EAAG,SACjBP,EAAES,OAAOF,GACT,MAAMwT,EAAO3I,EAAGkB,qBAEhB,KAAIuH,EAAUE,GAAQD,EAAUC,EAAOH,KAAKI,kBAA5C,CAEA,IAAK,MAAM5T,KAAKJ,EAAG,CAClB,GAAII,IAAMgL,EAAI,SACd,MAAMsB,EAAMtM,EAAEkM,qBAEd,GAAII,IAAQoC,WAAWC,WAAarC,EAAMyF,EAAK,SAAS7R,CACzD,CACIyT,EAAOD,IACVA,EAAUC,EACV1I,EAAW1K,SAEZ0K,EAAWzK,YAAYZ,EAAGO,EAZoC,CAa/D,CACAP,EAAES,OAAOR,EACV,CACA,GAAIoL,EAAW5M,OAAS,EAAG,CAC1B,MAAMuD,EAAI/E,MAAKuC,EAAY6L,EAAWpJ,sBAAwBoJ,EAAWnJ,IAAI,GAI7E,OAHAJ,QAAQC,IAAIC,GACZA,EAAEG,QACElF,KAAKR,QAAQqF,QAAQC,IAAI,KAAOC,IAC7B,CACR,CACA,OAAO,CACR,CAEAsJ,GAAQC,GACHtO,KAAKR,QAAQqF,QAAQC,IAAI,UAE7B,IAAIkS,GAAc,EAClB,OAAa,CAEZ,GADA1I,EAAOA,EAAKE,SACRxO,MAAKuO,GAAS1C,OAAOyC,GAAO,CAC/B0I,GAAc,EACd,KACD,CACA,IAAKhX,MAAKkO,EAAQI,EAAKE,SAASE,aAAc,KAC/C,CACA,MAAM7E,EAAO,GACbyE,EAAKG,eAAe5E,GAEpB,IAAK,MAAMrD,KAAKqD,EACfrD,EAAE9C,QACF1D,MAAK4N,EAAU/B,OAAOrF,GACtBxG,MAAK2N,EAAY9B,OAAOrF,GAGpBwQ,GACJhX,MAAK4N,EAAUhN,IAAI0N,EAErB,CAEAK,GAAQL,GACHtO,KAAKR,QAAQqF,QAAQC,IAAI,UAC7B9E,MAAK2N,EAAY/M,IAAI0N,GAErB,IAAK,MAAMnL,KAAKnD,MAAKgO,EAAwBM,EAAKI,aAAc,CAC/D,MAAMuI,EAAKjX,MAAK6N,EAAO1K,EAAEtB,SAEpB7B,MAAK2N,EAAY1F,IAAIgP,IAAQjX,MAAK4N,EAAU3F,IAAIgP,KACpD3I,EAAK1N,IAAIqW,GACTjX,MAAK4N,EAAUhN,IAAIqW,GAErB,CACD,CAEApI,MACK7O,KAAKR,QAAQqF,QAAQC,IAAI,OAE7B,MAAOoS,GAAUlX,KAAKP,KAAKmQ,yCAC3B,IAAK,MAAMzM,KAAK+T,EAAO,CACtB,MAAMD,EAAKjX,MAAK6N,EAAO1K,EAAEtB,SACzBoV,EAAGE,UAAU,MACbnX,MAAKuO,GAAS3N,IAAIqW,EACnB,CACAjX,MAAK2N,EAAYjK,QACjB1D,MAAK4N,EAAUlK,QACf,IAAK,MAAM8C,KAAKxG,MAAKuO,GACpBvO,MAAK4N,EAAUhN,IAAI4F,GAGpB,KAAOxG,MAAKuO,GAAS/M,MAAQxB,MAAK4N,EAAUpM,MAAM,CACjD,GAAIxB,KAAKN,YAAcM,KAAKN,WAAaM,MAAKsE,IAE7C,OADItE,KAAKR,QAAQqF,QAAQC,IAAI,qDACtB,EAER,GAAI9E,MAAKiE,EAAWG,KAAKC,MAExB,OADIrE,KAAKR,QAAQqF,QAAQC,IAAI,sCACtB,EAGR,MAAMwJ,EAAOtO,MAAK4N,EAAUV,SAASC,OAAOlK,MAG5C,GAFAjD,MAAK4N,EAAU/B,OAAOyC,GAElBtO,MAAKkO,EAAQI,EAAKI,aAAc,CACnC,GAAI1O,MAAKuO,GAAS1C,OAAOyC,GAAO,SAChC,GAAItO,MAAKkO,EAAQI,EAAKE,SAASE,aAAc,CAC5C1O,MAAKqO,EAAQC,GACb,QACD,CACD,CACAtO,MAAK2O,EAAQL,EACd,CACA,OAAO,CACR,CAEApO,OAGC,GAFAF,MAAKiE,EAAkC,OAApBjE,KAAKL,WAAuBuE,OAAOC,UAAaC,KAAKC,MAAQrE,KAAKL,WACrFK,MAAKsE,EAAa,EACdtE,KAAKJ,YAAcI,KAAKJ,YAAcI,KAAKP,KAAKiQ,0BACnD,OAAO,EAER,MAAMnK,EAAM,IAAId,eAEhB,IAAI6N,GAAU,EACd,OAAa,CAEZ,IADYtS,MAAK6O,MACL7O,MAAKuO,GAAS/M,KACzB,MAED,MAAM4V,EAAmBpX,KAAKP,KAAKiQ,0BAMnC,GALI1P,KAAKR,QACRqF,QAAQC,IAAK,uBAAsBsS,MAAqBpX,KAAKJ,cAE9D2F,EAAIsB,WAAW7G,KAAKP,MAEhBO,KAAKgB,cAAcuE,EAAK6R,GAAmB,CAC9C9E,GAAU,EACV,KACD,CACA,GAAwB,OAApBtS,KAAKJ,WACR0S,GAAU,OACJ,GAAItS,KAAKJ,YAAcwX,EAAkB,CAC3CpX,KAAKR,QAAQqF,QAAQC,IAAI,4CAC7BwN,GAAU,EACV,KACD,CACD,CACA,OAAOA,CACR,CAOAnN,cAAcC,GACbpF,MAAKuC,EAAY6C,CAClB,EAID,CAEC,MAAM2I,EAELe,IAAY,GACZN,IACAO,IAEAjP,YAAYiP,GACX/O,MAAK+O,GAAOA,CACb,CAEAnO,IAAIoO,GACHA,GAAGR,GAAUxO,KACbA,MAAK8O,GAAUjJ,KAAKmJ,EACrB,CAEAtL,QACC,IAAK,MAAMsL,KAAMhP,MAAK8O,GACrBE,GAAGR,GAAU,KAEdxO,MAAK8O,GAAU9M,OAAS,CACzB,CAEAyM,eAAeQ,GACdA,EAAIpJ,KAAK7F,MAET,IAAK,MAAMgP,KAAMhP,MAAK8O,GACrBE,EAAGP,eAAeQ,EAEpB,CAEAP,YACC,OAAO1O,MAAK+O,EACb,CAEAP,SACC,OAAOxO,MAAKwO,EACb,CAEA2I,UAAU3U,GACTxC,MAAKwO,GAAUhM,CAChB,EAGDkL,UAAUK,SAAWA,CAEtB,CASA,MAAMsJ,gBAAgBV,KAErB7W,YAAY0C,GACXC,MAAMD,EACP,CAEAvC,OACC,MAAO,YACR,CAEAC,OACC,IAAIuP,EAAM,EACN6H,EAAM,EACNtX,KAAKR,SACRiQ,EAAMzP,KAAKP,KAAKiQ,0BAChB4H,EAAMtX,KAAKP,KAAK6G,qBAEjB,MAAM9B,EAAK,IAAIC,eACfD,EAAGqC,WAAW7G,KAAKP,MAEnB,MAAM8T,EAAM9Q,MAAMvC,OAUlB,OARIqT,GACHgE,kBAAkBrS,MAAMlF,KAAKP,KAAM+E,GAEhCxE,KAAKR,SACRqF,QAAQC,IAAK,YAAUyO,EAAM,UAAY,YACzC1O,QAAQC,IAAK,wBAAuB2K,QAAUzP,KAAKP,KAAKiQ,6BACxD7K,QAAQC,IAAK,oBAAmBwS,QAAUtX,KAAKP,KAAK6G,wBAE9CiN,CACR,EAYD,MAAMiE,IAELnW,UAAyB8B,EAAGsU,GAC3B,IAAK,MAAMjN,KAAOiN,EAAIlU,SAGrB,GAFAkU,EAAIjU,OAAOgH,GAEa,IAApBrH,EAAEC,cACL,OAAO,EAGT,OAAO,CACR,CAEA/B,UAAqBmB,EAAG0D,EAAKuR,GAC5B,MAAMC,EAAQxR,EAAIjD,QACZ0U,EAAQF,EAAIxU,QACZkD,EAAQD,EAAI3C,SACZsG,EAAQ,GAERxD,EAAK7D,EAAEsD,mBAAmBI,EAAKuR,GAErCG,EAAM,IAAK,MAAMpN,KAAOrE,EAAK,CAC5BD,EAAI1C,OAAOgH,GAEX,IAAK,MAAMrH,KAAKkD,EACf,GAAiB,IAAblD,EAAE3B,SACDgW,KAAIK,GAAkB1U,EAAGsU,GAAM,SAASG,EAE9C/N,EAAKhE,KAAK2E,EACX,CAIA,GAHAtE,EAAI1C,OAAOkU,GACXD,EAAIjU,OAAOmU,GAEP9N,EAAK7H,SAAWmE,EAAI3E,OAAQ,CAC/B,MAAMsW,EAAKtV,EAAEuV,aAAa,CAAE7K,OAAQrD,IAGpC,OAFA3D,EAAI8R,UAAUF,GACdjT,QAAQC,IAAIqB,EAAI3E,OAAS,OAASsW,EAAGtW,SAC9B,CACR,CACA,OAAO,CACR,CAEAH,aAAamB,GACZ,MAAM6D,EAAK,GAEX,IAAK,MAAMlD,KAAKX,EAAEsG,cACA,IAAb3F,EAAE3B,QAAc6E,EAAGzF,IAAIuC,GAE5B,MAAQkD,EAAGtE,WAAW,CACrB,MAAMoB,EAAMkD,EAAG4R,OAAO5R,EAAG7E,OAAS,GAC5B0W,EAAM/U,EAAEqB,GAAG,GACX2T,EAAMhV,EAAEqB,GAAG,GAEjB,GAAIgT,KAAIY,GAAc5V,EAAG0V,EAAKC,GAC7B,IAAK,MAAME,KAAM7V,EAAEsG,cACA,IAAduP,EAAG7W,QAAgB6W,EAAG7T,GAAG,KAAO0T,GAAOG,EAAG7T,GAAG,KAAO2T,GACvD9R,EAAGzF,IAAI,EAAGyX,EAId,CACD,EAWD,MAAMC,gBASLjX,aAAamB,EAAG+V,GACf,IAAK,MAAMxV,KAAKP,EAAE+B,YAAa,CAC9B,MAAMjB,EAAUP,EAAEQ,SACZyF,EAAUjG,EAAEE,QACZuV,EAAU,GAEhB,IAAK,MAAMrV,KAAKJ,EACf,GAAiB,IAAbI,EAAE3B,OAAN,CAEA,IAAK,MAAMgJ,KAAOlH,EACjBP,EAAES,OAAOgH,GAELrH,EAAEkM,sBAAwBkJ,GAC7BC,EAAK3S,KAAK2E,GAGZhI,EAAEiW,iBAAiBtV,EATC,CAYrB,GADAJ,EAAES,OAAOwF,GACW,IAAhBwP,EAAKxW,OACR,OAAO,EAERe,EAAEiV,UAAUxV,EAAEuV,aAAa,CAAE7K,OAAQsL,IACtC,CACA,OAAO,CACR,CAQAnX,aAAamB,GACZ,IAAK,MAAMO,KAAKP,EAAE+B,YAAa,CAC9B,MAAMjB,EAAUP,EAAEQ,SACZyF,EAAUjG,EAAEE,QACZuV,EAAU,GAEhB,IAAK,MAAMrV,KAAKJ,EACf,GAAiB,IAAbI,EAAE3B,OAAN,CAEA,IAAK,MAAMgJ,KAAOlH,EACjBP,EAAES,OAAOgH,GAEe,IAApBrH,EAAEC,eACLoV,EAAK3S,KAAK2E,GAGZhI,EAAEiW,iBAAiBtV,EATC,CAYrB,GADAJ,EAAES,OAAOwF,GACW,IAAhBwP,EAAKxW,OACR,OAAO,EAERe,EAAEiV,UAAUxV,EAAEuV,aAAa,CAAE7K,OAAQsL,IACtC,CACA,OAAO,CACR,EAWD,MAAMjB,kBAELlW,aAAamB,EAAGkW,GAGf,IAAIC,EAFJ9T,QAAQC,IAAI,4BAGZ,IAAI1E,EAAQ,EAEZ,EAAG,CACFyE,QAAQC,IAAI,6BAA+B1E,KAE3CuY,GAAa,EACb,IAAIC,EAAQpW,EAAEkN,0BAEd,IAAK,IAAIvN,EAAI,EAAGA,EAAIK,EAAEoE,iBAAkBzE,EAAG,CAC1C,MAAMY,EAAIP,EAAEqW,WAAW1W,GACjB2W,EAAM/V,EAAEE,QAERiE,EAAIwR,EAAKzT,IAAI9C,GACf2W,IAAQ5R,EAAEjE,UAEdiE,EAAEhC,QACE1C,EAAEkN,2BAA6BkJ,EAClCD,GAAa,EAEb5V,EAAES,OAAOsV,GAEX,CACD,OAASH,GAGT,OADA9T,QAAQC,IAAI,8BACL,CACR","file":"solver.min.js","sourcesContent":["/**\n * The interface of solvers for finding solutions to constraint satisfaction problems.\n *\n * @author Takuto Yanagida\n * @version 2023-03-25\n */\n\nclass Solver {\n\n\t_debug = true;\n\n\t/**\n\t * The crisp/fuzzy constraint satisfaction problem solved by the solver.\n\t */\n\t_pro;\n\n\t/**\n\t *  Limit number of iterations.\n\t */\n\t_iterLimit = null;\n\n\t/**\n\t * Time limit.\n\t */\n\t_timeLimit = null;\n\n\t/**\n\t * Target 'satisfied constraint rate' or 'constraint satisfaction degree'.\n\t */\n\t_targetDeg = 0.8;\n\n\t/**\n\t * Listeners of this solver.\n\t */\n\t#listener = [];\n\n\t/**\n\t * Generates a solver given a constraint satisfaction problem.\n\t * @param pro A constraint satisfaction problem.\n\t */\n\tconstructor(pro) {\n\t\tthis._pro = pro;\n\t}\n\n\t/**\n\t * Returns the name of the solver.\n\t * @return The name.\n\t */\n\tname() {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Placeholder for implementing an algorithm.\n\t * The solve method calls this method and returns the return value of this method.\n\t * @return True if the algorithm succeeds,\n\t */\n\texec() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Sets and limits the maximum number of iterations for the solver's behavior.\n\t * After the specified number of iterations, the solver stops as a failure. The specific behavior depends on the solver.\n\t * @param count Maximum value; null means not set.\n\t */\n\tsetIterationLimit(count = null) {\n\t\tthis._iterLimit = count;\n\t}\n\n\t/**\n\t * Sets a time limit on the solver's behavior.\n\t * If the specified time is exceeded, the solver stops as a failure. The specific behavior depends on the solver.\n\t * @param msec Time limit. null means not set.\n\t */\n\tsetTimeLimit(msec = null) {\n\t\tthis._timeLimit = msec;\n\t}\n\n\t/**\n\t * The goal to be achieved, which is the condition for stopping the solver, is set as the constraint satisfaction degree (fuzzy) or the percentage of constraints satisfied (crisp).\n\t * The solver stops as success if the specified percentage is reached or exceeded. The specific behavior depends on the solver.\n\t * @param rate Degree or rate. null indicates not set.\n\t */\n\tsetTargetRate(rate = null) {\n\t\tthis._targetDeg = rate;\n\t}\n\n\t/**\n\t * Computes the solution to a constraint satisfaction problem.\n\t * The specific meaning of the return value depends on the implementation of the algorithm.\n\t * @return True if the algorithm succeeds\n\t */\n\tsolve() {\n\t\treturn this.exec();\n\t}\n\n\taddListener(l) {\n\t\tthis.#listener.add(l);\n\t}\n\n\tremoveListener(l) {\n\t\tthis.#listener.splice(this.#listener.indexOf(l), 1);\n\t}\n\n\tfoundSolution(solution, worstDegree) {\n\t\tlet finish = false;\n\n\t\tfor (const l of this.#listener) {\n\t\t\tif (l.foundSolution(solution, worstDegree)) {\n\t\t\t\tfinish = true;\n\t\t\t}\n\t\t}\n\t\treturn finish;\n\t}\n\n}\n\n/**\n * This class holds the branch pruning states for a domain.\n *\n * @author Takuto Yanagida\n * @version 2023-03-25\n */\n\nclass DomainPruner {\n\n\tstatic #UNHIDDEN = -1;\n\n\t#hiddenLevels;\n\t#hiddenSize = 0;\n\n\t/**\n\t * Generates a class that holds branch pruning states for a domain.\n\t * @param size Size of the corresponding domain\n\t */\n\tconstructor(size) {\n\t\tthis.#hiddenLevels = new Array(size);\n\t\tthis.#hiddenLevels.fill(DomainPruner.#UNHIDDEN);\n\t}\n\n\t/**\n\t * Returns the size of the erased element.\n\t * @return Size of the erased element.\n\t */\n\thiddenSize() {\n\t\treturn this.#hiddenSize;\n\t}\n\n\t/**\n\t * Erases the element at the specified index.\n\t * @param index Index.\n\t * @param level Level.\n\t */\n\thide(index, level) {\n\t\tif (this.#hiddenLevels[index] === DomainPruner.#UNHIDDEN) {\n\t\t\t++this.#hiddenSize;\n\t\t}\n\t\tthis.#hiddenLevels[index] = level;\n\t}\n\n\t/**\n\t * Returns whether the element is empty or not.\n\t * Returns true if all elements have been erased.\n\t * @return True if empty.\n\t */\n\tisEmpty() {\n\t\treturn this.#hiddenLevels.length === this.#hiddenSize;\n\t}\n\n\t/**\n\t * Returns whether or not the element at the specified index has been erased.\n\t * @param index Index.\n\t * @return True if erased.\n\t */\n\tisValueHidden(index) {\n\t\treturn this.#hiddenLevels[index] !== DomainPruner.#UNHIDDEN;\n\t}\n\n\t/**\n\t * Restores the value that had been erased, by specifying a level.\n\t * @param level Level\n\t */\n\treveal(level) {\n\t\tfor (let i = 0; i < this.#hiddenLevels.length; i++) {\n\t\t\tif (this.#hiddenLevels[i] === level) {\n\t\t\t\tthis.#hiddenLevels[i] = DomainPruner.#UNHIDDEN;\n\t\t\t\t--this.#hiddenSize;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Restores all erased values.\n\t */\n\trevealAll() {\n\t\tthis.#hiddenLevels.fill(DomainPruner.#UNHIDDEN);\n\t\tthis.#hiddenSize = 0;\n\t}\n\n}\n\n\n/**\n * Class implements a solver using the breakout method.\n * Solves a problem as a maximum CSP.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass Breakout extends Solver {\n\n\t#weights;\n\n\t#isRandom = true;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tthis.#weights = new Array(this._pro.constraintSize());\n\t\tthis.#weights.fill(1);\n\t}\n\n\tname() {\n\t\treturn 'Breakout';\n\t}\n\n\t#findCandidates(vioVars, canList) {\n\t\tlet maxDiff = 0;\n\n\t\tfor (const v of vioVars) {\n\t\t\tconst v_val = v.value();  // Save the value\n\n\t\t\tlet nowVio = 0;\n\t\t\tfor (const c of v) {\n\t\t\t\tnowVio += (1 - c.isSatisfied()) * this.#weights[c.index()];\n\t\t\t}\n\t\t\tout: for (const d of v.domain()) {\n\t\t\t\tif (v_val === d) continue;\n\t\t\t\tv.assign(d);\n\t\t\t\tlet diff = nowVio;\n\t\t\t\tfor (const c of v) {\n\t\t\t\t\tdiff -= (1 - c.isSatisfied()) * this.#weights[c.index()];\n\t\t\t\t\t// If the improvement is less than the previous improvement, try the next variable.\n\t\t\t\t\tif (diff < maxDiff) {\n\t\t\t\t\t\tcontinue out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (diff > maxDiff) {  // Found assignments that are better than ever before.\n\t\t\t\t\tmaxDiff = diff;\n\t\t\t\t\tcanList.clear();\n\t\t\t\t\tcanList.addVariable(v, d);\n\t\t\t\t} else if (maxDiff !== 0) {  // Found assignments that can be improved to the same level as before.\n\t\t\t\t\tcanList.addVariable(v, d);\n\t\t\t\t}\n\t\t\t}\n\t\t\tv.assign(v_val);  // Restore the value.\n\t\t}\n\t}\n\n\t#listViolatingVariables(vioCons) {\n\t\tconst vvs = new Set();\n\t\tfor (const c of vioCons) {\n\t\t\tfor (const v of c) {\n\t\t\t\tvvs.add(v);\n\t\t\t}\n\t\t}\n\t\treturn Array.from(vvs);\n\t}\n\n\texec() {\n\t\tconst endTime = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tlet iterCount = 0;\n\n\t\tfor (const v of this._pro.variables()) {\n\t\t\tif (v.isEmpty()) v.assign(v.domain().at(0));\n\t\t}\n\n\t\tconst canList = new AssignmentList();\n\n\t\twhile (true) {\n\t\t\tconst vc = this._pro.violatingConstraints();\n\t\t\tif ((this._targetDeg ?? 1) <= this._pro.satisfiedConstraintRate()) {  // Success if violation rate improves from specified\n\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this._iterLimit && this._iterLimit < iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this._debug) console.log(vc.length + ' violations');\n\t\t\tthis.#findCandidates(this.#listViolatingVariables(vc), canList);\n\n\t\t\tif (0 < canList.size()) {\n\t\t\t\tconst e = this.#isRandom ? canList.arbitraryAssignment() : canList.get(0);\n\t\t\t\te.apply();\n\t\t\t\tcanList.clear();\n\t\t\t\tif (this._debug) console.log('\\t' + e);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < vc.length; ++i) this.#weights[vc[i].index()]++;\n\t\t\t\tif (this._debug) console.log('breakout');\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets the randomness of the algorithm.\n\t * Enabling randomness reduces the risk of local solutions, but makes the solution unrepeatable.\n\t * @param flag Whether the randomness is enabled.\n\t */\n\tsetRandomness(flag) {\n\t\tthis.#isRandom = flag;\n\t}\n\n}\n\n/**\n * This class that implements the forward checking method.\n * The minimum-remaining-values (MRV) heuristic can also be used by specifying the option.\n * Searches for variable assignments that satisfy all constraints and fails if none are found.\n * Each variable must have its own domain because it hides domain elements as branch pruning.\n * Forward checking is also performed for problems with polynomial constraints.\n *\n * @author Takuto Yanagida\n * @version 2023-04-10\n */\n\nclass ForwardChecking extends Solver {\n\n\t#vars;\n\t#sol = new AssignmentList();\n\t#relCons;  // Table to cache constraints between two variables.\n\n\t#useMRV = false;\n\n\t#iterCount;\n\t#endTime;\n\n\t/**\n\t * Generates a solver given a constraint satisfaction problem.\n\t * @param p A problem.\n\t */\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tthis.#vars = [...this._pro.variables()];\n\t\tfor (const v of this.#vars) {\n\t\t\tv.solverObject = new DomainPruner(v.domain().size());\n\t\t}\n\t\tthis.#initializeRelatedConstraintTable();\n\t}\n\n\tname() {\n\t\treturn 'Forward Checking';\n\t}\n\n\t// Initializes a table that caches constraints between two variables.\n\t#initializeRelatedConstraintTable() {\n\t\tconst temp     = [];\n\t\tthis.#relCons = [];\n\n\t\tfor (let j = 0; j < this.#vars.length; ++j) {\n\t\t\tthis.#relCons.push(new Array(this.#vars.length));\n\n\t\t\tfor (let i = 0; i < this.#vars.length; ++i) {\n\t\t\t\tif (i < j) {\n\t\t\t\t\tthis.#relCons[j][i] = this._pro.constraintsBetween(this.#vars[i], this.#vars[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Retrieves an array of constraints from a table that caches constraints between two variables.\n\t#getConstraintsBetween(i, j) {\n\t\tif (i < j) {\n\t\t\treturn this.#relCons[j][i];\n\t\t}\n\t\treturn this.#relCons[i][j];\n\t}\n\n\t// Checks for possible assignment to a future variable from the current variable assignment.\n\t#checkForward(level, currentIndex) {\n\t\tfor (const v_i of this.#vars) {\n\t\t\tif (!v_i.isEmpty()) continue;  // If it is a past or present variable.\n\t\t\tconst d_i  = v_i.domain();\n\t\t\tconst dc_i = v_i.solverObject;\n\t\t\tconst cs   = this.#getConstraintsBetween(currentIndex, v_i.index());\n\n\t\t\tfor (const c of cs) {\n\t\t\t\tif (c.emptyVariableSize() !== 1) continue;\n\n\t\t\t\tfor (let k = 0, n = d_i.size(); k < n; ++k) {\n\t\t\t\t\tif (dc_i.isValueHidden(k)) continue;\n\t\t\t\t\tv_i.assign(d_i.at(k));\n\n\t\t\t\t\tif (c.isSatisfied() === 0) {  // Do hide when in violation (not even undefined).\n\t\t\t\t\t\tdc_i.hide(k, level);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tv_i.clear();\n\t\t\t\tif (dc_i.isEmpty()) return false;  // Failure if the domain of one of the future variables is empty.\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Returns the index of the smallest domain variable.\n\t#indexOfVariableWithMRV() {\n\t\tlet index = 0;\n\t\tlet size  = Number.MAX_VALUE;\n\n\t\tfor (let i = 0; i < this.#vars.length; ++i) {\n\t\t\tconst v = this.#vars[i];\n\t\t\tif (!v.isEmpty()) continue;\n\t\t\tconst d = v.domain();\n\t\t\tconst s = d.size() - v.solverObject.hiddenSize();\n\t\t\tif (s < size) {\n\t\t\t\tsize  = s;\n\t\t\t\tindex = i;\n\t\t\t}\n\t\t}\n\t\treturn index;\n\t}\n\n\t// Searches for one variable at a time.\n\t#branch(level) {\n\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {  // Failure if repeated a specified number.\n\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\treturn false;\n\t\t}\n\t\tif (this.#endTime < Date.now()) {  // Failure if time limit is exceeded.\n\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (level === this._pro.variableSize()) {\n\t\t\tthis.#sol.setProblem(this._pro);\n\t\t\treturn true;\n\t\t}\n\t\tconst vc_index = this.#useMRV ? this.#indexOfVariableWithMRV() : level;\n\t\tconst vc       = this.#vars[vc_index];\n\t\tconst d        = vc.domain();\n\t\tconst dc       = vc.solverObject;\n\t\tfor (let i = 0, n = d.size(); i < n; ++i) {\n\t\t\tif (dc.isValueHidden(i)) continue;\n\t\t\tvc.assign(d.at(i));\n\t\t\tif (this.#checkForward(level, vc_index) && this.#branch(level + 1)) return true;\n\t\t\tfor (const v of this.#vars) {\n\t\t\t\tv.solverObject.reveal(level);\n\t\t\t}\n\t\t}\n\t\tvc.clear();\n\t\treturn false;\n\t}\n\n\t// Do search.\n\texec() {\n\t\tthis.#endTime   = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount = 0;\n\n\t\tthis._pro.clearAllVariables();\n\t\tconst r = this.#branch(0);\n\n\t\tfor (let i = 0; i < this.#sol.size(); ++i) {\n\t\t\tconst a = this.#sol.get(i);\n\t\t\ta.apply();\n\t\t\ta.variable().solverObject.revealAll();\n\t\t}\n\t\treturn r;\n\t}\n\n\t/**\n\t * The settings made by this method are invalid.\n\t */\n\tsetTargetRate() {\n\t\t// Do nothing.\n\t}\n\n\t/**\n\t * Specify whether to use the minimum-remaining-values (MRV) heuristic.\n\t * Use of MRV may increase processing time for some problems.\n\t * Default is false.\n\t * @param flag Use MRV if true.\n\t */\n\tsetUsingMinimumRemainingValuesHeuristics(flag) {\n\t\tthis.#useMRV = flag;\n\t}\n\n}\n\n/**\n * This class that implements the forward checking method.\n * Find the solution to the problem as the maximum CSP.\n * Each variable must have its own domain because it hides domain elements as branch pruning.\n *\n * @author Takuto Yanagida\n * @version 2023-03-31\n */\n\nclass MaxForwardChecking extends Solver {\n\n\t#vars;\n\t#sol = new AssignmentList();\n\n\t#maxVioCount;\n\t#vioCount;\n\t#checkedCons = new Set();\n\t#cons = [];\n\n\t#iterCount;\n\t#endTime;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tthis.#vars = [...this._pro.variables()];\n\t\tfor (const v of this.#vars) {\n\t\t\tv.solverObject = new DomainPruner(v.domain().size());\n\t\t}\n\t\tthis.#maxVioCount = this._pro.constraintSize();\n\t}\n\n\tname() {\n\t\treturn 'Forward Checking for Max CSPs';\n\t}\n\n\t#branch(level, vioCount) {\n\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) return false;  // Failure if repeated a specified number.\n\t\tif (this.#endTime < Date.now()) return false;  // Failure if time limit is exceeded.\n\n\t\tif (level === this._pro.variableSize()) {\n\t\t\tconst vcs = this._pro.violatingConstraintSize();\n\t\t\tif (vcs < this.#maxVioCount) {\n\t\t\t\tthis.#maxVioCount = vcs;\n\t\t\t\tthis.#sol.setProblem(this._pro);\n\t\t\t\tif (this._debug) console.log(`   refreshed ${this.#maxVioCount}`);\n\t\t\t\tif ((this._targetDeg ?? 1) <= this._pro.satisfiedConstraintRate()) return true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\tconst vc  = this.#vars[level];\n\t\tconst dom = vc.domain();\n\t\tconst dc  = vc.solverObject;\n\n\t\tfor (let i = 0; i < dom.size(); ++i) {\n\t\t\tif (dc.isValueHidden(i)) continue;\n\t\t\tvc.assign(dom.at(i));\n\t\t\tthis.#vioCount = vioCount + this.#getAdditionalViolationCount(level, vc);  // for max begin\n\t\t\tif (this.#vioCount > this.#maxVioCount) continue;  // for max end\n\t\t\tif (this.#checkForward(level) && this.#branch(level + 1, this.#vioCount)) return true;\n\t\t\tfor (const v of this.#vars) {\n\t\t\t\tv.solverObject.reveal(level);\n\t\t\t}\n\t\t}\n\t\tvc.clear();\n\t\treturn false;\n\t}\n\n\t// Checks for possible assignment to a future variable from the current variable assignment.\n\t#checkForward(level) {\n\t\tconst vc = this.#vars[level];\n\n\t\tfor (let i = level + 1; i < this.#vars.length; ++i) {\n\t\t\tconst future = this.#vars[i];\n\t\t\tthis.#cons = this._pro.constraintsBetween(vc, future);\n\n\t\t\tfor (const c of this.#cons) {\n\t\t\t\tif (c.emptyVariableSize() !== 1) continue;\n\t\t\t\tif (this.#revise(future, c, level)) {\n\t\t\t\t\tif (future.solverObject.isEmpty()) return false;  // Failure if the domain of one of the future variables is empty.\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Find the number of constraint violations that have increased due to the current value of the variable vc.\n\t#getAdditionalViolationCount(level, vc) {\n\t\tlet avc = 0;\n\t\tthis.#checkedCons.clear();  // Reuse.\n\t\tfor (let i = 0; i < level; ++i) {\n\t\t\tthis.#cons = this._pro.constraintsBetween(vc, this.#vars[i]);\n\n\t\t\tfor (const c of this.#cons) {\n\t\t\t\tif (this.#checkedCons.has(c)) continue;  // Because of the possibility of duplication in polynomial constraints\n\t\t\t\tif (c.isSatisfied() === 0) ++avc;  // Neither satisfied nor undefined.\n\t\t\t\tthis.#checkedCons.add(c);\n\t\t\t}\n\t\t}\n\t\treturn avc;\n\t}\n\n\t// Remove values from the domain of v1 that do not correspond to v2. That is, match v1 with v2.\n\t#revise(v1, c, level) {\n\t\tlet deleted = false;\n\n\t\tconst dom = v1.domain();\n\t\tconst dc  = v1.solverObject;\n\n\t\tfor (let i = 0; i < dom.size(); ++i) {\n\t\t\tif (dc.isValueHidden(i)) continue;\n\t\t\tv1.assign(dom.at(i));\n\n\t\t\tif (c.isSatisfied() === 0 && this.#vioCount + 1 > this.#maxVioCount) {\n\t\t\t\tdc.hide(i, level);\n\t\t\t\tdeleted = true;\n\t\t\t}\n\t\t}\n\t\treturn deleted;\n\t}\n\n\texec() {\n\t\tthis.#endTime   = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount = 0;\n\n\t\tthis._pro.clearAllVariables();\n\t\tconst r = this.#branch(0, 0);\n\t\tif (this._debug) {\n\t\t\tif (r) {\n\t\t\t\tconsole.log('stop: current degree is above the target');\n\t\t\t} else {\n\t\t\t\tif (this._iterLimit && this._iterLimit < this.#iterCount) {\n\t\t\t\t\tconsole.log('stop: number of iterations has reached the limit');\n\t\t\t\t}\n\t\t\t\tif (this.#endTime < Date.now()) {\n\t\t\t\t\tconsole.log('stop: time limit has been reached');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < this.#sol.size(); ++i) {\n\t\t\tconst a = this.#sol.get(i);\n\t\t\ta.apply();\n\t\t\ta.variable().solverObject.revealAll();\n\t\t}\n\t\treturn r;\n\t}\n\n}\n\n/**\n * This class implements GENET.\n * CSP (but only Binary CSP) is supported.\n * Find the solution to the problem as the maximum CSP.\n *\n * @author Takuto Yanagida\n * @version 2023-04-10\n */\n\nclass GENET extends Solver {\n\n\tstatic nextInt(max) {\n\t\treturn Math.floor(Math.random() * Math.floor(max));\n\t}\n\n\t#clusters = [];\n\t#connections;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tif (!this.#createNetwork()) {\n\t\t\tthrow new Exception();\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'GENET';\n\t}\n\n\t#createNetwork() {\n\t\tif (this._debug) console.log('network creation start');\n\t\tconst cons = [];\n\n\t\tfor (const v of this._pro.variables()) {\n\t\t\tif (v.domain().size() === 0) return false;\n\t\t\tthis.#clusters.push(new GENET.Cluster(v));\n\t\t}\n\t\tfor (const c of this._pro.constraints()) {\n\t\t\tif (c.size() === 1) {  // In the case of unary constraints.\n\t\t\t\tconst v  = c.at(0);\n\t\t\t\tconst cl = this.#clusters[c.at(0).index()];\n\n\t\t\t\tfor (let i = 0; i < cl.size(); ++i) {\n\t\t\t\t\tconst origVal = v.value();  // Save the value.\n\t\t\t\t\tv.assign(cl.get(i)._value);\n\n\t\t\t\t\tif (c.isSatisfied() === 0) {\n\t\t\t\t\t\tcons.push(new GENET.Connection(cl.get(i)));\n\t\t\t\t\t}\n\t\t\t\t\tv.assign(origVal);  // Restore the value.\n\t\t\t\t}\n\t\t\t} else {  // In the case of binary constraints.\n\t\t\t\tconst v1   = c.at(0);\n\t\t\t\tconst v2   = c.at(1);\n\t\t\t\tconst cl_f = this.#clusters[c.at(0).index()];\n\t\t\t\tconst cl_s = this.#clusters[c.at(1).index()];\n\n\t\t\t\tfor (let i = 0; i < cl_f.size(); ++i) {\n\t\t\t\t\tconst origVal1 = v1.value();  // Save the value.\n\t\t\t\t\tv1.assign(cl_f.get(i)._value);\n\n\t\t\t\t\tfor (let j = 0; j < cl_s.size(); ++j) {\n\t\t\t\t\t\tconst origVal2 = v2.value();  // Save the value.\n\t\t\t\t\t\tv2.assign(cl_s.get(j)._value);\n\n\t\t\t\t\t\tif (c.isSatisfied() === 0) {\n\t\t\t\t\t\t\tcons.push(new GENET.Connection(cl_f.get(i), cl_s.get(j)));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tv2.assign(origVal2);  // Restore the value.\n\t\t\t\t\t}\n\t\t\t\t\tv1.assign(origVal1);  // Restore the value.\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const cl of this.#clusters) {\n\t\t\tfor (const n of cl._neurons) n.lockConnections();\n\t\t}\n\t\tthis.#connections = cons;\n\t\tif (this._debug) console.log('network creation complete');\n\t\treturn true;\n\t}\n\n\t#shuffle(is) {\n\t\tfor (let i = is.length; i > 1; --i) {\n\t\t\tconst j    = GENET.nextInt(i);\n\t\t\tconst temp = is[i - 1];\n\t\t\tis[i - 1] = is[j];\n\t\t\tis[j]     = temp;\n\t\t}\n\t\treturn is;\n\t}\n\n\texec() {\n\t\tconst endTime = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tlet iterCount = 0;\n\n\t\tconst sol   = new AssignmentList();\n\t\tconst order = [];\n\t\tfor (let i = 0; i < this.#clusters.length; i++) {\n\t\t\torder.push(i);\n\t\t}\n\n\t\tlet cur = this._pro.satisfiedConstraintRate();\n\n\t\twhile (true) {\n\t\t\tif (this._iterLimit && this._iterLimit < iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet modified = false;\n\t\t\tfor (const i of this.#shuffle(order)) {\n\t\t\t\tif (this.#clusters[i].setActivityMaximumInput()) {\n\t\t\t\t\tmodified = true;  // Turn on the node with the largest input in each cluster\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!modified) {  // When the local minimum solution is reached.\n\t\t\t\tfor (const con of this.#connections) {\n\t\t\t\t\tcon.refreshWeight();  // Update weights for all connections\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const clu of this.#clusters) {\n\t\t\t\t\tclu.applyToVariable();  // Apply to variable\n\t\t\t\t}\n\t\t\t\tconst d = this._pro.satisfiedConstraintRate();\n\t\t\t\tif (cur < d) {  // If it's a better assignment than ever, save it.\n\t\t\t\t\tcur = d;\n\t\t\t\t\tif (this._debug) console.log(`satisfied constraint rate: ${d}`);\n\t\t\t\t\tsol.setProblem(this._pro);\n\t\t\t\t\tif (this._targetDeg ?? 1 <= cur) {  // Success if violation rate improves from specified\n\t\t\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\t\t\tsol.apply();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsol.apply();  // Despite the failures, the best assignment so far is applied for now.\n\t\treturn false;\n\t}\n\n}\n\n{\n\n\tclass Cluster {\n\n\t\tstatic nextInt(max) {\n\t\t\treturn Math.floor(Math.random() * Math.floor(max));\n\t\t}\n\n\t\t#var;\n\t\t#index;\n\t\t#maxNeurons = [];\n\t\t_neurons    = [];\n\n\t\tconstructor(v) {\n\t\t\tthis.#var = v;\n\n\t\t\tfor (const val of v.domain()) {\n\t\t\t\tthis._neurons.push(new Neuron(val));\n\t\t\t}\n\t\t\tthis.#setActivity(Cluster.nextInt(this._neurons.length));\n\t\t}\n\n\t\t#setActivity(index) {\n\t\t\tfor (const n of this._neurons) {\n\t\t\t\tn._isActive = false;\n\t\t\t}\n\t\t\tthis._neurons[index]._isActive = true;\n\t\t\tthis.#index = index;\n\t\t}\n\n\t\tapplyToVariable() {\n\t\t\tthis.#var.assign(this._neurons[this.#index]._value);\n\t\t}\n\n\t\tget(index) {\n\t\t\treturn this._neurons[index];\n\t\t}\n\n\t\tneurons() {\n\t\t\treturn this._neurons;\n\t\t}\n\n\t\t// Turn on the node with the largest input.\n\t\tsetActivityMaximumInput() {\n\t\t\tthis.#maxNeurons.length = 0;\n\n\t\t\tlet max       = Number.NEGATIVE_INFINITY;\n\t\t\tlet alreadyOn = false;\n\n\t\t\tfor (let i = 0; i < this._neurons.length; ++i) {\n\t\t\t\tconst input = this._neurons[i].getInput();\n\n\t\t\t\tif (max <= input) {\n\t\t\t\t\tif (max < input) {\n\t\t\t\t\t\tmax = input;\n\t\t\t\t\t\tthis.#maxNeurons.length = 0;\n\t\t\t\t\t\talreadyOn = false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.#maxNeurons.push(i);\n\t\t\t\t\tif (this.#index === i) {\n\t\t\t\t\t\talreadyOn = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (alreadyOn || this.#maxNeurons.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.#setActivity(this.#maxNeurons[Cluster.nextInt(this.#maxNeurons.length)]);\n\t\t\treturn true;\n\t\t}\n\n\t\tsize() {\n\t\t\treturn this._neurons.length;\n\t\t}\n\n\t}\n\tGENET.Cluster = Cluster;\n\n\tclass Connection {\n\n\t\t#first;\n\t\t#second;\n\t\t_weight;  // Direct reference (read) allowed.\n\n\t\t// Order of neurons must be the same as the order of variables that the constraint has.\n\t\tconstructor(first, second = null) {\n\t\t\tthis._weight = -1;\n\n\t\t\tthis.#first = first;\n\t\t\tthis.#first.addConnection(this);\n\t\t\tthis.#second = second;\n\t\t\tif (this.#second !== null) {\n\t\t\t\tthis.#second.addConnection(this);\n\t\t\t}\n\t\t}\n\n\t\tgetNeuron(self) {\n\t\t\tif (self === this.#first)  return this.#second;\n\t\t\tif (self === this.#second) return this.#first;\n\t\t\treturn null;\n\t\t}\n\n\t\trefreshWeight() {\n\t\t\tif (!this.#first._isActive || (this.#second !== null && !this.#second._isActive)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._weight += -1;\n\t\t}\n\n\t}\n\tGENET.Connection = Connection;\n\n\tclass Neuron {\n\n\t\t#conTemp = [];\n\t\t#connections;\n\t\t_value;  // Direct reference (read) allowed.\n\t\t_isActive = false;  // Direct reference (read, write) allowed.\n\n\t\tconstructor(value) {\n\t\t\tthis._value = value;\n\t\t}\n\n\t\taddConnection(c) {\n\t\t\tthis.#conTemp.push(c);\n\t\t}\n\n\t\tlockConnections() {\n\t\t\tthis.#connections = [...this.#conTemp];\n\t\t\tthis.#conTemp     = null;  // No longer being used.\n\t\t}\n\n\t\tgetInput() {\n\t\t\tlet ret = 0;\n\t\t\tfor (const c of this.#connections) {\n\t\t\t\tconst n = c.getNeuron(this);  // If n is null, then the unary constraint.\n\t\t\t\tret += c._weight * ((n === null || n._isActive) ? 1 : 0);\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t}\n\tGENET.Neuron = Neuron;\n\n}\n\n/**\n * Class implements the local changes method.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass LocalChanges extends Solver {\n\n\tstatic #setPlusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.add(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setMinusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.delete(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setPlusElement(s, e) {\n\t\tconst sn = new Set(s);\n\t\tsn.add(e);\n\t\treturn sn;\n\t}\n\n\tstatic #setMinusElement(s, e) {\n\t\tconst sn = new Set(s);\n\t\tsn.delete(e);\n\t\treturn sn;\n\t}\n\n\t#iterCount;\n\t#endTime;\n\t#globalReturn;\n\n\tconstructor(p, unassignAll = false) {\n\t\tsuper(p);\n\t\tif (unassignAll) {\n\t\t\tthis._pro.clearAllVariables();\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'Local Changes';\n\t}\n\n\t#createNewV3(V1_V2, v, val) {\n\t\tconst newV3 = new Set();\n\t\tconst cs    = new Set();\n\n\t\tfor (const va of V1_V2) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, va);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tconst origVal = v.value();  // Save the value.\n\t\tv.assign(val);\n\n\t\tfor (const c of cs) {\n\t\t\tif (c.isSatisfied() === 0) {\n\t\t\t\tfor (const vi of c) {\n\t\t\t\t\tnewV3.add(vi);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tv.assign(origVal);  // Restore the value.\n\t\tnewV3.delete(v);\n\t\treturn newV3;\n\t}\n\n\t#isConsistent(A, v, val) {\n\t\tconst cs = new Set();\n\n\t\tfor (const va of A) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, va);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tconst origVal = v.value();  // Save the value.\n\t\tv.assign(val);\n\n\t\tfor (const c of cs) {\n\t\t\tif (c.isSatisfied() === 0) {\n\t\t\t\tv.assign(origVal);  // Restore the value.\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tv.assign(origVal);  // Restore the value.\n\t\treturn true;\n\t}\n\n\t#lcValue(V1, V2, v, val) {\n\t\tif (!this.#isConsistent(V1, v, val)) {\n\t\t\treturn false;\n\t\t}\n\t\tconst V1_V2 = LocalChanges.#setPlusSet(V1, V2);\n\t\tif (this.#isConsistent(V1_V2, v, val)) {\n\t\t\treturn true;\n\t\t}\n\t\tconst V3 = this.#createNewV3(V1_V2, v, val);\n\n\t\tconst T = LocalChanges.#setMinusSet(V1_V2, V3);\n\t\tif (!this.#isConsistent(T, v, val)) {\n\t\t\tif (this._debug) console.log('bug');\n\t\t}\n\n\t\tfor (const vv of V3) {\n\t\t\tvv.clear();\n\t\t}\n\t\tV1 = LocalChanges.#setPlusElement(V1, v);\n\t\tV2 = LocalChanges.#setMinusSet(V2, V3);\n\t\treturn this.#lcVariables(V1, V2, V3);\n\t}\n\n\t#lcVariable(V1, V2, v, d) {\n\t\tif (d.size === 0) {\n\t\t\treturn false;\n\t\t}\n\t\tconst val = d.values().next().value;\n\t\tconst  al = AssignmentList.fromVariables(V2);\n\t\tv.assign(val);\n\n\t\tconst ret = this.#lcValue(V1, V2, v, val);\n\t\tif (ret || this.#globalReturn) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tv.clear();\n\t\tal.apply();\n\n\t\treturn this.#lcVariable(V1, V2, v, LocalChanges.#setMinusElement(d, val));\n\t}\n\n\t#lcVariables(V1, V2, V3) {\n\t\tif (this._debug) {\n\t\t\tconsole.log(`V1 ${V1.size}, V2' ${V2.size}, V3' ${V3.size}`);\n\t\t}\n\t\tif ((this._targetDeg ?? 1) <= this._pro.satisfiedConstraintRate()) {  // Success if violation rate improves from specified\n\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\tthis.#globalReturn = true;\n\t\t\treturn true;\n\t\t}\n\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {  // Failure if repeated a specified number\n\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\tthis.#globalReturn = true;\n\t\t\treturn false;\n\t\t}\n\t\tif (this.#endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\tthis.#globalReturn = true;\n\t\t\treturn false;\n\t\t}\n\n\t\tif (V3.size === 0) {\n\t\t\treturn true;\n\t\t}\n\t\tconst v = V3.values().next().value;\n\t\tconst d = new Set();\n\t\tfor (const val of v.domain()) {\n\t\t\td.add(val);\n\t\t}\n\n\t\tconst ret = this.#lcVariable(V1, V2, v, d);\n\t\tif (!ret || this.#globalReturn) {\n\t\t\treturn ret;\n\t\t}\n\t\tV2 = LocalChanges.#setPlusElement(V2, v);\n\t\tV3 = LocalChanges.#setMinusElement(V3, v);\n\t\treturn this.#lcVariables(V1, V2, V3);\n\t}\n\n\texec() {\n\t\tthis.#endTime      = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount    = 0;\n\t\tthis.#globalReturn = false;\n\n\t\tif (this._pro.emptyVariableSize() === 0) {\n\t\t\tthis._pro.clearAllVariables();\n\t\t}\n\t\tconst notFixed   = new Set();\n\t\tconst unassigned = new Set();\n\t\tfor (const v of this._pro.variables()) {\n\t\t\t(!v.isEmpty() ? notFixed : unassigned).add(v);\n\t\t}\n\t\treturn this.#lcVariables(new Set(), notFixed, unassigned);\n\t}\n\n}\n\n/**\n * Class implements the local changes method.\n * The implementation is optimized by converting recursive calls to loops.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass LocalChangesEx extends Solver {\n\n\tstatic #setPlusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.add(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setMinusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.delete(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setPlusElement(s, e) {\n\t\tconst sn = new Set(s);\n\t\tsn.add(e);\n\t\treturn sn;\n\t}\n\n\tstatic #setMinusElement(s, e) {\n\t\tconst sn = new Set(s);\n\t\tsn.delete(e);\n\t\treturn sn;\n\t}\n\n\t#iterCount;\n\t#endTime;\n\t#globalReturn;\n\n\tconstructor(p, unassignAll = false) {\n\t\tsuper(p);\n\t\tif (unassignAll) {\n\t\t\tthis._pro.clearAllVariables();\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'Local Changes Ex';\n\t}\n\n\t#createNewV3(V1_V2, v, val) {\n\t\tconst newV3 = new Set();\n\t\tconst cs    = new Set();\n\n\t\tfor (const va of V1_V2) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, va);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tconst origVal = v.value();  // Save the value.\n\t\tv.assign(val);\n\n\t\tfor (const c of cs) {\n\t\t\tif (c.isSatisfied() === 0) {\n\t\t\t\tfor (const vi of c) {\n\t\t\t\t\tnewV3.add(vi);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tv.assign(origVal);  // Restore the value.\n\t\tnewV3.delete(v);\n\t\treturn newV3;\n\t}\n\n\t#isConsistent(A, v, val) {\n\t\tconst cs = new Set();\n\n\t\tfor (const va of A) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, va);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tconst origVal = v.value();  // Save the value.\n\t\tv.assign(val);\n\n\t\tfor (const c of cs) {\n\t\t\tif (c.isSatisfied() === 0) {\n\t\t\t\tv.assign(origVal);  // Restore the value.\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tv.assign(origVal);  // Restore the value.\n\t\treturn true;\n\t}\n\n\t#lcValue(V1, V2, v) {\n\t\tif (!this.#isConsistent(V1, v, v.value())) {\n\t\t\treturn false;\n\t\t}\n\t\tconst V1_V2 = LocalChangesEx.#setPlusSet(V1, V2);\n\t\tif (this.#isConsistent(V1_V2, v, v.value())) {\n\t\t\treturn true;\n\t\t}\n\t\tconst V3 = this.#createNewV3(V1_V2, v, v.value());\n\n\t\tV2 = LocalChangesEx.#setMinusSet(V2, V3);\n\t\tV1 = LocalChangesEx.#setPlusElement(V1, v);\n\t\treturn this.#lcVariables(V1, V2, V3);\n\t}\n\n\t#lcVariable(V1, V2, v) {\n\t\tfor (const val of v.domain()) {\n\t\t\tconst s = AssignmentList.fromVariables(V2);\n\t\t\tv.assign(val);\n\n\t\t\tconst ret = this.#lcValue(V1, V2, v);\n\t\t\tif (ret || this.#globalReturn) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tv.clear();\n\t\t\ts.apply();\n\t\t}\n\t\treturn false;\n\t}\n\n\t#lcVariables(V1, V2, V3) {\n\t\tV2 = new Set(V2);  // Clone\n\t\tV3 = new Set(V3);  // Clone\n\n\t\twhile (true) {\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`V1 ${V1.size}, V2' ${V2.size}, V3' ${V3.size}`);\n\t\t\t}\n\t\t\tif ((this._targetDeg ?? 1) <= this._pro.satisfiedConstraintRate()) {  // Success if violation rate improves from specified\n\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\tthis.#globalReturn = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\tthis.#globalReturn = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this.#endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\tthis.#globalReturn = true;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (V3.size === 0) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst v   = V3.values().next().value;\n\t\t\tconst ret = this.#lcVariable(V1, V2, v);\n\n\t\t\tif (!ret || this.#globalReturn) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\tV2.add(v);\n\t\t\tV3.delete(v);\n\t\t}\n\t}\n\n\texec() {\n\t\tthis.#endTime      = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount    = 0;\n\t\tthis.#globalReturn = false;\n\n\t\tif (this._pro.emptyVariableSize() === 0) {\n\t\t\tthis._pro.clearAllVariables();\n\t\t}\n\t\tconst notFixed   = new Set();\n\t\tconst unassigned = new Set();\n\t\tfor (const v of this._pro.variables()) {\n\t\t\t(!v.isEmpty() ? notFixed : unassigned).add(v);\n\t\t}\n\t\treturn this.#lcVariables(new Set(), notFixed, unassigned);\n\t}\n\n}\n\n/**\n * This class implements the SRS algorithm for crisp CSP.\n * The given crisp CSP is treated as the maximum CSP.\n * Similar to SRS 3, the repair algorithm searches for an assignment that satisfies itself without reducing the number of satisfactions of its neighbors.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass CrispSRS3 extends Solver {\n\n\t#closedList          = new Set();\n\t#openList            = new Set();  // LinkedHashSet is used in the original implementation.\n\t#nodes               = [];\n\t#neighborConstraints = [];  // Cache\n\n\t#isRandom = true;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tfor (const c of this._pro.constraints()) {\n\t\t\tthis.#nodes.push(new CrispSRS3.TreeNode(c));\n\t\t\tthis.#neighborConstraints.push(null);\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'SRS 3 for Crisp CSPs';\n\t}\n\n\t#getNeighborConstraints(c) {\n\t\tconst index = c.index();\n\n\t\tif (this.#neighborConstraints[index] === null) {\n\t\t\tthis.#neighborConstraints[index] = c.neighbors();\n\t\t}\n\t\treturn this.#neighborConstraints[index];\n\t}\n\n\t#repair(c0) {\n\t\tif (this._debug) console.log('repair');\n\n\t\tconst candidates = new AssignmentList();\n\t\tlet maxDiff = 0;\n\n\t\tfor (const v of c0) {\n\t\t\tconst v_val = v.value();  // Save the value\n\n\t\t\tlet nowVio = 0;\n\t\t\tfor (const c of v) {\n\t\t\t\tnowVio += (1 - c.isSatisfied());\n\t\t\t}\n\t\t\tout: for (const d of v.domain()) {\n\t\t\t\tif (v_val === d) continue;\n\t\t\t\tv.assign(d);\n\t\t\t\tif (c0.isSatisfied() !== 1) continue;  // Assuming c0 improvement\n\n\t\t\t\tlet diff = nowVio;\n\t\t\t\tfor (const n of v) {\n\t\t\t\t\tdiff -= (1 - n.isSatisfied());\n\t\t\t\t\tif (diff < maxDiff) continue out;  // If the improvement is less than the previous improvement, try the next variable.\n\t\t\t\t}\n\t\t\t\tif (diff > maxDiff) {  // An assignment that are better than ever before is found.\n\t\t\t\t\tmaxDiff = diff;\n\t\t\t\t\tcandidates.clear();\n\t\t\t\t\tcandidates.addVariable(v, d);\n\t\t\t\t} else if (maxDiff !== 0) {  // An assignments that can be improved to the same level as before is found.\n\t\t\t\t\tcandidates.addVariable(v, d);\n\t\t\t\t}\n\t\t\t}\n\t\t\tv.assign(v_val);  // Restore the value\n\t\t}\n\t\tif (candidates.size() > 0) {\n\t\t\tconst e = this.#isRandom ? candidates.arbitraryAssignment() : candidates.get(0);\n\t\t\te.apply();\n\t\t\tif (this._debug) console.log('\\t' + e);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t#shrink(node, c_stars) {\n\t\tconst temp = [];\n\t\tlet cur = node;\n\n\t\twhile (true) {  // This procedure is originally a recursive call, but converted to a loop\n\t\t\tcur = cur.parent();\n\t\t\ttemp.length = 0;\n\t\t\tcur.getDescendants(temp);\n\t\t\tcur.clear();\n\n\t\t\tfor (const n of c_stars) {\n\t\t\t\tthis.#openList.delete(n);\n\t\t\t\tthis.#closedList.delete(n);\n\t\t\t}\n\n\t\t\tif (c_stars.delete(cur)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.#openList.add(cur);\n\t\t\tif (cur.parent() !== null && !this.#repair(cur.parent().getObject())) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t#spread(node) {\n\t\tif (this._debug) console.log('spread');\n\t\tthis.#closedList.add(node);\n\n\t\tfor (const c of this.#getNeighborConstraints(node.getObject())) {\n\t\t\tconst tnc = this.#nodes[c.index()];\n\n\t\t\tif (!this.#closedList.has(tnc) && !this.#openList.has(tnc)) {  // For constraints that are not included in Open or Closed\n\t\t\t\ttnc.clear();  // Because of its reuse, it may have had children when it was used before.\n\t\t\t\tnode.add(tnc);\n\t\t\t\tthis.#openList.add(tnc);\n\t\t\t}\n\t\t}\n\t}\n\n\t#srs(c_stars) {\n\t\tif (this._debug) console.log('srs');\n\t\tconst endTime = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tlet iterCount = 0;\n\n\t\tthis.#closedList.clear();\n\t\tthis.#openList.clear();\n\t\tfor (const n of c_stars) {\n\t\t\tthis.#openList.add(n);\n\t\t}\n\n\t\twhile (c_stars.size && this.#openList.size) {\n\t\t\tif ((this._targetDeg ?? 1) <= this._pro.satisfiedConstraintRate()) {  // Success if violation rate improves from specified\n\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this._iterLimit && this._iterLimit < iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst node = this.#openList.values().next().value;\n\t\t\tthis.#openList.delete(node);\n\n\t\t\tif (this.#repair(node.getObject())) {\n\t\t\t\tif (!c_stars.delete(node)) {  // If the repaired node is included in C* (to be deleted)\n\t\t\t\t\tif (node.parent() !== null && this.#repair(node.parent().getObject())) {  // When its improvement leads to the improvement of its parents\n\t\t\t\t\t\tthis.#shrink(node, c_stars);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.#spread(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {  // In case of repair failure\n\t\t\t\tthis.#spread(node);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\texec() {\n\t\tconst vcs     = this._pro.violatingConstraints();\n\t\tconst c_stars = new Set();\n\n\t\tfor (const c of vcs) {\n\t\t\tconst tnc = this.#nodes[c.index()];\n\t\t\tc_stars.add(tnc);\n\t\t}\n\t\tif (this.#srs(c_stars)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn c_stars.length === 0;\n\t}\n\n\t/**\n\t * Sets the randomness of the algorithm.\n\t * Enabling randomness reduces the risk of falling into a local solution, but makes the solution unrepeatable.\n\t * @param flag If true, randomness is enabled.\n\t */\n\tsetRandomness(flag) {\n\t\tthis.#isRandom = flag;\n\t}\n\n}\n\n{\n\n\tclass TreeNode {\n\n\t\t#children = [];\n\t\t#parent;\n\t\t#obj;\n\n\t\tconstructor(obj) {\n\t\t\tthis.#obj = obj;\n\t\t}\n\n\t\tadd(tn) {\n\t\t\ttn.#parent = this;\n\t\t\tthis.#children.push(tn);\n\t\t}\n\n\t\tclear() {\n\t\t\tfor (const tn of this.#children) {\n\t\t\t\ttn.#parent = null;\n\t\t\t}\n\t\t\tthis.#children.length = 0;\n\t\t}\n\n\t\tgetDescendants(tns) {\n\t\t\ttns.push(this);\n\n\t\t\tfor (const tn of this.#children) {\n\t\t\t\ttn.getDescendants(tns);\n\t\t\t}\n\t\t}\n\n\t\tgetObject() {\n\t\t\treturn this.#obj;\n\t\t}\n\n\t\tparent() {\n\t\t\treturn this.#parent;\n\t\t}\n\n\t}\n\tCrispSRS3.TreeNode = TreeNode;\n\n}\n\n\n/**\n * Class implements a solver using the breakout method for fuzzy CSP.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass FuzzyBreakout extends Solver {\n\n\t#weights;\n\t#lastSolDeg;\n\n\t#isRandom = true;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tthis.#weights = new Array(this._pro.constraintSize());\n\t\tthis.#weights.fill(1);\n\t}\n\n\tname() {\n\t\treturn 'Fuzzy Breakout';\n\t}\n\n\tfoundSolution() {\n\t\treturn false;\n\t}\n\n\t#findCandidates(worstVars, canList) {\n\t\tlet maxDiff = 0;\n\n\t\tfor (const v of worstVars) {\n\t\t\tconst v_val = v.value();  // Save the value\n\n\t\t\tlet nowVio = 0;\n\t\t\tfor (const c of v) {\n\t\t\t\tnowVio += (1 - c.satisfactionDegree()) * this.#weights[c.index()];\n\t\t\t}\n\t\t\tout: for (const d of v.domain()) {\n\t\t\t\tif (v_val === d) continue;\n\t\t\t\tv.assign(d);\n\t\t\t\tlet diff = nowVio;\n\t\t\t\tfor (const c of v) {\n\t\t\t\t\tdiff -= (1 - c.satisfactionDegree()) * this.#weights[c.index()];\n\t\t\t\t\t// If the improvement is less than the previous improvement, try the next variable.\n\t\t\t\t\tif (diff < maxDiff) {\n\t\t\t\t\t\tcontinue out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (diff > maxDiff) {  // Found assignments that are better than ever before.\n\t\t\t\t\tmaxDiff = diff;\n\t\t\t\t\tcanList.clear();\n\t\t\t\t\tcanList.addVariable(v, d);\n\t\t\t\t} else if (maxDiff !== 0) {  // Found assignments that can be improved to the same level as before.\n\t\t\t\t\tcanList.addVariable(v, d);\n\t\t\t\t}\n\t\t\t}\n\t\t\tv.assign(v_val);  // Restore the value.\n\t\t}\n\t}\n\n\t#listWorstVariables(worstCons) {\n\t\tconst wvs = new Set();\n\t\tfor (const c of worstCons) {\n\t\t\tfor (const v of c) wvs.add(v);\n\t\t}\n\t\treturn Array.from(wvs);\n\t}\n\n\texec() {\n\t\tconst endTime = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tlet iterCount = 0;\n\n\t\tfor (const v of this._pro.variables()) {\n\t\t\tif (v.isEmpty()) v.assign(v.domain().at(0));\n\t\t}\n\n\t\tconst deg     = this._pro.worstSatisfactionDegree();\n\t\tconst canList = new AssignmentList();\n\n\t\tconst sol = new AssignmentList();\n\n\t\twhile (true) {\n\t\t\tconst [vc, wsd] = this._pro.constraintsWithWorstSatisfactionDegree();\n\t\t\tif (this._targetDeg !== null && this._targetDeg <= wsd) {  // Success if the degree improves from specified\n\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this._iterLimit && this._iterLimit < iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (this._debug) console.log('worst satisfaction degree: ' + wsd);\n\n\t\t\tif (this.#lastSolDeg < wsd) {\n\t\t\t\tsol.setProblem(this._pro);\n\t\t\t\tthis.#lastSolDeg = wsd;\n\t\t\t\tif (foundSolution(sol, this.#lastSolDeg)) {  // Call hook\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.#findCandidates(this.#listWorstVariables(vc), canList);\n\n\t\t\tif (0 < canList.size()) {\n\t\t\t\tconst e = this.#isRandom ? canList.arbitraryAssignment() : canList.get(0);\n\t\t\t\te.apply();\n\t\t\t\tcanList.clear();\n\t\t\t\tif (this._debug) console.log('\\t' + e);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < vc.length; ++i) this.#weights[vc[i].index()]++;\n\t\t\t\tif (this._debug) console.log('breakout');\n\t\t\t}\n\t\t}\n\t\tif (this._targetDeg === null && deg < this._pro.worstSatisfactionDegree()) return true;\n\t\treturn false;\n\t}\n\n\t/**\n\t * Sets the randomness of the algorithm.\n\t * Enabling randomness reduces the risk of local solutions, but makes the solution unrepeatable.\n\t * @param flag Whether the randomness is enabled.\n\t */\n\tsetRandomness(flag) {\n\t\tthis.#isRandom = flag;\n\t}\n\n}\n\n/**\n * This class implements the forward checking method for fuzzy CSP.\n * The minimum-remaining-values (MRV) heuristic can also be used by specifying the option.\n * Each variable must have its own domain because it hides domain elements as branch pruning.\n * Forward checking is also performed for problems with polynomial constraints.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass FuzzyForwardChecking extends Solver {\n\n\tstatic CONTINUE  = 0;\n\tstatic TERMINATE = 1;\n\n\t#vars;\n\t#sol = new AssignmentList();\n\t#relCons;  // Table to cache constraints between two variables.\n\n\t#solWorstDeg = 0;  // Degree of existing solutions (no need to find a solution less than this).\n\n\t#iterCount;\n\t#endTime;\n\t#useMRV = false;\n\t#degInc = 0;\n\n\t#sequence;\n\t#unaryCons;\n\t#checkedCons;\n\t#pruneIntensively = false;\n\n\t/**\n\t * Generates the solver given a fuzzy constraint satisfaction problem.\n\t * @param p A fuzzy problem.\n\t * @param worstSatisfactionDegree Worst satisfaction degree.\n\t */\n\tconstructor(p, worstSatisfactionDegree = null) {\n\t\tsuper(p);\n\t\tthis.#vars = [...this._pro.variables()];\n\t\tthis.#sequence = new Array(this._pro.variableSize());\n\t\tthis.#initializeRelatedConstraintTable();\n\t\tthis.#checkedCons = new Array(this._pro.constraintSize());\n\n\t\tconst temp = [];\n\t\tfor (const c of this._pro.constraints()) {\n\t\t\tif (c.size() === 1) temp.push(c);\n\t\t}\n\t\tthis.#unaryCons = [...temp];  // To make it even if it is empty.\n\t\tif (worstSatisfactionDegree) {\n\t\t\tthis.#solWorstDeg = worstSatisfactionDegree;\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'Forward Checking for Fuzzy CSPs';\n\t}\n\n\t// Initializes a table that caches constraints between two variables.\n\t#initializeRelatedConstraintTable() {\n\t\tthis.#relCons = [];\n\n\t\tfor (let j = 0; j < this.#vars.length; ++j) {\n\t\t\tthis.#relCons.push(new Array(this.#vars.length));\n\n\t\t\tfor (let i = 0; i < this.#vars.length; i++) {\n\t\t\t\tif (i < j) {\n\t\t\t\t\tthis.#relCons[j][i] = this._pro.constraintsBetween(this.#vars[i], this.#vars[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Retrieves an array of constraints from a table that caches constraints between two variables.\n\t#getConstraintsBetween(vi_index, vj_index) {\n\t\tif (vi_index < vj_index) {\n\t\t\treturn this.#relCons[vj_index][vi_index];\n\t\t}\n\t\treturn this.#relCons[vi_index][vj_index];\n\t}\n\n\t// Prune elements of the domain that make the unary constraint worse than the current worst degree.\n\t#pruneUnaryConstraints() {\n\t\tfor (const c of this.#unaryCons) {\n\t\t\tconst v      = c.at(0);\n\t\t\tconst orgVal = v.value();  // Save the value.\n\t\t\tconst d      = v.domain();\n\t\t\tconst dc     = v.solverObject;\n\n\t\t\tfor (let i = 0, n = d.size(); i < n; ++i) {\n\t\t\t\tv.assign(d.at(i));\n\t\t\t\tif (c.satisfactionDegree() <= this.#solWorstDeg) {\n\t\t\t\t\tdc.hide(i, -1);  // Here's a branch pruning!\n\t\t\t\t}\n\t\t\t}\n\t\t\tv.assign(orgVal);  // Restore the value.\n\t\t\tif (dc.isEmpty()) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Check for consistency between the current variable and one future variable, and prune elements of the domain that are inconsistent (when there is one unassigned variable in the scope of the constraint).\n\t#checkForwardConsistency(level, vi, c) {\n\t\tconst di  = vi.domain();\n\t\tconst dci = vi.solverObject;\n\n\t\tfor (let i = 0, n = di.size(); i < n; ++i) {\n\t\t\tif (dci.isValueHidden(i)) continue;\n\t\t\tvi.assign(di.at(i));\n\t\t\tif (c.satisfactionDegree() <= this.#solWorstDeg) {  // It is not a solution when it is 'smaller than or equals'.\n\t\t\t\tdci.hide(i, level);  // Here's a branch pruning!\n\t\t\t}\n\t\t}\n\t\tvi.clear();\n\t\treturn !dci.isEmpty();  // Succeeds if the domain di of the future variable vi is not empty.\n\t}\n\n\t// Check for consistency between the current variable and one future variable, and prune elements of the domain that are inconsistent (when there are two unassigned variables in the scope of the constraint).\n\t#checkForwardConsistency2(level, vi, c) {\n\t\tconst di  = vi.domain();\n\t\tconst dci = vi.solverObject;\n\t\tconst vj  = null;\n\n\t\tfor (const v of c) {\n\t\t\tif (v.isEmpty() && v !== vi) {\n\t\t\t\tvj = v;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tconst dj  = vj.domain();\n\t\tconst dcj = vj.solverObject;\n\t\tloop_i: for (let i = 0, ni = di.size(); i < ni; ++i) {\n\t\t\tif (dci.isValueHidden(i)) continue;\n\t\t\tvi.assign(di.at(i));  // Tentative assignment to vi\n\t\t\tfor (let j = 0, nj = dj.size(); j < nj; ++j) {\n\t\t\t\tif (dcj.isValueHidden(j)) continue;\n\t\t\t\tvj.assign(dj.at(j));  // Tentative assignment to vj\n\t\t\t\tconst s = c.satisfactionDegree();\n\t\t\t\tif (s > this.#solWorstDeg) continue loop_i;  // Tentative assignment to vi was OK -> next tentative assignment.\n\t\t\t}\n\t\t\tdci.hide(i, level);  // It is not a solution when it is 'smaller than or equals'.\n\t\t}\n\t\tvj.clear();\n\t\tvi.clear();\n\t\treturn !dci.isEmpty();  // Succeeds if the domain di of the future variable vi is not empty.\n\t}\n\n\t// Check for consistency between the current variable and one future variable, and prune elements of the domain that are inconsistent (when there are three unassigned variables in the scope of the constraint).\n\t#checkForwardConsistency3(level, vi, c) {\n\t\tconst di  = vi.domain();\n\t\tconst dci = vi.solverObject;\n\n\t\tlet vj = null;\n\t\tlet vk = null;\n\n\t\tfor(let i = 0, n = c.size(); i < n; ++i) {\n\t\t\tlet v = c.at(i);\n\t\t\tif (v.isEmpty() && v !== vi) {\n\t\t\t\tif (vj === null) {\n\t\t\t\t\tvj = v;\n\t\t\t\t} else {\n\t\t\t\t\tvk = v;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst dj  = vj.domain();\n\t\tconst dk  = vk.domain();\n\t\tconst dcj = vj.solverObject;\n\t\tconst dck = vk.solverObject;\n\n\t\tloop_i: for(let i = 0, ni = di.size(); i < ni; ++i) {\n\t\t\tif (dci.isValueHidden(i)) continue;\n\t\t\tvi.assign(di.at(i));  // Tentative assignment to vi\n\t\t\tfor (let j = 0, nj = dj.size(); j < nj; ++j) {\n\t\t\t\tif (dcj.isValueHidden(j)) continue;\n\t\t\t\tvj.assign(dj.at(j));  // Tentative assignment to vj\n\t\t\t\tfor (let k = 0, nk = dk.size(); k < nk; ++k) {\n\t\t\t\t\tif (dck.isValueHidden(k)) continue;\n\t\t\t\t\tvk.assign(dk.at(k));  // Tentative assignment to vk\n\t\t\t\t\tconst s = c.satisfactionDegree();\n\t\t\t\t\tif (s > this.#solWorstDeg) continue loop_i;  // Tentative assignment to vi was OK -> next tentative assignment.\n\t\t\t\t}\n\t\t\t}\n\t\t\tdci.hide(i, level);  // It is not a solution when it is 'smaller than or equals'.\n\t\t}\n\t\tvk.clear();\n\t\tvj.clear();\n\t\tvi.clear();\n\t\treturn !dci.isEmpty();  // Succeeds if the domain di of the future variable vi is not empty.\n\t}\n\n\t// In the case of polynomial constraints and when there are four or more unassigned variables, all combinations of assignments of unassigned variables are examined and pruned.\n\t#checkForwardConsistencyN(level, vi, c, emptySize) {\n\t\tconst di  = vi.domain();\n\t\tconst dci = vi.solverObject;\n\t\tconst emp = new Array(emptySize - 1);\n\t\tlet j = 0;\n\n\t\tfor (let i = 0, n = c.size(); i < n; ++i) {\n\t\t\tconst v = c.at(i);\n\t\t\tif(v.isEmpty() && v !== vi) emp[j++] = v;\n\t\t}\n\t\tconst indexes = new Array(emp.length);\n\n\t\tloop_i: for (let i = 0, n = di.size(); i < n; ++i) {\n\t\t\tif (dci.isValueHidden(i)) continue;\n\t\t\tvi.assign(di.at(i));  // Tentative assignment to vi\n\t\t\tindexes.fill(0);\n\n\t\t\tcomLoop: while (true) {\n\t\t\t\tlet hidden = false;\n\t\t\t\tfor (let k = 0; k < emp.length; ++k) {\n\t\t\t\t\tconst dk  = emp[k].domain();\n\t\t\t\t\tconst dck = emp[k].solverObject;\n\t\t\t\t\tif (dck.isValueHidden(indexes[k])) {\n\t\t\t\t\t\thidden = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\temp[k].assign(dk.at(indexes[k]));\n\t\t\t\t}\n\t\t\t\tif (!hidden) {\n\t\t\t\t\tconst s = c.satisfactionDegree();\n\t\t\t\t\tif (s > this.#solWorstDeg) continue loop_i;  // Tentative assignment to vi was OK -> next tentative assignment.\n\t\t\t\t}\n\t\t\t\tfor (let k = 0; k < emp.length; ++k) {\n\t\t\t\t\tindexes[k]++;\n\t\t\t\t\tif (indexes[k] < emp[k].domain().size()) break;\n\t\t\t\t\tindexes[k] = 0;\n\t\t\t\t\tif (k === emp.length - 1) break comLoop;\n\t\t\t\t}\n\t\t\t}\n\t\t\tdci.hide(i, level);\n\t\t}\n\t\tfor (const v of emp) v.clear();\n\t\tvi.clear();\n\t\treturn !dci.isEmpty();  // Succeeds if the domain di of the future variable vi is not empty.\n\t}\n\n\t// Checks for possible assignment to a future variable from the current variable assignment.\n\t#checkForward(level, index) {\n\t\tfor (const v_i of  this.#vars) {\n\t\t\tif (!v_i.isEmpty()) continue;  // If it is a past or present variable.\n\n\t\t\tconst cs = this.#getConstraintsBetween(index, v_i.index());\n\n\t\t\tfor (const c of cs) {\n\t\t\t\tconst emptySize = c.emptyVariableSize();\n\t\t\t\tif (emptySize === 1) {\n\t\t\t\t\tif (!this.#checkForwardConsistency(level, v_i, c)) return false;\n\t\t\t\t} else if (this.#pruneIntensively) {  // Depends on options\n\t\t\t\t\tif (emptySize === 2) {\n\t\t\t\t\t\tif(!this.#checkForwardConsistency2(level, v_i, c)) return false;\n\t\t\t\t\t} else if(emptySize === 3) {\n\t\t\t\t\t\tif(!this.#checkForwardConsistency3(level, v_i, c)) return false;\n\t\t\t\t\t} else if(emptySize > 3) {\n\t\t\t\t\t\tif(!this.#checkForwardConsistencyN(level, v_i, c, emptySize)) return false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Checks to see if the current variable assignment makes the degree of the past variable worse than the current worst degree.\n\t#checkBackwardConsistency(vc) {\n\t\tthis.#checkedCons.fill(false);  // Reuse.\n\n\t\tfor (let i = 0; i < this.#vars.length; ++i) {  // Find past variables.\n\t\t\tconst vi = this.#vars[i];\n\t\t\tif (vi === vc || vi.isEmpty()) continue;  // If it is a future variable or a present variable.\n\t\t\tconst cs = this.#getConstraintsBetween(vc.index(), i);\n\n\t\t\tfor (const c of cs) {\n\t\t\t\tif (this.#checkedCons[c.index()]) continue;  // Because of the possibility of duplication in polynomial constraints\n\t\t\t\tconst s = c.satisfactionDegree();\n\t\t\t\tif (s !== Constraint.UNDEFINED && s <= this.#solWorstDeg) {  // It is not a solution when it is 'smaller than or equals'.\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis.#checkedCons[c.index()] = true;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t#refresh() {\n\t\tfor(let i = 0; i < this.#sequence.length; ++i) {\n\t\t\tconst index_vi = this.#sequence[i].index();\n\n\t\t\tfor (let j = i + 1; j < this.#sequence.length; ++j) {\n\t\t\t\tconst vj = this.#sequence[j];\n\t\t\t\tconst cs = this.#getConstraintsBetween(index_vi, vj.index());\n\n\t\t\t\tfor (const c of cs) {\n\t\t\t\t\tconst orgVal = vj.value();\n\t\t\t\t\tconst dj     = vj.domain();\n\t\t\t\t\tconst dcj    = vj.solverObject;\n\n\t\t\t\t\tfor (let k = 0, n = dj.size(); k < n; ++k) {\n\t\t\t\t\t\tif (dcj.isValueHidden(k)) continue;\n\t\t\t\t\t\tvj.assign(dj.at(k));\n\t\t\t\t\t\tif (c.satisfactionDegree() <= this.#solWorstDeg) {\n\t\t\t\t\t\t\tdcj.hide(k, i);  // Here's a branch pruning!\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvj.assign(orgVal);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Returns the index of the smallest domain variable.\n\t#indexOfVariableWithMRV() {\n\t\tlet index = 0;\n\t\tlet size  = Number.MAX_VALUE;\n\n\t\tfor (let i = 0; i < this.#vars.length; ++i) {\n\t\t\tconst v = this.#vars[i];\n\t\t\tif (!v.isEmpty()) continue;\n\t\t\tconst d = v.domain();\n\t\t\tconst s = d.size() - v.solverObject.hiddenSize();\n\t\t\tif (s < size) {\n\t\t\t\tsize  = s;\n\t\t\t\tindex = i;\n\t\t\t}\n\t\t}\n\t\treturn index;\n\t}\n\n\t// Performs search one variable at a time.\n\t#branch(level) {\n\t\tlet bc = FuzzyForwardChecking.CONTINUE;\n\t\tconst vc_index = this.#useMRV ? this.#indexOfVariableWithMRV() : level;\n\t\tconst vc       = this.#vars[vc_index];\n\t\tconst d        = vc.domain();\n\t\tconst dc       = vc.solverObject;\n\t\tthis.#sequence[level] = vc;\n\n\t\tfor (let i = 0, n = d.size(); i < n; ++i) {\n\t\t\tif (dc.isValueHidden(i)) continue;\n\t\t\tif ((this._iterLimit && this._iterLimit < this.#iterCount++) || this.#endTime < Date.now()) {\n\t\t\t\tbc = FuzzyForwardChecking.TERMINATE;  // Search terminated due to restrictions.\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvc.assign(d.at(i));\n\n\t\t\tfor (const v of this.#vars) v.solverObject.reveal(level);\n\t\t\tif (!this.#checkBackwardConsistency(vc)) continue;\n\t\t\tif (!this.#checkForward(level, vc_index)) continue;\n\n\t\t\tconst nextLevel = level + 1;\n\t\t\tbc = (nextLevel === this.#vars.length - 1) ? this.#branchLast(nextLevel) : this.#branch(nextLevel);\n\t\t\tif (bc === FuzzyForwardChecking.TERMINATE) break;\n\t\t}\n\t\tif (bc === FuzzyForwardChecking.CONTINUE) {  // When searching back to the parent, undo the branch pruning here.\n\t\t\tfor (const v of this.#vars) v.solverObject.reveal(level);\n\t\t}\n\t\tvc.clear();\n\t\treturn bc;\n\t}\n\n\t// Performs search on the last variable.\n\t#branchLast(level) {\n\t\tlet bc = FuzzyForwardChecking.CONTINUE;\n\t\tconst vc = this.#vars[this.#useMRV ? this.#indexOfVariableWithMRV() : level];\n\t\tconst d  = vc.domain();\n\t\tconst dc = vc.solverObject;\n\t\tthis.#sequence[level] = vc;\n\n\t\tfor (let i = 0, n = d.size(); i < n; ++i) {\n\t\t\tif (dc.isValueHidden(i)) continue;\n\t\t\tif ((this._iterLimit && this._iterLimit < this.#iterCount++) || this.#endTime < Date.now()) {\n\t\t\t\tbc = FuzzyForwardChecking.TERMINATE;  // Search terminated due to restrictions.\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvc.assign(d.at(i));\n\n\t\t\tconst deg = this._pro.worstSatisfactionDegree();\n\t\t\tif (deg > this.#solWorstDeg) {  // A new solution is assumed when 'greater than'.\n\t\t\t\tthis.#solWorstDeg = deg;\n\t\t\t\tthis.#sol.setProblem(this._pro);\n\t\t\t\tbc = FuzzyForwardChecking.TERMINATE;\n\t\t\t\tif (this._targetDeg !==  null && this._targetDeg <= this.#solWorstDeg) {  // Search ends when target is reached\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.#pruneUnaryConstraints();\n\t\t\t\tthis.#refresh();\n\t\t\t}\n\t\t}\n\t\tvc.clear();\n\t\treturn bc;\n\t}\n\n\t// Do search.\n\texec() {\n\t\tthis.#endTime   = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount = 0;\n\n\t\tfor (const v of this.#vars) {\n\t\t\tv.solverObject = new DomainPruner(v.domain().size());  // Generation of domain pruners.\n\t\t}\n\t\tthis._pro.clearAllVariables();\n\t\tif (!this.#pruneUnaryConstraints()) return false;  // Since _worstSatisfactionDegree_ has been updated, call this function.\n\n\t\tlet success = false;\n\t\twhile (true) {\n\t\t\tconst bc = this.#branch(0);\n\t\t\tif (bc === FuzzyForwardChecking.TERMINATE) {\n\t\t\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {\n\t\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (this.#endTime < Date.now()) {\n\t\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.#sol.isEmpty()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`\\tfound a solution: ${this.#solWorstDeg}`);\n\t\t\t}\n\t\t\tif (this.foundSolution(this.#sol, this.#solWorstDeg)) {  // Call hook\n\t\t\t\tsuccess = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (this._targetDeg === null) {  // Degree not specified\n\t\t\t\tsuccess = true;\n\t\t\t\tthis.#solWorstDeg += this.#degInc;  // Find the next solution within the limit.\n\t\t\t} else if (this._targetDeg <= this.#solWorstDeg) {  // The current degree exceeded the specified degree.\n\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\tsuccess = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (const v of this.#vars) v.solverObject.revealAll();\n\t\t}\n\t\tthis.#sol.apply();\n\t\tfor (const v of this.#vars) v.solverObject = null;  // Delete branch pruner\n\t\treturn success;\n\t}\n\n\t/**\n\t * Constraint satisfaction degree is set as an achievement goal that serves as a condition for stopping the solver.\n\t * The solver stops as successful when the specified degree is reached or exceeded.\n\t * The default (unset) is 0.8.\n\t * @param rate Degree. null indicates not set.\n\t */\n\tsetTargetRate(rate = null) {\n\t\tthis._targetDeg = rate;\n\t\tif (this._targetDeg === null) {\n\t\t\tthis.#solWorstDeg = 0;\n\t\t} else {\n\t\t\t// Find the worstSatisfactionDegree_ that is slightly smaller than the targetDegree_.\n\t\t\tlet e = Number.MIN_VALUE\n\t\t\tthis.#solWorstDeg = this._targetDeg - e;\n\t\t\twhile (this.#solWorstDeg >= this._targetDeg) {\n\t\t\t\te *= 10;\n\t\t\t\tthis.#solWorstDeg = this._targetDeg - e;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Specify whether to use the minimum-remaining-values (MRV) heuristic.\n\t * Use of MRV may increase processing time for some problems.\n\t * Default is false.\n\t * @param flag Use MRV if true.\n\t */\n\tsetUsingMinimumRemainingValuesHeuristics(flag) {\n\t\tthis.#useMRV = flag;\n\t}\n\n\t/**\n\t * If a solution is found and the search continues, it specifies how much the worst constraint satisfaction degree should be increased.\n\t * @param degree Increasing constraint satisfaction degree.\n\t */\n\tsetIncrementStepOfWorstSatisfactionDegree(degree) {\n\t\tthis.#degInc = degree;\n\t}\n\n\t/**\n\t * Specifies whether or not to intensively prune branches when the problem contains 3- or n-ary constraints.\n\t * Depending on the problem, intensive pruning may increase processing time.\n\t * Default is false.\n\t * @param flag Whether or not to intensively prune branches.\n\t */\n\tsetIntensivePruning(flag) {\n\t\tthis.#pruneIntensively = flag;\n\t}\n\n}\n\n/**\n * This class implements the forward checking method for fuzzy CSPs that contain only binary constraints.\n * The minimum-remaining-values (MRV) heuristic can also be used by specifying the option.\n *\n * @author Takuto Yanagida\n * @version 2023-04-10\n */\n\nclass FuzzyForwardCheckingBc extends Solver {\n\n\tstatic CONTINUE  = 0;\n\tstatic TERMINATE = 1;\n\n\t#vars;\n\t#sol = new AssignmentList();\n\t#relCons;  // Table to cache constraints between two variables.\n\n\t#solWorstDeg = 0;  // Degree of existing solutions (no need to find a solution less than this).\n\n\t#iterCount;\n\t#endTime;\n\t#useMRV = false;\n\t#degInc = 0;\n\n\t/**\n\t * Generates the solver given a fuzzy constraint satisfaction problem.\n\t * @param p A fuzzy problem.\n\t * @param worstSatisfactionDegree Worst satisfaction degree.\n\t */\n\tconstructor(p, worstSatisfactionDegree = null) {\n\t\tsuper(p);\n\t\tthis.#vars = [...this._pro.variables()];\n\t\tthis.#initializeRelatedConstraintTable();\n\n\t\tthis.#solWorstDeg = Math.max(0, p.worstSatisfactionDegree());\n\t\tif (worstSatisfactionDegree) {\n\t\t\tthis.#solWorstDeg = worstSatisfactionDegree;\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'Forward Checking for Fuzzy CSPs of Binary Constraints';\n\t}\n\n\tfoundSolution() {\n\t\treturn false;\n\t}\n\n\t// Initializes a table that caches constraints between two variables.\n\t#initializeRelatedConstraintTable() {\n\t\tthis.#relCons = [];\n\n\t\tfor (let j = 0; j < this.#vars.length; ++j) {\n\t\t\tthis.#relCons.push(new Array(this.#vars.length));\n\n\t\t\tfor (let i = 0; i < this.#vars.length; i++) {\n\t\t\t\tif (i < j) {\n\t\t\t\t\tthis.#relCons[j][i] = this._pro.constraintsBetween(this.#vars[i], this.#vars[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Retrieves an array of constraints from a table that caches constraints between two variables.\n\t#getConstraintsBetween(vi_index, vj_index) {\n\t\tif (vi_index < vj_index) {\n\t\t\treturn this.#relCons[vj_index][vi_index];\n\t\t}\n\t\treturn this.#relCons[vi_index][vj_index];\n\t}\n\n\t// Check for consistency between the current variable and one future variable, and prune elements of the domain that are inconsistent (when there is one unassigned variable in the scope of the constraint).\n\t#checkForwardConsistency(level, vi, c) {\n\t\tconst di  = vi.domain();\n\t\tconst dci = vi.solverObject;\n\n\t\tfor (let i = 0, n = di.size(); i < n; ++i) {\n\t\t\tif (dci.isValueHidden(i)) continue;\n\t\t\tvi.assign(di.at(i));\n\t\t\tif (c.satisfactionDegree() <= this.#solWorstDeg) {  // It is not a solution when it is 'smaller than or equals'.\n\t\t\t\tdci.hide(i, level);  // Here's a branch pruning!\n\t\t\t}\n\t\t}\n\t\tvi.clear();\n\t\treturn !dci.isEmpty();  // Succeeds if the domain di of the future variable vi is not empty.\n\t}\n\n\t// Checks for possible assignment to a future variable from the current variable assignment.\n\t#checkForward(level, index) {\n\t\tfor (const v_i of  this.#vars) {\n\t\t\tif (!v_i.isEmpty()) continue;  // If it is a past or present variable.\n\n\t\t\tconst cs = this.#getConstraintsBetween(index, v_i.index());\n\t\t\tfor (const c of cs) {\n\t\t\t\tif (c.size() === 2) {  // If it is a binary constraint.\n\t\t\t\t\tif (!this.#checkForwardConsistency(level, v_i, c)) return false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t// Returns the index of the smallest domain variable.\n\t#indexOfVariableWithMRV() {\n\t\tlet index = 0;\n\t\tlet size  = Number.MAX_VALUE;\n\n\t\tfor (let i = 0; i < this.#vars.length; ++i) {\n\t\t\tconst v = this.#vars[i];\n\t\t\tif (!v.isEmpty()) continue;\n\t\t\tconst d = v.domain();\n\t\t\tconst s = d.size() - v.solverObject.hiddenSize();\n\t\t\tif (s < size) {\n\t\t\t\tsize  = s;\n\t\t\t\tindex = i;\n\t\t\t}\n\t\t}\n\t\treturn index;\n\t}\n\n\t// Performs search one variable at a time.\n\t#branch(level) {\n\t\tlet bc = FuzzyForwardCheckingBc.CONTINUE;\n\t\tconst vc_index = this.#useMRV ? this.#indexOfVariableWithMRV() : level;\n\t\tconst vc       = this.#vars[vc_index];\n\t\tconst d        = vc.domain();\n\t\tconst dc       = vc.solverObject;\n\n\t\tfor (let i = 0, n = d.size(); i < n; ++i) {\n\t\t\tif (dc.isValueHidden(i)) continue;\n\t\t\tif ((this._iterLimit && this._iterLimit < this.#iterCount++) || this.#endTime < Date.now()) {\n\t\t\t\tbc = FuzzyForwardCheckingBc.TERMINATE;  // Search terminated due to restrictions.\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvc.assign(d.at(i));\n\n\t\t\tfor (const v of this.#vars) v.solverObject.reveal(level);\n\t\t\tif (!this.#checkForward(level, vc_index)) continue;\n\n\t\t\tconst nextLevel = level + 1;\n\t\t\tbc = (nextLevel === this.#vars.length - 1) ? this.#branchLast(nextLevel) : this.#branch(nextLevel);\n\t\t\tif (bc === FuzzyForwardCheckingBc.TERMINATE) break;\n\t\t}\n\t\tif (bc === FuzzyForwardCheckingBc.CONTINUE) {  // When searching back to the parent, undo the branch pruning here.\n\t\t\tfor (const v of this.#vars) v.solverObject.reveal(level);\n\t\t}\n\t\tvc.clear();\n\t\treturn bc;\n\t}\n\n\t// Performs search on the last variable.\n\t#branchLast(level) {\n\t\tlet bc = FuzzyForwardCheckingBc.CONTINUE;\n\t\tconst vc = this.#vars[this.#useMRV ? this.#indexOfVariableWithMRV() : level];\n\t\tconst d  = vc.domain();\n\t\tconst dc = vc.solverObject;\n\n\t\tfor (let i = 0, n = d.size(); i < n; ++i) {\n\t\t\tif (dc.isValueHidden(i)) continue;\n\t\t\tif ((this._iterLimit && this._iterLimit < this.#iterCount++) || this.#endTime < Date.now()) {\n\t\t\t\tbc = FuzzyForwardCheckingBc.TERMINATE;  // Search terminated due to restrictions.\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvc.assign(d.at(i));\n\n\t\t\tconst deg = this._pro.worstSatisfactionDegree();\n\t\t\tif (deg > this.#solWorstDeg) {  // A new solution is assumed when 'greater than'.\n\t\t\t\tthis.#solWorstDeg = deg;\n\t\t\t\tthis.#sol.setProblem(this._pro);\n\t\t\t\tbc = FuzzyForwardCheckingBc.TERMINATE;  // Search terminated due to restrictions.\n\t\t\t\tif (this._targetDeg !== null && this._targetDeg <= this.#solWorstDeg) {  // Search ends when target is reached\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvc.clear();\n\t\treturn bc;\n\t}\n\n\t// Do search.\n\texec() {\n\t\tthis.#endTime   = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount = 0;\n\n\t\tfor (const v of this.#vars) {\n\t\t\tv.solverObject = new DomainPruner(v.domain().size());  // Generation of domain pruners.\n\t\t}\n\t\tthis._pro.clearAllVariables();\n\n\t\tconst sol = new AssignmentList();\n\n\t\tlet success = false;\n\t\twhile (true) {\n\t\t\tconst bc = this.#branch(0);\n\t\t\tif (bc === FuzzyForwardCheckingBc.TERMINATE) {\n\t\t\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {\n\t\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (this.#endTime < Date.now()) {\n\t\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.#sol.isEmpty()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tsol.setAssignmentList(this.#sol);\n\t\t\tthis.#sol.clear();  // Clear it so that if the solution is not found in the next search, it will be known.\n\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`\\tfound a solution: ${this.#solWorstDeg}`);\n\t\t\t}\n\t\t\tif (this.foundSolution(sol, this.#solWorstDeg)) {  // Call hook\n\t\t\t\tsuccess = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (this._targetDeg === null) {  // Degree not specified\n\t\t\t\tsuccess = true;\n\t\t\t\tif (this.#solWorstDeg + this.#degInc > 1) break;\n\t\t\t\tthis.#solWorstDeg += ((this.#solWorstDeg + this.#degInc > 1) ? 0 : this.#degInc);  // Find the next solution within the limit.\n\t\t\t} else if (this._targetDeg <= this.#solWorstDeg) {  // The current degree exceeded the specified degree.\n\t\t\t\tif (this._debug) console.log(`stop: current degree is above the target`);\n\t\t\t\tsuccess = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (const v of this.#vars) v.solverObject.revealAll();\n\t\t}\n\t\tsol.apply();\n\t\tfor (const v of this.#vars) v.solverObject = null;  // Delete branch pruner\n\t\treturn success;\n\t}\n\n\t/**\n\t * Constraint satisfaction degree is set as an achievement goal that serves as a condition for stopping the solver.\n\t * The solver stops as successful when the specified degree is reached or exceeded.\n\t * The default (unset) is 0.8.\n\t * @param rate Degree. null indicates not set.\n\t */\n\tsetTargetRate(rate = null) {\n\t\tthis._targetDeg = rate;\n\t\tif (this._targetDeg === null) {\n\t\t\tthis.#solWorstDeg = 0;\n\t\t} else {\n\t\t\t// Find the worstSatisfactionDegree_ that is slightly smaller than the targetDegree_.\n\t\t\tlet e = Number.MIN_VALUE\n\t\t\tthis.#solWorstDeg = this._targetDeg - e;\n\t\t\twhile (this.#solWorstDeg >= this._targetDeg) {\n\t\t\t\te *= 10;\n\t\t\t\tthis.#solWorstDeg = this._targetDeg - e;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Specify whether to use the minimum-remaining-values (MRV) heuristic.\n\t * Use of MRV may increase processing time for some problems.\n\t * Default is false.\n\t * @param flag Use MRV if true.\n\t */\n\tsetUsingMinimumRemainingValuesHeuristics(flag) {\n\t\tthis.#useMRV = flag;\n\t}\n\n\t/**\n\t * If a solution is found and the search continues, it specifies how much the worst constraint satisfaction degree should be increased.\n\t * @param degree Increasing constraint satisfaction degree.\n\t */\n\tsetIncrementStepOfWorstSatisfactionDegree(degree) {\n\t\tthis.#degInc = degree;\n\t}\n\n}\n\n/**\n * This class implements fuzzy GENET.\n * CSPs and FCSPs (but only Binary (F)CSPs) is supported.\n *\n * @author Takuto Yanagida\n * @version 2023-04-10\n */\n\nclass FuzzyGENET extends Solver {\n\n\tstatic nextInt(max) {\n\t\treturn Math.floor(Math.random() * Math.floor(max));\n\t}\n\n\t#clusters = [];\n\t#connections;\n\n\tconstructor(p, worstSatisfactionDegree = 1) {\n\t\tsuper(p);\n\t\tif (!this.#createNetwork(worstSatisfactionDegree)) {\n\t\t\tthrow new Exception();\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'Fuzzy GENET';\n\t}\n\n\t#createNetwork(worstDeg) {\n\t\tif (this._debug) console.log('network creation start');\n\t\tconst cons = [];\n\n\t\tfor (const v of this._pro.variables()) {\n\t\t\tif (v.domain().size() === 0) return false;\n\t\t\tthis.#clusters.push(new FuzzyGENET.Cluster(v));\n\t\t}\n\t\tfor (const c of this._pro.constraints()) {\n\t\t\tif (c.size() === 1) {  // In the case of unary constraints.\n\t\t\t\tconst v  = c.at(0);\n\t\t\t\tconst cl = this.#clusters[c.at(0).index()];\n\n\t\t\t\tfor (let i = 0; i < cl.size(); ++i) {\n\t\t\t\t\tconst origVal = v.value();  // Save the value.\n\t\t\t\t\tv.assign(cl.get(i)._value);\n\n\t\t\t\t\tif (c.satisfactionDegree() <= worstDeg) {\n\t\t\t\t\t\tcons.push(new FuzzyGENET.Connection(c, cl.get(i)));\n\t\t\t\t\t}\n\t\t\t\t\tv.assign(origVal);  // Restore the value.\n\t\t\t\t}\n\t\t\t} else {  // In the case of binary constraints.\n\t\t\t\tconst v1   = c.at(0);\n\t\t\t\tconst v2   = c.at(1);\n\t\t\t\tconst cl_f = this.#clusters[c.at(0).index()];\n\t\t\t\tconst cl_s = this.#clusters[c.at(1).index()];\n\n\t\t\t\tfor (let i = 0; i < cl_f.size(); ++i) {\n\t\t\t\t\tconst origVal1 = v1.value();  // Save the value.\n\t\t\t\t\tv1.assign(cl_f.get(i)._value);\n\n\t\t\t\t\tfor (let j = 0; j < cl_s.size(); ++j) {\n\t\t\t\t\t\tconst origVal2 = v2.value();  // Save the value.\n\t\t\t\t\t\tv2.assign(cl_s.get(j)._value);\n\n\t\t\t\t\t\tif (c.satisfactionDegree() <= worstDeg) {\n\t\t\t\t\t\t\tcons.push(new FuzzyGENET.Connection(c, cl_f.get(i), cl_s.get(j)));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tv2.assign(origVal2);  // Restore the value.\n\t\t\t\t\t}\n\t\t\t\t\tv1.assign(origVal1);  // Restore the value.\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const cl of this.#clusters) {\n\t\t\tfor (const n of cl._neurons) n.lockConnections();\n\t\t}\n\t\tthis.#connections = cons;\n\t\tif (this._debug) console.log('network creation complete');\n\t\treturn true;\n\t}\n\n\t#shuffle(is) {\n\t\tfor (let i = is.length; i > 1; --i) {\n\t\t\tconst j    = GENET.nextInt(i);\n\t\t\tconst temp = is[i - 1];\n\t\t\tis[i - 1] = is[j];\n\t\t\tis[j]     = temp;\n\t\t}\n\t\treturn is;\n\t}\n\n\texec() {\n\t\tconst endTime = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tlet iterCount = 0;\n\n\t\tconst sol   = new AssignmentList();\n\t\tconst order = [];\n\t\tfor (let i = 0; i < this.#clusters.length; i++) {\n\t\t\torder.push(i);\n\t\t}\n\n\t\tlet cur     = this._pro.worstSatisfactionDegree();\n\t\tlet success = false;\n\n\t\twhile (true) {\n\t\t\tif (this._iterLimit && this._iterLimit < iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet modified = false;\n\t\t\tfor (const i of this.#shuffle(order)) {\n\t\t\t\tif (this.#clusters[i].setActivityMaximumInput()) {\n\t\t\t\t\tmodified = true;  // Turn on the node with the largest input in each cluster\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!modified) {  // When the local minimum solution is reached.\n\t\t\t\tfor (const con of this.#connections) {\n\t\t\t\t\tcon.refreshWeight();  // Update weights for all connections\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tfor (const clu of this.#clusters) {\n\t\t\t\t\tclu.applyToVariable();  // Apply to variable\n\t\t\t\t}\n\t\t\t\tconst d = this._pro.worstSatisfactionDegree();\n\t\t\t\tif (cur < d) {  // If it's a better assignment than ever, save it.\n\t\t\t\t\tcur = d;\n\t\t\t\t\tif (this._debug) console.log(`worst satisfaction degree: ${d}`);\n\t\t\t\t\tsol.setProblem(this._pro);\n\t\t\t\t\tif (this.foundSolution(sol, d)) {  // Call hook\n\t\t\t\t\t\tsuccess = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (this._targetDeg === null) {  // Satisfaction degree is not specified.\n\t\t\t\t\t\tsuccess = true;\n\t\t\t\t\t} else if (this._targetDeg <= cur) {  // Satisfaction degree is specified.\n\t\t\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\t\t\tsuccess = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsol.apply();\n\t\treturn success;\n\t}\n\n}\n\n{\n\n\tclass Cluster {\n\n\t\tstatic nextInt(max) {\n\t\t\treturn Math.floor(Math.random() * Math.floor(max));\n\t\t}\n\n\t\t#var;\n\t\t#index;\n\t\t#maxNeurons = [];\n\t\t_neurons    = [];\n\n\t\tconstructor(v) {\n\t\t\tthis.#var = v;\n\n\t\t\tfor (const val of v.domain()) {\n\t\t\t\tthis._neurons.push(new Neuron(val));\n\t\t\t}\n\t\t\tthis.#setActivity(Cluster.nextInt(this._neurons.length));\n\t\t}\n\n\t\t#setActivity(index) {\n\t\t\tfor (const n of this._neurons) {\n\t\t\t\tn._isActive = false;\n\t\t\t}\n\t\t\tthis._neurons[index]._isActive = true;\n\t\t\tthis.#index = index;\n\t\t}\n\n\t\tapplyToVariable() {\n\t\t\tthis.#var.assign(this._neurons[this.#index]._value);\n\t\t}\n\n\t\tget(index) {\n\t\t\treturn this._neurons[index];\n\t\t}\n\n\t\tneurons() {\n\t\t\treturn this._neurons;\n\t\t}\n\n\t\t// Turn on the node with the largest input.\n\t\tsetActivityMaximumInput() {\n\t\t\tthis.#maxNeurons.length = 0;\n\n\t\t\tlet max       = Number.NEGATIVE_INFINITY;\n\t\t\tlet alreadyOn = false;\n\n\t\t\tfor (let i = 0; i < this._neurons.length; ++i) {\n\t\t\t\tconst input = this._neurons[i].getInput();\n\n\t\t\t\tif (max <= input) {\n\t\t\t\t\tif (max < input) {\n\t\t\t\t\t\tmax = input;\n\t\t\t\t\t\tthis.#maxNeurons.length = 0;\n\t\t\t\t\t\talreadyOn = false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.#maxNeurons.push(i);\n\t\t\t\t\tif (this.#index === i) {\n\t\t\t\t\t\talreadyOn = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (alreadyOn || this.#maxNeurons.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.#setActivity(this.#maxNeurons[Cluster.nextInt(this.#maxNeurons.length)]);\n\t\t\treturn true;\n\t\t}\n\n\t\tsize() {\n\t\t\treturn this._neurons.length;\n\t\t}\n\n\t}\n\tFuzzyGENET.Cluster = Cluster;\n\n\tclass Connection {\n\n\t\t#c\n\t\t#first;\n\t\t#second;\n\t\t_weight;  // Direct reference (read) allowed.\n\n\t\t// Order of neurons must be the same as the order of variables that the constraint has.\n\t\tconstructor(c, first, second = null) {\n\t\t\tthis._weight = c.satisfactionDegree() - 1;\n\t\t\tthis.#c      = c;\n\n\t\t\tthis.#first = first;\n\t\t\tthis.#first.addConnection(this);\n\t\t\tthis.#second = second;\n\t\t\tif (this.#second !== null) {\n\t\t\t\tthis.#second.addConnection(this);\n\t\t\t}\n\t\t}\n\n\t\tgetNeuron(self) {\n\t\t\tif (self === this.#first)  return this.#second;\n\t\t\tif (self === this.#second) return this.#first;\n\t\t\treturn null;\n\t\t}\n\n\t\trefreshWeight() {\n\t\t\tif (!this.#first._isActive || (this.#second !== null && !this.#second._isActive)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.#c.size() === 1) {\n\t\t\t\tthis._weight += (this.#c.fuzzyRelation().satisfactionDegree(this.#first._value) - 1);\n\t\t\t} else {\n\t\t\t\tthis._weight += (this.#c.fuzzyRelation().satisfactionDegree(this.#first._value, this.#second._value) - 1);\n\t\t\t}\n\t\t}\n\n\t}\n\tFuzzyGENET.Connection = Connection;\n\n\tclass Neuron {\n\n\t\t#conTemp = [];\n\t\t#connections;\n\t\t_value;  // Direct reference (read) allowed.\n\t\t_isActive = false;  // Direct reference (read, write) allowed.\n\n\t\tconstructor(value) {\n\t\t\tthis._value = value;\n\t\t}\n\n\t\taddConnection(c) {\n\t\t\tthis.#conTemp.push(c);\n\t\t}\n\n\t\tlockConnections() {\n\t\t\tthis.#connections = [...this.#conTemp];\n\t\t\tthis.#conTemp     = null;  // No longer being used.\n\t\t}\n\n\t\tgetInput() {\n\t\t\tlet ret = 0;\n\t\t\tfor (const c of this.#connections) {\n\t\t\t\tconst n = c.getNeuron(this);  // If n is null, then the unary constraint.\n\t\t\t\tret += c._weight * ((n === null || n._isActive) ? 1 : 0);\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t}\n\tFuzzyGENET.Neuron = Neuron;\n\n}\n\n/**\n * A class that implements the flexible local changes method.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass FlexibleLocalChanges extends Solver {\n\n\tstatic #setPlusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.add(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setMinusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.delete(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setPlusElement(s, e) {\n\t\tconst sn = new Set(s);\n\t\tsn.add(e);\n\t\treturn sn;\n\t}\n\n\tstatic #setMinusElement(s, e) {\n\t\tconst sn = new Set(s);\n\t\tsn.delete(e);\n\t\treturn sn;\n\t}\n\n\t#lt;\n\t#lb;\n\n\t#iterCount;\n\t#endTime;\n\t#globalReturn;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tthis.#computeHighestAndLowestConsistencyDegree();\n\t}\n\n\tname() {\n\t\treturn 'Flexible Local Changes';\n\t}\n\n\t#choose(x2, cr) {\n\t\tconst res = new Map();\n\n\t\tfor (const c of cr) {\n\t\t\tif (!c.isDefined()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const v of c) {\n\t\t\t\tif (!res.has(v)) {\n\t\t\t\t\tres.set(v, 1);\n\t\t\t\t} else {\n\t\t\t\t\tres.set(v, res.get(v) + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst vs = [...x2];\n\t\tvs.sort((o1, o2) => {\n\t\t\tlet res1 = 0;\n\t\t\tlet res2 = 0;\n\t\t\tif (res.has(o1)) res1 = res.get(o1);\n\t\t\tif (res.has(o2)) res2 = res.get(o2);\n\n\t\t\tif (res1 < res2) return 1;\n\t\t\tif (res1 > res2) return -1;\n\t\t\treturn 0;\n\t\t});\n\n\t\tconst ret = new Set();\n\n\t\tfor (const v of vs) {\n\t\t\tlet remain = false;\n\t\t\tfor (const c of cr) {\n\t\t\t\tif (c.isDefined()) {\n\t\t\t\t\tremain = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!remain) break;\n\t\t\tv.clear();\n\t\t\tret.add(v);\n\t\t}\n\t\treturn ret;\n\t}\n\n\t#computeHighestAndLowestConsistencyDegree() {\n\t\tlet low  = 1;\n\t\tlet high = 0;\n\n\t\tfor (const v of this._pro.variables()) {\n\t\t\tfor (const c of v) {\n\t\t\t\tconst l = c.lowestConsistencyDegree();\n\t\t\t\tconst h = c.highestConsistencyDegree();\n\t\t\t\tif (l < low)  low  = l;\n\t\t\t\tif (h > high) high = h;\n\t\t\t}\n\t\t}\n\t\tthis.#lb = low;\n\t\tthis.#lt = high;\n\t}\n\n\t#flcRepair(X1, X2, xi, consX1xi, consX12, cr, rc) {\n\t\tconst X3p = this.#choose(X2, cr);\n\t\tconst X1p = FlexibleLocalChanges.#setPlusElement(X1, xi);\n\t\tconst X2p = FlexibleLocalChanges.#setMinusSet(X2, X3p);\n\t\treturn this.#flcVariables(X1p, X2p, X3p, consX1xi, Math.min(consX12, consX1xi), rc);\n\t}\n\n\t#flcVariable(X1, X2, xi, consX1, consX12, rc) {\n\t\tlet bestCons = this.#lb;\n\t\tif (xi.domain().size() === 0) {\n\t\t\treturn bestCons;\n\t\t}\n\t\tlet bestX2  = AssignmentList.fromVariables(X2);\n\t\tlet bestDij = xi.domain().at(0);\n\n\t\tconst x2Store = AssignmentList.fromVariables(X2);\n\n\t\tfor (let j = 0; j < xi.domain().size() && bestCons < consX12; ++j) {\n\t\t\tconst dij = xi.domain().at(j);\n\t\t\txi.assign(dij);\n\t\t\tconst consX1_xi = Math.min(consX1, this.#testX1(X1, xi, bestCons, rc));\n\n\t\t\tif (consX1_xi > Math.max(bestCons, rc)) {\n\t\t\t\tconst crNew = new Set();\n\t\t\t\tconst consX12_xi = Math.min(Math.min(consX1_xi, consX12), this.#testX12(X1, X2, xi, consX1_xi, consX12, crNew));\n\n\t\t\t\tif (consX12_xi > bestCons) {\n\t\t\t\t\tbestCons = consX12_xi;\n\t\t\t\t\tbestDij  = dij;\n\t\t\t\t\tbestX2   = AssignmentList.fromVariables(X2);\n\t\t\t\t}\n\t\t\t\tif (crNew.size) {\n\t\t\t\t\tconst repairCons = this.#flcRepair(X1, X2, xi, consX1_xi, consX12, crNew, Math.max(rc, bestCons));\n\t\t\t\t\tif (this.#globalReturn !== -1) {\n\t\t\t\t\t\treturn bestCons;\n\t\t\t\t\t}\n\t\t\t\t\tif (repairCons > bestCons) {\n\t\t\t\t\t\tbestCons = repairCons;\n\t\t\t\t\t\tbestDij  = dij;\n\t\t\t\t\t\tbestX2   = AssignmentList.fromVariables(X2);\n\t\t\t\t\t}\n\t\t\t\t\tx2Store.apply();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tbestX2.apply();\n\t\txi.assign(bestDij);\n\t\treturn bestCons;\n\t}\n\n\t#flcVariables(X1, X2, X3, consX1, consX12, rc) {\n\t\tif (this._debug) {\n\t\t\tconsole.log(`X1 ${X1.size}, X2' ${X2.size}, X3' ${X3.size}`);\n\t\t}\n\t\tif (this._targetDeg !== null && this._targetDeg <= this._pro.worstSatisfactionDegree()) {  // Success if the degree improves from specified\n\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\tthis.#globalReturn = 1;\n\t\t\treturn consX12;\n\t\t}\n\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {  // Failure if repeated a specified number\n\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\tthis.#globalReturn = 0;\n\t\t\treturn consX12;\n\t\t}\n\t\tif (this.#endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\tthis.#globalReturn = 0;\n\t\t\treturn consX12;\n\t\t}\n\t\tif (X3.size === 0) {\n\t\t\treturn consX12;\n\t\t}\n\t\tconst xi        = X3.values().next().value;\n\t\tconst consX12xi = this.#flcVariable(X1, X2, xi, consX1, consX12, rc);\n\n\t\tif (this.#globalReturn !== -1) {\n\t\t\treturn consX12;\n\t\t}\n\t\tif (consX12xi < rc) {\n\t\t\treturn this.#lb;\n\t\t}\n\t\tX2 = FlexibleLocalChanges.#setPlusElement(X2, xi);\n\t\tX3 = FlexibleLocalChanges.#setMinusElement(X3, xi);\n\t\treturn this.#flcVariables(X1, X2, X3, consX1, consX12xi, rc);\n\t}\n\n\t#initTest(X, cr) {\n\t\tconst cs = new Set();\n\t\tfor (const v of X) {\n\t\t\tfor (const c of v) {\n\t\t\t\tcs.add(c);  // All variables in X have been assigned.\n\t\t\t}\n\t\t}\n\t\tlet ret = 1;\n\t\tfor (const c of cs) {\n\t\t\tconst sd = c.satisfactionDegree();\n\t\t\tif (sd === Constraint.UNDEFINED) continue;\n\t\t\tif (sd < ret) ret = sd;\n\t\t}\n\t\tfor (const c of this._pro.constraints()) {\n\t\t\tconst cd = c.lowestConsistencyDegree();\n\t\t\tif (cd < this.#lt) cr.add(c);\n\t\t}\n\t\treturn ret;\n\t}\n\n\t#testX1(X1, xi, bestCons, rc) {\n\t\tlet cd = 1;\n\t\tconst cs = new Set();\n\n\t\tfor (const v of X1) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, xi);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tfor (const c of cs) {\n\t\t\tconst d = c.satisfactionDegree();\n\t\t\tif (d === Constraint.UNDEFINED) continue;\n\t\t\tif (d < cd) cd = d;\n\t\t\tif (cd <= bestCons || cd <= rc) return cd;  // If it is determined that a better solution than the current solution cannot be obtained\n\t\t}\n\t\treturn cd;\n\t}\n\n\t#testX12(X1, X2, xi, consX1xi, consX12, cr) {\n\t\tlet csd = 1;\n\t\tconst cs = new Set();\n\n\t\tfor (const v of X1) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, xi);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tfor (const v of X2) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, xi);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tfor (const c of cs) {\n\t\t\tconst sd = c.satisfactionDegree();\n\t\t\tif (sd === Constraint.UNDEFINED) continue;\n\t\t\tif (sd < csd) csd = sd;\n\t\t}\n\t\tfor (const c of cs) {\n\t\t\tconst sd = c.satisfactionDegree();\n\t\t\tif (sd === Constraint.UNDEFINED) continue;\n\t\t\tif (sd < consX1xi || sd < consX12) cr.add(c);\n\t\t}\n\t\treturn csd;\n\t}\n\n\texec() {\n\t\tthis.#endTime      = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount    = 0;\n\t\tthis.#globalReturn = -1;\n\n\t\tconst wsd = this._pro.worstSatisfactionDegree();\n\t\tif (this._pro.emptyVariableSize() === 0) {\n\t\t\tthis._pro.clearAllVariables();\n\t\t}\n\t\tconst X1 = new Set();\n\t\tconst X2 = new Set();  // Currently assigned variables.\n\t\tconst X3 = new Set();  // Currently unassigned variables.\n\t\tfor (const v of this._pro.variables()) {\n\t\t\t(!v.isEmpty() ? X2 : X3).add(v);\n\t\t}\n\n\t\tconst cr       = new Set();\n\t\tconst initCons = this.#initTest(X2, cr);\n\t\tlet rc;\n\t\tlet initSol = null;\n\n\t\tif (X3.size === 0) {\n\t\t\trc      = initCons;\n\t\t\tinitSol = AssignmentList.fromVariables(X2);\n\t\t} else {\n\t\t\trc = this.#lb;\n\t\t}\n\t\tconst X3p = FlexibleLocalChanges.#setPlusSet(this.#choose(X2, cr), X3);\n\t\tconst X2p = FlexibleLocalChanges.#setMinusSet(X2, X3p);\n\t\tlet result = this.#flcVariables(X1, X2p, X3p, this.#lt, this.#lt, rc);\n\t\tif (result < rc) {\n\t\t\tif (initSol !== null) {\n\t\t\t\tinitSol.apply();\n\t\t\t}\n\t\t}\n\t\tresult = this._pro.worstSatisfactionDegree();\n\t\treturn result > wsd && result > 0 && (this.#globalReturn !== 0 || this._targetDeg === null);\n\t}\n\n}\n\n/**\n * A class that implements the flexible local changes method.\n * The implementation is optimized by converting recursive calls to loops.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass FlexibleLocalChangesEx extends Solver {\n\n\tstatic #setPlusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.add(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setMinusSet(s1, s2) {\n\t\tconst sn = new Set(s1);\n\t\tfor (const v of s2) sn.delete(v);\n\t\treturn sn;\n\t}\n\n\tstatic #setPlusElement(s, e) {\n\t\tconst sn = new Set(s);\n\t\tsn.add(e);\n\t\treturn sn;\n\t}\n\n\t#lt;\n\t#lb;\n\n\t#iterCount;\n\t#endTime;\n\t#globalReturn;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tthis.#computeHighestAndLowestConsistencyDegree();\n\t}\n\n\tname() {\n\t\treturn 'Flexible Local Changes Ex';\n\t}\n\n\t#choose(x2, cr) {\n\t\tconst res = new Map();\n\n\t\tfor (const c of cr) {\n\t\t\tif (!c.isDefined()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const v of c) {\n\t\t\t\tif (!res.has(v)) {\n\t\t\t\t\tres.set(v, 1);\n\t\t\t\t} else {\n\t\t\t\t\tres.set(v, res.get(v) + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst vs = [...x2];\n\t\tvs.sort((o1, o2) => {\n\t\t\tlet res1 = 0;\n\t\t\tlet res2 = 0;\n\t\t\tif (res.has(o1)) res1 = res.get(o1);\n\t\t\tif (res.has(o2)) res2 = res.get(o2);\n\n\t\t\tif (res1 < res2) return 1;\n\t\t\tif (res1 > res2) return -1;\n\t\t\treturn 0;\n\t\t});\n\n\t\tconst ret = new Set();\n\n\t\tfor (const v of vs) {\n\t\t\tlet remain = false;\n\t\t\tfor (const c of cr) {\n\t\t\t\tif (c.isDefined()) {\n\t\t\t\t\tremain = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!remain) break;\n\t\t\tv.clear();\n\t\t\tret.add(v);\n\t\t}\n\t\treturn ret;\n\t}\n\n\t#computeHighestAndLowestConsistencyDegree() {\n\t\tlet low  = 1;\n\t\tlet high = 0;\n\n\t\tfor (const v of this._pro.variables()) {\n\t\t\tfor (const c of v) {\n\t\t\t\tconst l = c.lowestConsistencyDegree();\n\t\t\t\tconst h = c.highestConsistencyDegree();\n\t\t\t\tif (l < low)  low  = l;\n\t\t\t\tif (h > high) high = h;\n\t\t\t}\n\t\t}\n\t\tthis.#lb = low;\n\t\tthis.#lt = high;\n\t}\n\n\t#flcRepair(X1, X2, xi, consX1xi, consX12, cr, rc) {\n\t\tconst X3p = this.#choose(X2, cr);\n\t\tconst X1p = FlexibleLocalChangesEx.#setPlusElement(X1, xi);\n\t\tconst X2p = FlexibleLocalChangesEx.#setMinusSet(X2, X3p);\n\t\treturn this.#flcVariables(X1p, X2p, X3p, consX1xi, Math.min(consX12, consX1xi), rc);\n\t}\n\n\t#flcVariable(X1, X2, xi, consX1, consX12, rc) {\n\t\tlet bestCons = this.#lb;\n\t\tif (xi.domain().size() === 0) {\n\t\t\treturn bestCons;\n\t\t}\n\t\tlet bestX2  = AssignmentList.fromVariables(X2);\n\t\tlet bestDij = xi.domain().at(0);\n\n\t\tconst x2Store = AssignmentList.fromVariables(X2);\n\n\t\tfor (let j = 0; j < xi.domain().size() && bestCons < consX12; ++j) {\n\t\t\tconst dij = xi.domain().at(j);\n\t\t\txi.assign(dij);\n\t\t\tconst consX1_xi = Math.min(consX1, this.#testX1(X1, xi, bestCons, rc));\n\n\t\t\tif (consX1_xi > Math.max(bestCons, rc)) {\n\t\t\t\tconst crNew = new Set();\n\t\t\t\tconst consX12_xi = Math.min(Math.min(consX1_xi, consX12), this.#testX12(X1, X2, xi, consX1_xi, consX12, crNew));\n\n\t\t\t\tif (consX12_xi > bestCons) {\n\t\t\t\t\tbestCons = consX12_xi;\n\t\t\t\t\tbestDij  = dij;\n\t\t\t\t\tbestX2   = AssignmentList.fromVariables(X2);\n\t\t\t\t}\n\t\t\t\tif (crNew.size) {\n\t\t\t\t\tconst repairCons = this.#flcRepair(X1, X2, xi, consX1_xi, consX12, crNew, Math.max(rc, bestCons));\n\t\t\t\t\tif (this.#globalReturn !== -1) {\n\t\t\t\t\t\treturn bestCons;\n\t\t\t\t\t}\n\t\t\t\t\tif (repairCons > bestCons) {\n\t\t\t\t\t\tbestCons = repairCons;\n\t\t\t\t\t\tbestDij  = dij;\n\t\t\t\t\t\tbestX2   = AssignmentList.fromVariables(X2);\n\t\t\t\t\t}\n\t\t\t\t\tx2Store.apply();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tbestX2.apply();\n\t\txi.assign(bestDij);\n\t\treturn bestCons;\n\t}\n\n\t#flcVariables(X1, X2, X3, consX1, consX12, rc) {\n\t\tX2 = new Set(X2);  // Clone\n\t\tX3 = new Set(X3);  // Clone\n\n\t\twhile (true) {\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`X1 ${X1.size}, X2' ${X2.size}, X3' ${X3.size}`);\n\t\t\t}\n\t\t\tif (this._targetDeg !== null && this._targetDeg <= this._pro.worstSatisfactionDegree()) {  // Success if the degree improves from specified\n\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\tthis.#globalReturn = 1;\n\t\t\t\treturn consX12;\n\t\t\t}\n\t\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\tthis.#globalReturn = 0;\n\t\t\t\treturn consX12;\n\t\t\t}\n\t\t\tif (this.#endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\tthis.#globalReturn = 0;\n\t\t\t\treturn consX12;\n\t\t\t}\n\t\t\tif (X3.size === 0) {\n\t\t\t\treturn consX12;\n\t\t\t}\n\t\t\tconst xi        = X3.values().next().value;\n\t\t\tconst consX12xi = this.#flcVariable(X1, X2, xi, consX1, consX12, rc);\n\n\t\t\tif (this.#globalReturn !== -1) {\n\t\t\t\treturn consX12;\n\t\t\t}\n\t\t\tif (consX12xi < rc) {\n\t\t\t\treturn this.#lb;\n\t\t\t}\n\t\t\tX2.add(xi);\n\t\t\tX3.delete(xi);\n\t\t\tconsX12 = consX12xi;\n\t\t}\n\t}\n\n\t#initTest(X, cr) {\n\t\tconst cs = new Set();\n\t\tfor (const v of X) {\n\t\t\tfor (const c of v) {\n\t\t\t\tcs.add(c);  // All variables in X have been assigned.\n\t\t\t}\n\t\t}\n\t\tlet ret = 1;\n\t\tfor (const c of cs) {\n\t\t\tconst sd = c.satisfactionDegree();\n\t\t\tif (sd === Constraint.UNDEFINED) continue;\n\t\t\tif (sd < ret) ret = sd;\n\t\t}\n\t\tfor (const c of this._pro.constraints()) {\n\t\t\tconst cd = c.lowestConsistencyDegree();\n\t\t\tif (cd < this.#lt) cr.add(c);\n\t\t}\n\t\treturn ret;\n\t}\n\n\t#testX1(X1, xi, bestCons, rc) {\n\t\tlet cd = 1;\n\t\tconst cs = new Set();\n\n\t\tfor (const v of X1) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, xi);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tfor (const c of cs) {\n\t\t\tconst d = c.satisfactionDegree();\n\t\t\tif (d === Constraint.UNDEFINED) continue;\n\t\t\tif (d < cd) cd = d;\n\t\t\tif (cd <= bestCons || cd <= rc) return cd;  // If it is determined that a better solution than the current solution cannot be obtained\n\t\t}\n\t\treturn cd;\n\t}\n\n\t#testX12(X1, X2, xi, consX1xi, consX12, cr) {\n\t\tlet csd = 1;\n\t\tconst cs = new Set();\n\n\t\tfor (const v of X1) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, xi);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tfor (const v of X2) {\n\t\t\tconst temp = this._pro.constraintsBetween(v, xi);\n\t\t\tfor (const c of temp) cs.add(c);\n\t\t}\n\t\tfor (const c of cs) {\n\t\t\tconst sd = c.satisfactionDegree();\n\t\t\tif (sd === Constraint.UNDEFINED) continue;\n\t\t\tif (sd < csd) csd = sd;\n\t\t}\n\t\tfor (const c of cs) {\n\t\t\tconst sd = c.satisfactionDegree();\n\t\t\tif (sd === Constraint.UNDEFINED) continue;\n\t\t\tif (sd < consX1xi || sd < consX12) cr.add(c);\n\t\t}\n\t\treturn csd;\n\t}\n\n\texec() {\n\t\tthis.#endTime      = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount    = 0;\n\t\tthis.#globalReturn = -1;\n\n\t\tconst wsd = this._pro.worstSatisfactionDegree();\n\t\tif (this._pro.emptyVariableSize() === 0) {\n\t\t\tthis._pro.clearAllVariables();\n\t\t}\n\t\tconst X1 = new Set();\n\t\tconst X2 = new Set();  // Currently assigned variables.\n\t\tconst X3 = new Set();  // Currently unassigned variables.\n\t\tfor (const v of this._pro.variables()) {\n\t\t\t(!v.isEmpty() ? X2 : X3).add(v);\n\t\t}\n\n\t\tconst cr       = new Set();\n\t\tconst initCons = this.#initTest(X2, cr);\n\t\tlet rc;\n\t\tlet initSol = null;\n\n\t\tif (X3.size === 0) {\n\t\t\trc      = initCons;\n\t\t\tinitSol = AssignmentList.fromVariables(X2);\n\t\t} else {\n\t\t\trc = this.#lb;\n\t\t}\n\t\tconst X3p = FlexibleLocalChangesEx.#setPlusSet(this.#choose(X2, cr), X3);\n\t\tconst X2p = FlexibleLocalChangesEx.#setMinusSet(X2, X3p);\n\t\tlet result = this.#flcVariables(X1, X2p, X3p, this.#lt, this.#lt, rc);\n\t\tif (result < rc) {\n\t\t\tif (initSol !== null) {\n\t\t\t\tinitSol.apply();\n\t\t\t}\n\t\t}\n\t\tresult = this._pro.worstSatisfactionDegree();\n\t\treturn result > wsd && result > 0 && (this.#globalReturn !== 0 || this._targetDeg === null);\n\t}\n\n}\n\n/**\n * This class implements the SRS algorithm.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass SRS3 extends Solver {\n\n\t// Threshold for adopting a candidate assignment at repair time (should be 0 if strictly following SRS 3)\n\tstatic REPAIR_THRESHOLD = 0;\n\n\t#closedList          = new Set();\n\t#openList            = new Set();  // LinkedHashSet is used in the original implementation.\n\t#nodes               = [];\n\t#neighborConstraints = [];  // Cache\n\n\t#c_stars = new Set();  // ArrayList is used in the original implementation.\n\n\t#iterCount;\n\t#endTime;\n\t#isRandom = true;\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t\tfor (const c of this._pro.constraints()) {\n\t\t\tthis.#nodes.push(new CrispSRS3.TreeNode(c));\n\t\t\tthis.#neighborConstraints.push(null);\n\t\t}\n\t}\n\n\tname() {\n\t\treturn 'SRS 3';\n\t}\n\n\tfoundSolution(solution, worstDegree) {\n\t\treturn false;\n\t}\n\n\t#getNeighborConstraints(c) {\n\t\tconst index = c.index();\n\n\t\tif (this.#neighborConstraints[index] === null) {\n\t\t\tthis.#neighborConstraints[index] = c.neighbors();\n\t\t}\n\t\treturn this.#neighborConstraints[index];\n\t}\n\n\t#repair(c0) {\n\t\tif (this._debug) console.log('repair');\n\n\t\tconst candidates = new AssignmentList();\n\t\tconst minDeg0    = c0.satisfactionDegree();  // Target c0 should certainly be an improvement over this.\n\t\tconst min        = this._pro.worstSatisfactionDegree();  // Lower bound of neighborhood constraints.\n\t\tlet maxDeg0 = c0.satisfactionDegree();  // Satisfaction degree of target c0 for the most improvement so far.\n\n\t\t// If a candidate satisfying the condition is stronger than the previous candidates,\n\t\t// it is replaced, and if no candidate is found until the end, it fails.\n\t\tfor (const v of c0) {\n\t\t\tconst v_val = v.value();  // Save the value\n\n\t\t\tout: for (const d of v.domain()) {\n\t\t\t\tif (v_val === d) continue;\n\t\t\t\tv.assign(d);\n\t\t\t\tconst deg0 = c0.satisfactionDegree();\n\t\t\t\t// If target c0 cannot be improved, the assignment is rejected.\n\t\t\t\tif (minDeg0 > deg0 || maxDeg0 - deg0 > SRS3.REPAIR_THRESHOLD) continue;\n\n\t\t\t\tfor (const c of v) {\n\t\t\t\t\tif (c === c0) continue;\n\t\t\t\t\tconst deg = c.satisfactionDegree();\n\t\t\t\t\t// If one of the neighborhood constraints c is less than or equal to the worst, the assignment is rejected.\n\t\t\t\t\tif (deg !== Constraint.UNDEFINED && deg < min) continue out;\n\t\t\t\t}\n\t\t\t\tif (deg0 > maxDeg0) {\n\t\t\t\t\tmaxDeg0 = deg0;\n\t\t\t\t\tcandidates.clear();\n\t\t\t\t}\n\t\t\t\tcandidates.addVariable(v, d);\n\t\t\t}\n\t\t\tv.assign(v_val);  // Restore the value\n\t\t}\n\t\tif (candidates.size() > 0) {\n\t\t\tconst e = this.#isRandom ? candidates.arbitraryAssignment() : candidates.get(0);\n\t\t\tconsole.log(e);\n\t\t\te.apply();\n\t\t\tif (this._debug) console.log('\\t' + e);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t#shrink(node) {\n\t\tif (this._debug) console.log('shrink');\n\n\t\tlet removeCStar = false;\n\t\twhile (true) {\n\t\t\tnode = node.parent();\n\t\t\tif (this.#c_stars.delete(node)) {\n\t\t\t\tremoveCStar = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!this.#repair(node.parent().getObject())) break;\n\t\t}\n\t\tconst temp = [];\n\t\tnode.getDescendants(temp);  // temp contains node.\n\n\t\tfor (const n of temp) {\n\t\t\tn.clear();  // Prepare for reuse\n\t\t\tthis.#openList.delete(n);\n\t\t\tthis.#closedList.delete(n);\n\t\t}\n\n\t\tif (!removeCStar) {\n\t\t\tthis.#openList.add(node);\n\t\t}\n\t}\n\n\t#spread(node) {\n\t\tif (this._debug) console.log('spread');\n\t\tthis.#closedList.add(node);\n\n\t\tfor (const c of this.#getNeighborConstraints(node.getObject())) {\n\t\t\tconst cn = this.#nodes[c.index()];\n\n\t\t\tif (!this.#closedList.has(cn) && !this.#openList.has(cn)) {  // For constraints that are not included in Open or Closed.\n\t\t\t\tnode.add(cn);\n\t\t\t\tthis.#openList.add(cn);\n\t\t\t}\n\t\t}\n\t}\n\n\t#srs() {\n\t\tif (this._debug) console.log('srs');\n\n\t\tconst [wsdcs,] = this._pro.constraintsWithWorstSatisfactionDegree();\n\t\tfor (const c of wsdcs) {\n\t\t\tconst cn = this.#nodes[c.index()];\n\t\t\tcn.setParent(null);\n\t\t\tthis.#c_stars.add(cn);\n\t\t}\n\t\tthis.#closedList.clear();\n\t\tthis.#openList.clear();\n\t\tfor (const n of this.#c_stars) {\n\t\t\tthis.#openList.add(n);\n\t\t}\n\n\t\twhile (this.#c_stars.size && this.#openList.size) {\n\t\t\tif (this._iterLimit && this._iterLimit < this.#iterCount++) {  // Failure if repeated a specified number\n\t\t\t\tif (this._debug) console.log('stop: number of iterations has reached the limit');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this.#endTime < Date.now()) {  // Failure if time limit is exceeded\n\t\t\t\tif (this._debug) console.log('stop: time limit has been reached');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst node = this.#openList.values().next().value;\n\t\t\tthis.#openList.delete(node);\n\n\t\t\tif (this.#repair(node.getObject())) {\n\t\t\t\tif (this.#c_stars.delete(node)) continue;  // If the repaired node is included in C* (to be deleted)\n\t\t\t\tif (this.#repair(node.parent().getObject())) {\n\t\t\t\t\tthis.#shrink(node);  // When its improvement leads to the improvement of its parents\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.#spread(node);\n\t\t}\n\t\treturn true;\n\t}\n\n\texec() {\n\t\tthis.#endTime   = (this._timeLimit === null) ? Number.MAX_VALUE : (Date.now() + this._timeLimit);\n\t\tthis.#iterCount = 0;\n\t\tif (this._targetDeg && this._targetDeg <= this._pro.worstSatisfactionDegree()) {\n\t\t\treturn true;\n\t\t}\n\t\tconst sol = new AssignmentList();\n\n\t\tlet success = false;\n\t\twhile (true) {\n\t\t\tconst ret = this.#srs();\n\t\t\tif (!ret || this.#c_stars.size) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst solutionWorstDeg = this._pro.worstSatisfactionDegree();\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`\\tfound a solution: ${solutionWorstDeg}\\t${this._targetDeg}`);\n\t\t\t}\n\t\t\tsol.setProblem(this._pro);\n\n\t\t\tif (this.foundSolution(sol, solutionWorstDeg)) {  // Call hook\n\t\t\t\tsuccess = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (this._targetDeg === null) {  // Satisfaction degree is not specified\n\t\t\t\tsuccess = true;\n\t\t\t} else if (this._targetDeg <= solutionWorstDeg) {  // The current degree exceeded the specified degree.\n\t\t\t\tif (this._debug) console.log('stop: current degree is above the target');\n\t\t\t\tsuccess = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn success;\n\t}\n\n\t/**\n\t * Sets the randomness of the algorithm.\n\t * Enabling randomness reduces the risk of falling into a local solution, but makes the solution unrepeatable.\n\t * @param flag If true, randomness is enabled.\n\t */\n\tsetRandomness(flag) {\n\t\tthis.#isRandom = flag;\n\t}\n\n}\n\n{\n\n\tclass TreeNode {\n\n\t\t#children = [];\n\t\t#parent;\n\t\t#obj;\n\n\t\tconstructor(obj) {\n\t\t\tthis.#obj = obj;\n\t\t}\n\n\t\tadd(tn) {\n\t\t\ttn.#parent = this;\n\t\t\tthis.#children.push(tn);\n\t\t}\n\n\t\tclear() {\n\t\t\tfor (const tn of this.#children) {\n\t\t\t\ttn.#parent = null;\n\t\t\t}\n\t\t\tthis.#children.length = 0;\n\t\t}\n\n\t\tgetDescendants(tns) {\n\t\t\ttns.push(this);\n\n\t\t\tfor (const tn of this.#children) {\n\t\t\t\ttn.getDescendants(tns);\n\t\t\t}\n\t\t}\n\n\t\tgetObject() {\n\t\t\treturn this.#obj;\n\t\t}\n\n\t\tparent() {\n\t\t\treturn this.#parent;\n\t\t}\n\n\t\tsetParent(p) {\n\t\t\tthis.#parent = p;\n\t\t}\n\n\t}\n\tCrispSRS3.TreeNode = TreeNode;\n\n}\n\n/**\n * This class implements the SRS algorithm with PF.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass SRS3_PF extends SRS3 {\n\n\tconstructor(p) {\n\t\tsuper(p);\n\t}\n\n\tname() {\n\t\treturn 'SRS 3 + PF';\n\t}\n\n\texec() {\n\t\tlet deg = 0;\n\t\tlet uvs = 0;\n\t\tif (this._debug) {\n\t\t\tdeg = this._pro.worstSatisfactionDegree();\n\t\t\tuvs = this._pro.emptyVariableSize();\n\t\t}\n\t\tconst at = new AssignmentList();\n\t\tat.setProblem(this._pro);\n\n\t\tconst res = super.exec();\n\n\t\tif (res) {\n\t\t\tPostStabilization.apply(this._pro, at);\n\t\t}\n\t\tif (this._debug) {\n\t\t\tconsole.log(`result: ${res ? 'success' : 'failure'}`);\n\t\t\tconsole.log(`satisfaction degree: ${deg} -> ${this._pro.worstSatisfactionDegree()}`);\n\t\t\tconsole.log(`unassigned size: ${uvs} -> ${this._pro.emptyVariableSize()}`);\n\t\t}\n\t\treturn res;\n\t}\n\n}\n\n\n/**\n * The class implements AC-3, one of the arc consistency algorithms.\n *\n * @author Takuto Yanagida\n * @version 2023-04-10\n */\n\nclass AC3 {\n\n\tstatic #checkConsistency(c, v_j) {\n\t\tfor (const val of v_j.domain()) {  // Is there a partner that satisfies the constraint?\n\t\t\tv_j.assign(val);\n\n\t\t\tif (c.isSatisfied() === 1) {  // It exists!\n\t\t\t\treturn true;  // Current assignment of v_i is consistent.\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic #reviseDomain(p, v_i, v_j) {\n\t\tconst val_i = v_i.value();\n\t\tconst val_j = v_j.value();  // Save the value.\n\t\tconst d_i   = v_i.domain();\n\t\tconst temp  = [];\n\n\t\tconst cs = p.constraintsBetween(v_i, v_j);\n\n\t\tvals: for (const val of d_i) {\n\t\t\tv_i.assign(val);\n\n\t\t\tfor (const c of cs) {\n\t\t\t\tif (c.size() !== 2) continue;  // Check the next constraint\n\t\t\t\tif (!AC3.#checkConsistency(c, v_j)) continue vals;   // Since there is no partner satisfying the constraint, check the next value.\n\t\t\t}\n\t\t\ttemp.push(val);\n\t\t}\n\t\tv_i.assign(val_i);  // Restore the value.\n\t\tv_j.assign(val_j);  // Restore the value.\n\n\t\tif (temp.length !== d_i.size()) {\n\t\t\tconst nd = p.createDomain({ values: temp });\n\t\t\tv_i.setDomain(nd);\n\t\t\tconsole.log(d_i.size() + ' -> ' + nd.size());\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic apply(p) {\n\t\tconst cs = [];\n\n\t\tfor (const c of p.constraints()) {\n\t\t\tif (c.size() === 2) cs.add(c);\n\t\t}\n\t\twhile (!cs.isEmpty()) {\n\t\t\tconst c   = cs.remove(cs.size() - 1);\n\t\t\tconst v_k = c.at(0);\n\t\t\tconst v_m = c.at(1);\n\n\t\t\tif (AC3.#reviseDomain(p, v_k, v_m)) {\n\t\t\t\tfor (const c1 of p.constraints()) {\n\t\t\t\t\tif (c1.size() === 2 && c1.at(1) === v_k && c1.at(0) !== v_m) {\n\t\t\t\t\t\tcs.add(0, c1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n/**\n * Utility class that performs node consistency.\n *\n * @author Takuto Yanagida\n * @version 2023-04-11\n */\n\nclass NodeConsistency {\n\n\t/**\n\t * Guarantees consistency of fuzzy unary constraints. The domain of each variable is replaced as needed.\n\t * Deletes elements from domains that do not meet the specified worst satisfaction degree.\n\t * @param p A problem.\n\t * @param threshold Worst satisfaction degree.\n\t * @return True if there is no empty domain.\n\t */\n\tstatic apply(p, threshold) {\n\t\tfor (const v of p.variables()) {\n\t\t\tconst d       = v.domain();\n\t\t\tconst origVal = v.value();  // Save the value.\n\t\t\tconst elms    = [];\n\n\t\t\tfor (const c of v) {\n\t\t\t\tif (c.size() !== 1) continue;\n\n\t\t\t\tfor (const val of d) {\n\t\t\t\t\tv.assign(val);\n\n\t\t\t\t\tif (c.satisfactionDegree() >= threshold) {\n\t\t\t\t\t\telms.push(val);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.removeConstraint(c);\n\t\t\t}\n\t\t\tv.assign(origVal);  // Restore the value.\n\t\t\tif (elms.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tv.setDomain(p.createDomain({ values: elms }));\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Guarantees consistency of crisp unary constraints. The domain of each variable is replaced as needed.\n\t * It cannot be applied to crisp views of fuzzy constraint satisfaction problems because it changes the structure of the constraint graph.\n\t * @param p A crisp problem.\n\t * @return True if there is no empty domain.\n\t */\n\tstatic apply(p) {\n\t\tfor (const v of p.variables()) {\n\t\t\tconst d       = v.domain();\n\t\t\tconst origVal = v.value();  // Save the value.\n\t\t\tconst elms    = [];\n\n\t\t\tfor (const c of v) {\n\t\t\t\tif (c.size() !== 1) continue;\n\n\t\t\t\tfor (const val of d) {\n\t\t\t\t\tv.assign(val);\n\n\t\t\t\t\tif (c.isSatisfied() === 1) {\n\t\t\t\t\t\telms.push(val);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.removeConstraint(c);\n\t\t\t}\n\t\t\tv.assign(origVal);  // Restore the value.\n\t\t\tif (elms.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tv.setDomain(p.createDomain({ values: elms }));\n\t\t}\n\t\treturn true;\n\t}\n\n}\n\n/**\n * Class of post-stabilization.\n *\n * @author Takuto Yanagida\n * @version 2023-03-26\n */\n\nclass PostStabilization {\n\n\tstatic apply(p, orig) {\n\t\tconsole.log('start post-stabilization');\n\n\t\tlet stabilized;\n\t\tlet count = 0;\n\n\t\tdo {\n\t\t\tconsole.log('post-stabilization: count ' + count++);\n\n\t\t\tstabilized = false;\n\t\t\tlet C_min = p.worstSatisfactionDegree();\n\n\t\t\tfor (let i = 0; i < p.variableSize(); ++i) {\n\t\t\t\tconst v = p.variableAt(i);\n\t\t\t\tconst org = v.value();\n\n\t\t\t\tconst a = orig.get(i);\n\t\t\t\tif (org === a.value()) continue;\n\n\t\t\t\ta.apply();  // Try to assign the original.\n\t\t\t\tif (p.worstSatisfactionDegree() >= C_min) {\n\t\t\t\t\tstabilized = true;\n\t\t\t\t} else {\n\t\t\t\t\tv.assign(org);  // Restore.\n\t\t\t\t}\n\t\t\t}\n\t\t} while (stabilized);\n\n\t\tconsole.log('finish post-stabilization');\n\t\treturn true;\n\t}\n\n}\n\n"]}